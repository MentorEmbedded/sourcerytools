Index: src/vsip/core/parallel/expr.hpp
===================================================================
--- src/vsip/core/parallel/expr.hpp	(revision 169800)
+++ src/vsip/core/parallel/expr.hpp	(working copy)
@@ -182,6 +182,47 @@
   typename View_block_storage<BlockT>::expr_type blk_;
 };
 
+template <typename MapT,typename RetBlock>
+struct Create_subblock;
+
+template <typename RetBlock>
+struct Create_subblock<Map<Block_dist,Block_dist,Block_dist>, RetBlock>
+{
+  template <typename MapT,typename BlockT>
+  static RetBlock exec(MapT const& map, BlockT const& blk)
+  {
+    dimension_type const dim = BlockT::dim;
+    return RetBlock(map.template impl_global_domain<dim>(map.subblock(),0),blk);
+  }
+};
+
+template <typename MapT, typename RetBlock>
+struct Create_subblock
+{
+  template <typename BlockT>
+  static RetBlock exec(MapT const& map,
+                BlockT const& blk)
+  {
+    return RetBlock(blk,map);
+  }
+};
+
+template <typename MapT, typename BlockT>
+struct Choose_local_block;
+
+template <typename BlockT>
+struct Choose_local_block<Map<Block_dist,Block_dist,Block_dist>, BlockT>
+{
+  typedef Subset_block<BlockT> block_type;
+};
+
+template <typename MapT, typename BlockT>
+struct Choose_local_block
+{
+  typedef Map_subset_block<BlockT,MapT> block_type;
+};
+
+
 template <dimension_type Dim,
 	  typename       MapT,
 	  typename       BlockT>
@@ -196,7 +237,8 @@
   typedef MapT                                  map_type;
 
 
-  typedef Map_subset_block<BlockT const, MapT>  local_block_type;
+  typedef typename Choose_local_block<MapT, BlockT const>::block_type
+                                                local_block_type;
   typedef typename View_block_storage<local_block_type>::plain_type
                                                 local_block_ret_type;
 
@@ -204,7 +246,7 @@
   Par_expr_block(MapT const& map, BlockT const& block)
     : map_     (map),
       blk_     (block),
-      subblock_(blk_,map_)
+      subblock_(Create_subblock<MapT,local_block_type>::exec(map_,blk_))
   {}
 
   ~Par_expr_block() {}
Index: ChangeLog
===================================================================
--- ChangeLog	(revision 169963)
+++ ChangeLog	(working copy)
@@ -1,3 +1,9 @@
+2007-04-28  Assem Salama <assem@codesourcery.com>
+	* src/vsip/core/parallel/expr.hpp: Changed the local_block_type in
+	  the Peb_remap_tag to depend on the Map. If a entirely Block_dist map
+	  is used, the local_block_type becomes a simple Subset_block. However,
+	  a cyclic block makes the local_block_type a Map_subset_block.
+
 2007-04-27  Jules Bergmann  <jules@codesourcery.com>
 
 	* configure.ac (PAS_HEAP_SIZE, PAS_SHARE_DYNAMIC_XFER): Alway define.
