<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> PATCH: Make result annotations always available for ExecTest
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:qmtest%40codesourcery.com?Subject=Re%3A%20PATCH%3A%20Make%20result%20annotations%20always%20available%20for%20ExecTest&In-Reply-To=%3C200309262304.h8QN4Wkt030807%40doubledemon.codesourcery.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000526.html">
   <LINK REL="Next"  HREF="000528.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>PATCH: Make result annotations always available for ExecTest</H1>
    <B>Mark Mitchell</B> 
    <A HREF="mailto:qmtest%40codesourcery.com?Subject=Re%3A%20PATCH%3A%20Make%20result%20annotations%20always%20available%20for%20ExecTest&In-Reply-To=%3C200309262304.h8QN4Wkt030807%40doubledemon.codesourcery.com%3E"
       TITLE="PATCH: Make result annotations always available for ExecTest">mark at codesourcery.com
       </A><BR>
    <I>Fri Sep 26 23:04:32 UTC 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000526.html">PATCH: Timeouts for Windows
</A></li>
        <LI>Next message: <A HREF="000528.html">PATCH: Add --help support for &quot;qmtest remote&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#527">[ date ]</a>
              <a href="thread.html#527">[ thread ]</a>
              <a href="subject.html#527">[ subject ]</a>
              <a href="author.html#527">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
This test makes the result annotations for ExecTest (the exit code,
stdout, and stderr) always available.  Until now, they've only been
available on FAILing tests.  That's not in keeping with the spirit of
these kinds of annotations; you want to be able to look at them in the
results file whether or not the test fails.

I've also updated the documentation to remove an obsolete mention of
carriage-return issues in execution tests.

--
Mark Mitchell
CodeSourcery, LLC
<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/qmtest">mark at codesourcery.com</A>

2003-09-25  Mark Mitchell  &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/qmtest">mark at codesourcery.com</A>&gt;

	* qm/test/classes/command.py (ExecTestBase.arguments): Improve
	documentation for exit_code.
	* qm/test/doc/tour.xml: Remove discussion of carriage-returns in
	execution tests.

Index: qm/test/classes/command.py
===================================================================
RCS file: /home/sc/Repository/qm/qm/test/classes/command.py,v
retrieving revision 1.41
diff -c -5 -p -r1.41 command.py
*** qm/test/classes/command.py	25 Sep 2003 19:23:12 -0000	1.41
--- qm/test/classes/command.py	26 Sep 2003 22:53:58 -0000
*************** class ExecTestBase(Test):
*** 199,224 ****
              else:
                  exit_code = os.WEXITSTATUS(exit_status)
              # Get the output generated by the program.
              stdout = e.stdout
              stderr = e.stderr
              # Check to see if the exit code matches.
              if exit_code != self.exit_code:
                  causes.append(&quot;exit_code&quot;)
                  result[&quot;ExecTest.expected_exit_code&quot;] \
                      = str(self.exit_code)
-                 result[&quot;ExecTest.exit_code&quot;] = str(exit_code)
              # Check to see if the standard output matches.
              if not self.__CompareText(stdout, self.stdout):
                  causes.append(&quot;standard output&quot;)
-                 result[&quot;ExecTest.stdout&quot;] = &quot;&lt;pre&gt;&quot; + stdout + &quot;&lt;/pre&gt;&quot;
                  result[&quot;ExecTest.expected_stdout&quot;] \
                      = &quot;&lt;pre&gt;&quot; + self.stdout + &quot;&lt;/pre&gt;&quot;
              # Check to see that the standard error matches.
              if not self.__CompareText(stderr, self.stderr):
                  causes.append(&quot;standard error&quot;)
-                 result[&quot;ExecTest.stderr&quot;] = &quot;&lt;pre&gt;&quot; + stderr + &quot;&lt;/pre&gt;&quot;
                  result[&quot;ExecTest.expected_stderr&quot;] \
                      = &quot;&lt;pre&gt;&quot; + self.stderr + &quot;&lt;/pre&gt;&quot;
              # If anything went wrong, the test failed.
              if causes:
                  result.Fail(&quot;Unexpected %s.&quot; % string.join(causes, &quot;, &quot;)) 
--- 199,225 ----
              else:
                  exit_code = os.WEXITSTATUS(exit_status)
              # Get the output generated by the program.
              stdout = e.stdout
              stderr = e.stderr
+             # Record the results.
+             result[&quot;ExecTest.exit_code&quot;] = str(exit_code)
+             result[&quot;ExecTest.stdout&quot;] = &quot;&lt;pre&gt;&quot; + stdout + &quot;&lt;/pre&gt;&quot;
+             result[&quot;ExecTest.stderr&quot;] = &quot;&lt;pre&gt;&quot; + stderr + &quot;&lt;/pre&gt;&quot;
              # Check to see if the exit code matches.
              if exit_code != self.exit_code:
                  causes.append(&quot;exit_code&quot;)
                  result[&quot;ExecTest.expected_exit_code&quot;] \
                      = str(self.exit_code)
              # Check to see if the standard output matches.
              if not self.__CompareText(stdout, self.stdout):
                  causes.append(&quot;standard output&quot;)
                  result[&quot;ExecTest.expected_stdout&quot;] \
                      = &quot;&lt;pre&gt;&quot; + self.stdout + &quot;&lt;/pre&gt;&quot;
              # Check to see that the standard error matches.
              if not self.__CompareText(stderr, self.stderr):
                  causes.append(&quot;standard error&quot;)
                  result[&quot;ExecTest.expected_stderr&quot;] \
                      = &quot;&lt;pre&gt;&quot; + self.stderr + &quot;&lt;/pre&gt;&quot;
              # If anything went wrong, the test failed.
              if causes:
                  result.Fail(&quot;Unexpected %s.&quot; % string.join(causes, &quot;, &quot;)) 
Index: qm/test/doc/tour.xml
===================================================================
RCS file: /home/sc/Repository/qm/qm/test/doc/tour.xml,v
retrieving revision 1.7
diff -c -5 -p -r1.7 tour.xml
*** qm/test/doc/tour.xml	31 Jul 2003 23:17:50 -0000	1.7
--- qm/test/doc/tour.xml	26 Sep 2003 22:53:58 -0000
*************** QMTest running at <A HREF="http://127.0.0.1:1158/">http://127.0.0.1:1158/</A>
*** 294,309 ****
     because you're creating a different kind of test.  Enter
     &lt;literal&gt;echo test&lt;/literal&gt; in the &lt;guilabel&gt;Command&lt;/guilabel&gt;
     field.  This command will produce an output (the word
     &lt;literal&gt;test&lt;/literal&gt;), so find the &lt;guilabel&gt;Standard
     Output&lt;/guilabel&gt; box and enter &lt;literal&gt;test&lt;/literal&gt; in this
!    box.  Make sure to hit the &lt;keycap&gt;Return&lt;/keycap&gt; key after you
!    type &lt;literal&gt;test&lt;/literal&gt;; the &lt;command&gt;echo&lt;/command&gt; command
!    will output a carriage return after it prints the word
!    &lt;literal&gt;test&lt;/literal&gt;, so you must indicate that you expect a
!    carriage return.  When you are done, click the
!    &lt;guibutton&gt;OK&lt;/guibutton&gt; button at the bottom of the form.&lt;/para&gt;
  
     &lt;para&gt;Now you can select &lt;guibutton&gt;This Test&lt;/guibutton&gt; from the
     &lt;guilabel&gt;Run&lt;/guilabel&gt; menu to run the test.&lt;/para&gt;
  
     &lt;para&gt;When you're done experimenting with &amp;qmtest, choose
--- 294,305 ----
     because you're creating a different kind of test.  Enter
     &lt;literal&gt;echo test&lt;/literal&gt; in the &lt;guilabel&gt;Command&lt;/guilabel&gt;
     field.  This command will produce an output (the word
     &lt;literal&gt;test&lt;/literal&gt;), so find the &lt;guilabel&gt;Standard
     Output&lt;/guilabel&gt; box and enter &lt;literal&gt;test&lt;/literal&gt; in this
!    box.  When you are done, click the &lt;guibutton&gt;OK&lt;/guibutton&gt; button
!    at the bottom of the form.&lt;/para&gt;
  
     &lt;para&gt;Now you can select &lt;guibutton&gt;This Test&lt;/guibutton&gt; from the
     &lt;guilabel&gt;Run&lt;/guilabel&gt; menu to run the test.&lt;/para&gt;
  
     &lt;para&gt;When you're done experimenting with &amp;qmtest, choose

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000526.html">PATCH: Timeouts for Windows
</A></li>
	<LI>Next message: <A HREF="000528.html">PATCH: Add --help support for &quot;qmtest remote&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#527">[ date ]</a>
              <a href="thread.html#527">[ thread ]</a>
              <a href="subject.html#527">[ subject ]</a>
              <a href="author.html#527">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/qmtest">More information about the qmtest
mailing list</a><br>
</body></html>
