Index: qm/test/classes/command.py
===================================================================
RCS file: /home/qm/Repository/qm/qm/test/classes/command.py,v
retrieving revision 1.45
diff -u -r1.45 command.py
--- qm/test/classes/command.py	31 Mar 2004 10:32:45 -0000	1.45
+++ qm/test/classes/command.py	19 May 2005 14:31:32 -0000
@@ -137,6 +137,13 @@
         environment = os.environ.copy()
         # Copy context variables into the environment.
         for key, value in context.items():
+            # If the value has unicode type, only transfer
+            # it if it can be cast to str.
+            if  isinstance(value, unicode):
+                try:
+                    value = str(value)
+                except UnicodeEncodeError:
+                    continue
             if  isinstance(value, str):
                 name = "QMV_" + key.replace(".", "__")
                 environment[name] = value
