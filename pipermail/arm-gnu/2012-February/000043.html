<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [arm-gnu] Compiler versions other than 2009q3-68 all fail??
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:arm-gnu%40codesourcery.com?Subject=Re%3A%20%5Barm-gnu%5D%20Compiler%20versions%20other%20than%202009q3-68%20all%20fail%3F%3F&In-Reply-To=%3C91dca237a43f1b99699ae67dc5460e41.squirrel%40chinstruments.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000042.html">
   <LINK REL="Next"  HREF="000041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[arm-gnu] Compiler versions other than 2009q3-68 all fail??</H1>
    <B>chen at chinstruments.com</B> 
    <A HREF="mailto:arm-gnu%40codesourcery.com?Subject=Re%3A%20%5Barm-gnu%5D%20Compiler%20versions%20other%20than%202009q3-68%20all%20fail%3F%3F&In-Reply-To=%3C91dca237a43f1b99699ae67dc5460e41.squirrel%40chinstruments.com%3E"
       TITLE="[arm-gnu] Compiler versions other than 2009q3-68 all fail??">chen at chinstruments.com
       </A><BR>
    <I>Mon Feb  6 21:49:19 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000042.html">[arm-gnu] Compiler versions other than 2009q3-68 all fail??
</A></li>
        <LI>Next message: <A HREF="000041.html">[arm-gnu] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43">[ date ]</a>
              <a href="thread.html#43">[ thread ]</a>
              <a href="subject.html#43">[ subject ]</a>
              <a href="author.html#43">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, Sergei,

Thank you for the helpful tips, and sorry for not providing a concise
example!  I did not write the code myself; I was only porting it to an
unsupported processor.

Stepping through the disassembly for the simpler serial port application
revealed the need for an additional compiler flag:

-fno-zero-initialized-in-bss

Adding this flag resolved the &quot;regressions&quot; in both the serial port and
the USB applications when compiled with 2011.09.  This flag was not
required for 2009q3, which apparently was more lenient.  Older compiler
versions were not tested.

Best,
Jonathan


Reference
&lt;<A HREF="http://gcc.gnu.org/ml/gcc-help/2007-07/msg00097.html">http://gcc.gnu.org/ml/gcc-help/2007-07/msg00097.html</A>&gt;

Serial port source code
&lt;<A HREF="http://e2e.ti.com/support/embedded/starterware/f/790/t/160340.aspx#592941">http://e2e.ti.com/support/embedded/starterware/f/790/t/160340.aspx#592941</A>&gt;




&gt;<i> Hi Chen,
</I>&gt;<i>
</I>&gt;<i> Generally, such regression suggests some problems in the code (btw -
</I>&gt;<i> please consider to reduce the whole project to some easily-read example
</I>&gt;<i> which causes regression. It will help you to point down the problem).
</I>&gt;<i>
</I>&gt;<i> I'd suggest the following:
</I>&gt;<i>  - Add &quot;-Wall&quot; to the compiler CFLAGS (if not already added) and address
</I>&gt;<i> all warnings.
</I>&gt;<i>  - Check that all references to the hardware registers in the source
</I>&gt;<i> code are not optimized out by the compiler (use &quot;volatile&quot; where
</I>&gt;<i> appropriate).
</I>&gt;<i>  - Check/compare the actual code generated by the toolchain (use
</I>&gt;<i> &quot;arm-non-eabi-objdump -d&quot;).
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Sergei
</I>&gt;<i>
</I>&gt;<i> On Thu, 2012-02-02 at 19:50 -0600, <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">chen at chinstruments.com</A> wrote:
</I>&gt;&gt;<i> resend as plain text (no html or attachment)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ---------------------------- Original Message
</I>&gt;&gt;<i> ----------------------------
</I>&gt;&gt;<i> Subject: Compiler versions other than 2009q3-68 all fail??
</I>&gt;&gt;<i> Date:    Thu, February 2, 2012 2:20 pm
</I>&gt;&gt;<i> To:      <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">arm-gnu at codesourcery.com</A>
</I>&gt;&gt;<i> --------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have code (linked below) that only runs correctly when compiled only
</I>&gt;&gt;<i> with arm-none-eabi version 2009q3-68; the application fails when
</I>&gt;&gt;<i> compiled
</I>&gt;&gt;<i> with *both newer and older versions* of arm-none-eabi.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The problems were observed on TI's AM1707 EVM Rev. H (ARM926EJ-S core).
</I>&gt;&gt;<i> The code is a bare metal application that runs the EVM board as a
</I>&gt;&gt;<i> generic
</I>&gt;&gt;<i> USB bulk device, with console output via serial port interrupts.  Using
</I>&gt;&gt;<i> the same code and EVM board, different behavior is obtained when using
</I>&gt;&gt;<i> different compiler versions (no internal compiler errors for any
</I>&gt;&gt;<i> version):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Older CodeSourcery versions (2009q1-161 and older, through 2008)
</I>&gt;&gt;<i> ---------------------------
</I>&gt;&gt;<i>   *  Everything works fine when run from debugger, but...
</I>&gt;&gt;<i>   *  USB enumeration fails, but only when application is flashed to the
</I>&gt;&gt;<i> board
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Newer CodeSourcery versions (2010q1-188 to 2011.09-69)
</I>&gt;&gt;<i> ---------------------------
</I>&gt;&gt;<i>   *  Serial port outputs as gibberish via interrupts (both from debugger
</I>&gt;&gt;<i> and when flashed)
</I>&gt;&gt;<i>   *  USB enumeration fails (both from debugger and when flashed)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> CodeSourcery G++ Lite version 2009q3-68
</I>&gt;&gt;<i> ---------------------------------------
</I>&gt;&gt;<i>   *  Everything works correctly!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   *  Serial port output works correctly (both from debugger and when
</I>&gt;&gt;<i> flashed)
</I>&gt;&gt;<i>   *  USB enumeration and data transfer work correctly (both from
</I>&gt;&gt;<i> debugger
</I>&gt;&gt;<i> and when flashed)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Source code + makefile + long description
</I>&gt;&gt;<i> &lt;<A HREF="http://e2e.ti.com/support/embedded/starterware/f/790/t/151682.aspx?PageIndex=2#584582">http://e2e.ti.com/support/embedded/starterware/f/790/t/151682.aspx?PageIndex=2#584582</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> More on serial port regression
</I>&gt;&gt;<i> &lt;<A HREF="http://e2e.ti.com/support/embedded/starterware/f/790/t/160340.aspx">http://e2e.ti.com/support/embedded/starterware/f/790/t/160340.aspx</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Serial port only code (no USB)
</I>&gt;&gt;<i> &lt;<A HREF="http://e2e.ti.com/support/embedded/starterware/f/790/t/151682.aspx#570450">http://e2e.ti.com/support/embedded/starterware/f/790/t/151682.aspx#570450</A>&gt;
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> arm-gnu mailing list
</I>&gt;&gt;<i> <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">arm-gnu at codesourcery.com</A>
</I>&gt;&gt;<i> <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000042.html">[arm-gnu] Compiler versions other than 2009q3-68 all fail??
</A></li>
	<LI>Next message: <A HREF="000041.html">[arm-gnu] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43">[ date ]</a>
              <a href="thread.html#43">[ thread ]</a>
              <a href="subject.html#43">[ subject ]</a>
              <a href="author.html#43">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">More information about the arm-gnu
mailing list</a><br>
</body></html>
