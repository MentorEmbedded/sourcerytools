<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;font-size:12pt&quot;&gt;&lt;div&gt;&lt;span&gt;I'm&nbsp;interested&nbsp;in&nbsp;what&nbsp;you&nbsp;did,&nbsp;but&nbsp;the&nbsp;attached&nbsp;file&nbsp;is&nbsp;formatted&nbsp;badly&nbsp;so&nbsp;I'm&nbsp;having&nbsp;a&nbsp;lot&nbsp;of&nbsp;trouble&nbsp;following&nbsp;it.&nbsp;&nbsp;One&nbsp;line&nbsp;is&nbsp;800&nbsp;characters&nbsp;long;&nbsp;the&nbsp;formatting&nbsp;probably&nbsp;got&nbsp;screwed&nbsp;up.&nbsp;&nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;I've&nbsp;been&nbsp;coming&nbsp;to&nbsp;the&nbsp;realization&nbsp;that&nbsp;I&nbsp;have&nbsp;to&nbsp;define&nbsp;sections&nbsp;to&nbsp;do&nbsp;this.&nbsp;&nbsp;But&nbsp;what&nbsp;I&nbsp;don't&nbsp;understand&nbsp;is&nbsp;how,&nbsp;when&nbsp;the&nbsp;RAM&nbsp;is&nbsp;split&nbsp;into&nbsp;three&nbsp;or&nbsp;more&nbsp;sections,&nbsp;will&nbsp;the&nbsp;linker&nbsp;treat&nbsp;the&nbsp;multiple&nbsp;&quot;available&quot;&nbsp;sections.&nbsp;&nbsp;Let&nbsp;me&nbsp;explain.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;Out&nbsp;of&nbsp;the&nbsp;96K&nbsp;RAM,&nbsp;it&nbsp;ends&nbsp;up&nbsp;being&nbsp;allocated&nbsp;roughly&nbsp;like&nbsp;this&nbsp;with&nbsp;one&nbsp;section:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;0K&nbsp;-&nbsp;12K&nbsp;:&nbsp;global&nbsp;and&nbsp;static&nbsp;variables&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;12K&nbsp;-&nbsp;96K&nbsp;:&nbsp;available&nbsp;for&nbsp;dynamic<br>
&nbsp;allocation&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;I&nbsp;can't&nbsp;place&nbsp;these&nbsp;16&nbsp;bytes&nbsp;into&nbsp;the&nbsp;latter&nbsp;area&nbsp;since&nbsp;it's&nbsp;the&nbsp;heap.&nbsp;&nbsp;But,&nbsp;it&nbsp;can&nbsp;go&nbsp;into&nbsp;the&nbsp;first&nbsp;area.&nbsp;&nbsp;So&nbsp;say&nbsp;I&nbsp;split&nbsp;it&nbsp;into&nbsp;sections&nbsp;of&nbsp;roughly&nbsp;these&nbsp;sizes:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;.section1:&nbsp;0&nbsp;-&nbsp;464&nbsp;bytes:&nbsp;&lt;/span&gt;&lt;span&gt;global&nbsp;and&nbsp;static&nbsp;variables&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;.section2:&nbsp;464&nbsp;bytes&nbsp;-&nbsp;480&nbsp;bytes:&nbsp;DMA&nbsp;structure&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;.section3:&nbsp;480bytes&nbsp;-&nbsp;96K:&nbsp;&lt;/span&gt;&lt;span&gt;global,&nbsp;static&nbsp;variables,&nbsp;and&nbsp;heap&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;The&nbsp;question&nbsp;is,&nbsp;how&nbsp;do&nbsp;I&nbsp;tell&nbsp;the&nbsp;linker&nbsp;that&nbsp;.section1&nbsp;and&nbsp;.section2&nbsp;should&nbsp;be&nbsp;treated&nbsp;equally,&nbsp;that&nbsp;is,&nbsp;both&nbsp;are&nbsp;available&nbsp;for&nbsp;automatic&nbsp;allocation&nbsp;by&nbsp;the&nbsp;linker?&nbsp;&nbsp;The&nbsp;answer&nbsp;may&nbsp;be&nbsp;in&nbsp;Bob's&nbsp;linker&nbsp;file,&nbsp;but&nbsp;I'm&nbsp;really&nbsp;ignorant&nbsp;about&nbsp;linker&nbsp;files&nbsp;(not&nbsp;that&nbsp;I&nbsp;haven't&nbsp;tried).&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;div<br>
&nbsp;style=&quot;font-family:&nbsp;times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&nbsp;&lt;div&nbsp;style=&quot;font-family:&nbsp;times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&lt;font&nbsp;face=&quot;Arial&quot;&nbsp;size=&quot;2&quot;&gt;&nbsp;&lt;hr&nbsp;size=&quot;1&quot;&gt;&nbsp;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:bold;&quot;&gt;From:&lt;/span&gt;&lt;/b&gt;&nbsp;Bob&nbsp;Brusa&nbsp;&lt;bob.brusa@gmail.com&gt;&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;To:&lt;/span&gt;&lt;/b&gt;&nbsp;arm-gnu@codesourcery.com&nbsp;&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Sent:&lt;/span&gt;&lt;/b&gt;&nbsp;Thursday,&nbsp;April&nbsp;5,&nbsp;2012&nbsp;5:31&nbsp;AM&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Subject:&lt;/span&gt;&lt;/b&gt;&nbsp;Re:&nbsp;[arm-gnu]&nbsp;Placing&nbsp;variable&nbsp;at&nbsp;absolute&nbsp;address&nbsp;in&nbsp;RAM&lt;br&gt;&nbsp;&lt;/font&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;br&gt;<br>
Am&nbsp;04.04.2012&nbsp;16:33,&nbsp;schrieb&nbsp;JM:&lt;br&gt;&gt;&nbsp;Hello&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;I've&nbsp;researched&nbsp;this,&nbsp;asked&nbsp;on&nbsp;other&nbsp;forums,&nbsp;and&nbsp;so&nbsp;far&nbsp;I'm&nbsp;no&nbsp;closer.&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;place&nbsp;a&nbsp;variable&nbsp;at&nbsp;a&nbsp;specific&nbsp;address&nbsp;in&nbsp;RAM&nbsp;on&nbsp;a&nbsp;TI&nbsp;ARM&lt;br&gt;&gt;&nbsp;Cortex-M3.&nbsp;I&nbsp;have&nbsp;good&nbsp;reason&nbsp;for&nbsp;doing&nbsp;so,&nbsp;which&nbsp;I&nbsp;can&nbsp;explain&nbsp;briefly:&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;The&nbsp;micro&nbsp;I'm&nbsp;using,&nbsp;LM3S9B92&nbsp;has&nbsp;a&nbsp;DMA&nbsp;controller.&nbsp;There&nbsp;are&nbsp;32&nbsp;DMA&lt;br&gt;&gt;&nbsp;channels&nbsp;and&nbsp;each&nbsp;channel&nbsp;requires&nbsp;a&nbsp;16&nbsp;byte&nbsp;struct&nbsp;in&nbsp;RAM&nbsp;for&lt;br&gt;&gt;&nbsp;housekeeping.&nbsp;These&nbsp;32&nbsp;structs&nbsp;are&nbsp;placed&nbsp;into&nbsp;an&nbsp;array,&nbsp;which&nbsp;is&nbsp;512&lt;br&gt;&gt;&nbsp;bytes&nbsp;if&nbsp;you&nbsp;do&nbsp;the&nbsp;math,&nbsp;and&nbsp;must&nbsp;be&nbsp;placed&nbsp;on&nbsp;a&nbsp;1024&nbsp;byte&nbsp;boundary.&lt;br&gt;&gt;&nbsp;Now....the&nbsp;datasheet&nbsp;indicates&nbsp;that&nbsp;the&nbsp;RAM&nbsp;for&nbsp;unused&nbsp;DMA&nbsp;channels&nbsp;can&lt;br&gt;&gt;&nbsp;be&nbsp;used&nbsp;for&nbsp;something&nbsp;else.&nbsp;I'm&nbsp;using&nbsp;only&nbsp;one&nbsp;DMA&nbsp;channel,&nbsp;which&nbsp;is&lt;br&gt;&gt;&nbsp;near&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;list.&nbsp;If&nbsp;it&nbsp;were&nbsp;near&nbsp;the&nbsp;beginning,&nbsp;this&nbsp;would&nbsp;be&lt;br&gt;&gt;&nbsp;easier&nbsp;to&nbsp;recover&nbsp;at&nbsp;least&nbsp;some&nbsp;of&nbsp;the&nbsp;wasted&nbsp;RAM&nbsp;by&nbsp;simply&nbsp;not&nbsp;making&lt;br&gt;&gt;&nbsp;the&nbsp;array&nbsp;32&nbsp;members<br>
&nbsp;long.&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;So&nbsp;what&nbsp;I&nbsp;want&nbsp;to&nbsp;do&nbsp;is&nbsp;reserve&nbsp;16&nbsp;bytes&nbsp;of&nbsp;RAM&nbsp;at&nbsp;a&nbsp;strategic&nbsp;location.&lt;br&gt;&gt;&nbsp;It&nbsp;must&nbsp;be&nbsp;464&nbsp;bytes&nbsp;from&nbsp;a&nbsp;1024&nbsp;byte&nbsp;boundary.&nbsp;This&nbsp;I&nbsp;believe&nbsp;will&lt;br&gt;&gt;&nbsp;allow&nbsp;the&nbsp;lone&nbsp;DMA&nbsp;channel&nbsp;to&nbsp;function&nbsp;and&nbsp;not&nbsp;allocate&nbsp;unused&nbsp;RAM.&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;I&nbsp;believe&nbsp;this&nbsp;will&nbsp;involve&nbsp;the&nbsp;linker&nbsp;script,&nbsp;and&nbsp;possibly&nbsp;Makefile.&lt;br&gt;&gt;&nbsp;I'm&nbsp;ok&nbsp;with&nbsp;Makefile&nbsp;modifications.&nbsp;The&nbsp;linker&nbsp;file&nbsp;I'm&nbsp;almost&nbsp;clueless&lt;br&gt;&gt;&nbsp;on.&nbsp;Any&nbsp;ideas?&nbsp;My&nbsp;current&nbsp;linker&nbsp;file&nbsp;is&nbsp;below:&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;MEMORY&lt;br&gt;&gt;&nbsp;{&lt;br&gt;&gt;&nbsp;FLASH&nbsp;(rx)&nbsp;:&nbsp;ORIGIN&nbsp;=&nbsp;0x00001000,&nbsp;LENGTH&nbsp;=&nbsp;252K&lt;br&gt;&gt;&nbsp;SRAM&nbsp;(rwx)&nbsp;:&nbsp;ORIGIN&nbsp;=&nbsp;0x20000000,&nbsp;LENGTH&nbsp;=&nbsp;96K&lt;br&gt;&gt;&nbsp;}&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;SECTIONS&lt;br&gt;&gt;&nbsp;{&lt;br&gt;&gt;&nbsp;.text&nbsp;:&lt;br&gt;&gt;&nbsp;{&lt;br&gt;&gt;&nbsp;KEEP(*(.isr_vector))&lt;br&gt;&gt;&nbsp;*(.text*)&lt;br&gt;&gt;&nbsp;*(.rodata*)&lt;br&gt;&gt;&nbsp;_etext&nbsp;=&nbsp;.;&lt;br&gt;&gt;&nbsp;}&nbsp;&gt;&nbsp;FLASH&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;.data&nbsp;:&nbsp;AT&nbsp;(ADDR(.text)&nbsp;+&nbsp;SIZEOF(.text))&lt;br&gt;&gt;&nbsp;{&lt;br&gt;&gt;&nbsp;_data&nbsp;=&nbsp;.;&lt;br&gt;&gt;&nbsp;*(vtable)&lt;br&gt;&gt;&nbsp;*(.data*)&lt;br&gt;&gt;&nbsp;_edata&nbsp;=&nbsp;.;&lt;br&gt;&gt;&nbsp;}&nbsp;&gt;<br>
&nbsp;SRAM&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;.bss(NOLOAD)&nbsp;:&lt;br&gt;&gt;&nbsp;{&lt;br&gt;&gt;&nbsp;_bss&nbsp;=&nbsp;.;&lt;br&gt;&gt;&nbsp;*(.bss*)&lt;br&gt;&gt;&nbsp;*(COMMON)&lt;br&gt;&gt;&nbsp;_ebss&nbsp;=&nbsp;.;&lt;br&gt;&gt;&nbsp;.&nbsp;=&nbsp;ALIGN&nbsp;(8);&lt;br&gt;&gt;&nbsp;_end&nbsp;=&nbsp;.;&lt;br&gt;&gt;&nbsp;}&nbsp;&gt;&nbsp;SRAM&lt;br&gt;&gt;&nbsp;}&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;/*&nbsp;end&nbsp;of&nbsp;allocated&nbsp;ram&nbsp;_end&nbsp;*/&lt;br&gt;&gt;&nbsp;PROVIDE(&nbsp;_HEAP_START&nbsp;=&nbsp;_end&nbsp;);&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;/*&nbsp;end&nbsp;of&nbsp;the&nbsp;heap&nbsp;-&gt;&nbsp;align&nbsp;8&nbsp;byte&nbsp;*/&lt;br&gt;&gt;&nbsp;PROVIDE&nbsp;(&nbsp;_HEAP_END&nbsp;=&nbsp;ALIGN(ORIGIN(SRAM)&nbsp;+&nbsp;LENGTH(SRAM),8)&nbsp;);&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;&gt;&nbsp;arm-gnu&nbsp;mailing&nbsp;list&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;ymailto=&quot;mailto:arm-gnu@codesourcery.com&quot;&nbsp;href=&quot;mailto:arm-gnu@codesourcery.com&quot;&gt;arm-gnu@codesourcery.com&lt;/a&gt;&lt;br&gt;&gt;&nbsp;http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu&lt;br&gt;Hi,&lt;br&gt;two&nbsp;years&nbsp;ago&nbsp;I&nbsp;had&nbsp;a&nbsp;similar&nbsp;problem.&nbsp;I&nbsp;needed&nbsp;an&nbsp;area&nbsp;at&nbsp;a&nbsp;fixed&nbsp;&lt;br&gt;address&nbsp;in&nbsp;flash&nbsp;and&nbsp;an&nbsp;other&nbsp;at&nbsp;a&nbsp;known&nbsp;place&nbsp;in&nbsp;ram&nbsp;-&nbsp;with&nbsp;the&nbsp;&lt;br&gt;requirement,&nbsp;that&nbsp;this&nbsp;part&nbsp;of&nbsp;the&nbsp;ram&nbsp;should&nbsp;not&nbsp;be&nbsp;initialized&nbsp;upon&nbsp;&lt;br&gt;startup&nbsp;of&nbsp;the<br>
&nbsp;program.&nbsp;And&nbsp;here&nbsp;is&nbsp;what&nbsp;I&nbsp;did:&lt;br&gt;&lt;br&gt;The&nbsp;trick&nbsp;is&nbsp;to&nbsp;define&nbsp;new&nbsp;sections.&nbsp;For&nbsp;the&nbsp;flash&nbsp;case&nbsp;I&nbsp;added&nbsp;the&nbsp;&lt;br&gt;following&nbsp;lines&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;relevant&nbsp;source:&lt;br&gt;&lt;br&gt;#define&nbsp;EEPromArea&nbsp;&nbsp;&nbsp;&nbsp;0x400&lt;br&gt;cyg_uint8&nbsp;eeprombottom[EEPromArea]&nbsp;&nbsp;__attribute__&nbsp;((section&nbsp;(&quot;.eeromemu&quot;)));&lt;br&gt;&lt;br&gt;and&nbsp;for&nbsp;the&nbsp;sram&nbsp;case&nbsp;(nvv_t&nbsp;is&nbsp;a&nbsp;user-defined&nbsp;type):&lt;br&gt;&lt;br&gt;nvv_t&nbsp;nvv&nbsp;__attribute__&nbsp;((section&nbsp;(&quot;.sticky&quot;)));&lt;br&gt;&lt;br&gt;The&nbsp;standard&nbsp;loader&nbsp;file&nbsp;then&nbsp;needs&nbsp;a&nbsp;few&nbsp;modifications&nbsp;-&nbsp;see&nbsp;attachment.&lt;br&gt;&lt;br&gt;Hope&nbsp;this&nbsp;helps.&lt;br&gt;Regards&nbsp;Bob&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;arm-gnu&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;ymailto=&quot;mailto:arm-gnu@codesourcery.com&quot;&nbsp;href=&quot;mailto:arm-gnu@codesourcery.com&quot;&gt;arm-gnu@codesourcery.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
