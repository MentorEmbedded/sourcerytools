<tt>
&lt;font&nbsp;face=&quot;arial&quot;&nbsp;size=&quot;2&quot;&gt;&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;The&nbsp;above&nbsp;problem&nbsp;is&nbsp;causing&nbsp;a&nbsp;Hard&nbsp;Fault.&nbsp;&nbsp;I&nbsp;can&nbsp;get&nbsp;around&nbsp;it&nbsp;by&nbsp;forcing&nbsp;full-word&nbsp;alignment&nbsp;of&nbsp;the&nbsp;array&nbsp;causing&nbsp;the&nbsp;problem.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;arm-none-eabi-gcc&nbsp;--version&nbsp;reports:&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;arm-none-eabi-gcc&nbsp;(Sourcery&nbsp;CodeBench&nbsp;Lite&nbsp;2011.09-69)&nbsp;4.6.1&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;I'm&nbsp;cross-compiling&nbsp;on&nbsp;windows&nbsp;for&nbsp;armv7-m&nbsp;(m3)&nbsp;with&nbsp;the&nbsp;following&nbsp;cflags:&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;-mthumb&nbsp;-march=armv7-m&nbsp;-mfix-cortex-m3-ldrd&nbsp;-D__thumb&nbsp;-mno-thumb-interwork&nbsp;-mthumb&nbsp;-mcpu=cortex-m3&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;-Wall&nbsp;-Werr&nbsp;-Os&nbsp;-g&nbsp;-Wno-pointer-sign&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;The&nbsp;following&nbsp;describes&nbsp;how&nbsp;I&nbsp;get&nbsp;the&nbsp;problm:&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;1)&nbsp;I&nbsp;have&nbsp;a&nbsp;structure&nbsp;(first_struct)&nbsp;that&nbsp;in&nbsp;the&nbsp;middle,&nbsp;has&nbsp;an&nbsp;array&nbsp;of&nbsp;&quot;char&quot;&nbsp;(c).&nbsp;&nbsp;Due&nbsp;to&nbsp;the&nbsp;preceeding&nbsp;fields&nbsp;in&nbsp;the&nbsp;structure,&nbsp;this&nbsp;array&nbsp;is&nbsp;on&nbsp;half-word&nbsp;alignment.&nbsp;&nbsp;I&nbsp;have&nbsp;a&nbsp;second&nbsp;structure&nbsp;(second_struct)&nbsp;that&nbsp;has&nbsp;two&nbsp;ints&nbsp;(32-bit)&nbsp;at&nbsp;the&nbsp;top.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;2)&nbsp;I&nbsp;have&nbsp;a&nbsp;function&nbsp;(first_function)&nbsp;that&nbsp;takes&nbsp;a&nbsp;void&nbsp;pointer&nbsp;as&nbsp;an&nbsp;argument,&nbsp;immediately&nbsp;assigns&nbsp;that&nbsp;argument&nbsp;to&nbsp;a&nbsp;structure&nbsp;pointer&nbsp;(so&nbsp;that&nbsp;it&nbsp;can&nbsp;reference&nbsp;the&nbsp;buffer&nbsp;as&nbsp;a&nbsp;structure),&nbsp;and&nbsp;references&nbsp;the&nbsp;first&nbsp;two&nbsp;fields&nbsp;(both&nbsp;full-word&nbsp;types).&nbsp;&nbsp;For&nbsp;efficiency,&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;an&nbsp;assembly&nbsp;instruction&nbsp;&quot;ldi&nbsp;r0,&nbsp;{r4,&nbsp;r7}&quot;&nbsp;to&nbsp;load&nbsp;the&nbsp;first&nbsp;two&nbsp;32-bit&nbsp;values&nbsp;into&nbsp;registers.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;3)&nbsp;A&nbsp;second_function&nbsp;passes&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;array&nbsp;of&nbsp;&quot;char&quot;&nbsp;in&nbsp;first_struct&nbsp;to&nbsp;first_function.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;4)&nbsp;When&nbsp;the&nbsp;LDM&nbsp;in&nbsp;step&nbsp;2&nbsp;(above)&nbsp;executes,&nbsp;I&nbsp;get&nbsp;a&nbsp;hard-fault,&nbsp;since&nbsp;the&nbsp;LDM&nbsp;requires&nbsp;full-word&nbsp;alignment&nbsp;of&nbsp;the&nbsp;address&nbsp;in&nbsp;(r0).&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;Is&nbsp;there&nbsp;a&nbsp;compile&nbsp;flag&nbsp;that&nbsp;will&nbsp;prevent&nbsp;this&nbsp;alignment&nbsp;problem,&nbsp;either&nbsp;in&nbsp;the&nbsp;initial&nbsp;structure&nbsp;layout,&nbsp;or&nbsp;by&nbsp;not&nbsp;using&nbsp;the&nbsp;ldm&nbsp;in&nbsp;target&nbsp;function&nbsp;for&nbsp;this&nbsp;case?&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;Example:&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;struct&nbsp;first_struct&nbsp;{&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;a;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;b;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;c[100];&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;}&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;struct&nbsp;second_struct&nbsp;{&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;x;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;y;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;}&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;void&nbsp;first_function(void&nbsp;*mystruct)&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;{&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;second_struct&nbsp;*zz&nbsp;=&nbsp;(struct&nbsp;second_struct&nbsp;*)&nbsp;mystruct;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;aaa;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;bbb;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aaa&nbsp;=&nbsp;zz-&gt;x;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bbb&nbsp;=&nbsp;zz-&gt;y;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;}&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;void&nbsp;second_function(void)&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;{&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;first_struct&nbsp;local;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy&nbsp;(&amp;local-&gt;c[0],SOME_ARRAY,sizeof(local-&gt;c));&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first_function(&amp;local-&gt;c[0];&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;}&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0;padding:0;&quot;&gt;&nbsp;&lt;/p&gt;&lt;/font&gt;
</tt>
