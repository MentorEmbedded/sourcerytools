<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;font-size:12pt&quot;&gt;&lt;div&gt;&lt;span&gt;The&nbsp;custom&nbsp;allocator&nbsp;could&nbsp;work,&nbsp;but&nbsp;I&nbsp;can&nbsp;see&nbsp;some&nbsp;problems&nbsp;with&nbsp;that&nbsp;in&nbsp;my&nbsp;application.&nbsp;&nbsp;Actually&nbsp;setting&nbsp;up&nbsp;the&nbsp;multiple&nbsp;regions&nbsp;in&nbsp;the&nbsp;linker&nbsp;isn't&nbsp;so&nbsp;bad,&nbsp;but&nbsp;I've&nbsp;run&nbsp;into&nbsp;a&nbsp;problem&nbsp;maybe&nbsp;somebody&nbsp;can&nbsp;shed&nbsp;some&nbsp;light&nbsp;on.&nbsp;&nbsp;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;I&nbsp;manually&nbsp;chose&nbsp;several&nbsp;static&nbsp;and&nbsp;global&nbsp;variables&nbsp;to&nbsp;go&nbsp;into&nbsp;SRAM1&nbsp;using&nbsp;&quot;__attribute__&nbsp;((section(&quot;.sram1&quot;)))&quot;,&nbsp;and&nbsp;this&nbsp;works&nbsp;pretty&nbsp;well&nbsp;linker-wise.&nbsp;&nbsp;The&nbsp;problem&nbsp;is,&nbsp;some&nbsp;of&nbsp;these&nbsp;variables&nbsp;no&nbsp;longer&nbsp;function.&nbsp;&nbsp;I&nbsp;can't&nbsp;say&nbsp;how&nbsp;exactly&nbsp;because&nbsp;they&nbsp;are&nbsp;from&nbsp;a&nbsp;third&nbsp;party&nbsp;library&nbsp;(lwIP)&nbsp;and&nbsp;I&nbsp;haven't&nbsp;debugged&nbsp;yet,&nbsp;but&nbsp;I&nbsp;know&nbsp;if&nbsp;I&nbsp;let&nbsp;the&nbsp;linker&nbsp;allocate&nbsp;automatically,&nbsp;they're&nbsp;ok.&nbsp;&nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;All&nbsp;these&nbsp;variables&nbsp;that&nbsp;cause&nbsp;issues&nbsp;are&nbsp;static.&nbsp;&nbsp;However,&nbsp;being<br>
&nbsp;static&nbsp;itself&nbsp;doesn't&nbsp;seem&nbsp;to&nbsp;be&nbsp;problematic,&nbsp;that&nbsp;is,&nbsp;some&nbsp;static&nbsp;variables&nbsp;are&nbsp;happy&nbsp;there.&nbsp;&nbsp;Is&nbsp;there&nbsp;any&nbsp;problem&nbsp;with&nbsp;putting&nbsp;static&nbsp;variables&nbsp;in&nbsp;to&nbsp;region&nbsp;SRAM1&nbsp;that&nbsp;anyone&nbsp;can&nbsp;see?&nbsp;&nbsp;I&nbsp;assume&nbsp;there's&nbsp;a&nbsp;simple&nbsp;answer&nbsp;to&nbsp;this.&nbsp;&nbsp;New&nbsp;linker&nbsp;below:&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;MEMORY&lt;br&gt;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;FLASH&nbsp;(rx)&nbsp;:&nbsp;ORIGIN&nbsp;=&nbsp;0x00001000,&nbsp;LENGTH&nbsp;=&nbsp;252K&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;SRAM1&nbsp;(rwx)&nbsp;:&nbsp;ORIGIN&nbsp;=&nbsp;0x20000000,&nbsp;LENGTH&nbsp;=&nbsp;464&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;DMA&nbsp;(rwx)&nbsp;:&nbsp;ORIGIN&nbsp;=&nbsp;0x200001D0,&nbsp;LENGTH&nbsp;=&nbsp;16&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;SRAM2&nbsp;(rwx)&nbsp;:&nbsp;ORIGIN&nbsp;=&nbsp;0x200001E0,&nbsp;LENGTH&nbsp;=&nbsp;97824&lt;br&gt;}&lt;br&gt;&lt;br&gt;SECTIONS&lt;br&gt;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;.text&nbsp;:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEEP(*(.isr_vector))&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(.text*)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(.rodata*)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_etext&nbsp;=<br>
&nbsp;.;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&gt;&nbsp;FLASH&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;.data&nbsp;:&nbsp;AT&nbsp;(ADDR(.text)&nbsp;+&nbsp;SIZEOF(.text))&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_data&nbsp;=&nbsp;.;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(vtable)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(.data*)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_edata&nbsp;=&nbsp;.;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&gt;&nbsp;SRAM2&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;.bss(NOLOAD)&nbsp;:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_bss&nbsp;=&nbsp;.;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(.bss*)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(COMMON)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ebss&nbsp;=&nbsp;.;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.&nbsp;=&nbsp;ALIGN&nbsp;(8);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_end&nbsp;=&nbsp;.;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&gt;&nbsp;SRAM2&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;.dmaRegisters&nbsp;&nbsp;0x200001D0&nbsp;(NOLOAD)&nbsp;:&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(.dmaRegisters)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&gt;&nbsp;DMA&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;.sram1&nbsp;&nbsp;0x20000000&nbsp;(NOLOAD)&nbsp;:&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(.sram1)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&gt;&nbsp;SRAM1&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;}&lt;br&gt;&lt;br&gt;/*&nbsp;end&nbsp;of&nbsp;allocated&nbsp;ram&nbsp;_end&nbsp;*/&lt;br&gt;PROVIDE(&nbsp;_HEAP_START&nbsp;=&nbsp;_end&nbsp;);&lt;br&gt;&lt;br&gt;/*&nbsp;end&nbsp;of&nbsp;the&nbsp;heap&nbsp;-&gt;&nbsp;align&nbsp;8&nbsp;byte&nbsp;*/&nbsp;&lt;br&gt;PROVIDE&nbsp;(&nbsp;_HEAP_END&nbsp;=&nbsp;ALIGN(ORIGIN(SRAM2)&nbsp;+&nbsp;LENGTH(SRAM2),8)&nbsp;);&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;div&nbsp;style=&quot;font-family:&nbsp;times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&nbsp;&lt;div&nbsp;style=&quot;font-family:&nbsp;times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&lt;font&nbsp;face=&quot;Arial&quot;&nbsp;size=&quot;2&quot;&gt;&nbsp;&lt;hr&nbsp;size=&quot;1&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:bold;&quot;&gt;&lt;/span&gt;&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;A&nbsp;simple&nbsp;sequential&nbsp;allocator&nbsp;for&nbsp;a&nbsp;system&nbsp;that&nbsp;allocates&nbsp;memory&nbsp;but&nbsp;doesn't&nbsp;free&nbsp;it.&nbsp;That's&nbsp;pretty&nbsp;common.&lt;br&gt;&lt;br&gt;This&nbsp;question&nbsp;has&nbsp;nothing&nbsp;to&nbsp;do&nbsp;with<br>
&nbsp;the&nbsp;compiler,&nbsp;and&nbsp;all&nbsp;of&nbsp;your&nbsp;questions&nbsp;on&nbsp;use&nbsp;of&nbsp;the&nbsp;linker&nbsp;should&nbsp;be&nbsp;answered&nbsp;in&nbsp;&quot;The&nbsp;Gnu&nbsp;Linker&nbsp;Manual&quot;&nbsp;which&nbsp;comes&nbsp;with&nbsp;a&nbsp;CodeSourcery&nbsp;distribution.&lt;br&gt;&lt;br&gt;&gt;&nbsp;If&nbsp;I&nbsp;did&nbsp;this&nbsp;in&nbsp;my&nbsp;case,&nbsp;it&nbsp;would&nbsp;leave&nbsp;400-500&lt;br&gt;&gt;&nbsp;bytes&nbsp;unused.&lt;br&gt;&lt;br&gt;I&nbsp;can&nbsp;think&nbsp;of&nbsp;at&nbsp;least&nbsp;three&nbsp;ways&nbsp;to&nbsp;solve&nbsp;this&nbsp;(before&nbsp;breakfast&nbsp;:-),&nbsp;but&nbsp;I'll&nbsp;only&nbsp;list&nbsp;two.&lt;br&gt;&lt;br&gt;The&nbsp;unnecessarily&nbsp;complicated&nbsp;sledgehammer-and-peanut&nbsp;way&nbsp;is&nbsp;to&nbsp;use&nbsp;the&nbsp;linker&nbsp;to&nbsp;declare&nbsp;THREE&nbsp;separate&nbsp;named&nbsp;memory&nbsp;regions.&nbsp;The&nbsp;&quot;tiny&nbsp;fixed&nbsp;address&nbsp;region&quot;&nbsp;that&nbsp;you&nbsp;need&nbsp;somewhere&nbsp;in&nbsp;the&nbsp;heap,&nbsp;the&nbsp;chunk&nbsp;before&nbsp;and&nbsp;the&nbsp;chunk&nbsp;after.&nbsp;You&nbsp;then&nbsp;modify&nbsp;your&nbsp;custom&nbsp;allocater&nbsp;to&nbsp;be&nbsp;smart&nbsp;enough&nbsp;to&nbsp;allocate&nbsp;from&nbsp;the&nbsp;TWO&nbsp;regions&nbsp;named&nbsp;in&nbsp;the&nbsp;linker.&nbsp;All&nbsp;it&nbsp;has&nbsp;to&nbsp;do&nbsp;is&nbsp;to&nbsp;try&nbsp;to&nbsp;allocate&nbsp;from&nbsp;the&nbsp;first,&nbsp;and&nbsp;if&nbsp;that&nbsp;fails,&nbsp;to&nbsp;allocate&nbsp;from&nbsp;the&nbsp;second&nbsp;instead.&nbsp;The&nbsp;first&nbsp;one&nbsp;will&nbsp;eventually&nbsp;fill&nbsp;up&nbsp;with&nbsp;small&nbsp;requests&nbsp;so&nbsp;you&nbsp;won't&nbsp;be&nbsp;wasting&nbsp;more&nbsp;than&nbsp;a&nbsp;few&nbsp;bytes.&nbsp;That's&nbsp;so&nbsp;simple&nbsp;it'd&nbsp;only&nbsp;take&nbsp;a&nbsp;few&nbsp;lines&nbsp;of&nbsp;code&nbsp;and&nbsp;two<br>
&nbsp;static&nbsp;variables&nbsp;at&nbsp;most.&lt;br&gt;&lt;br&gt;The&nbsp;really&nbsp;simple&nbsp;way&nbsp;is&nbsp;to&nbsp;have&nbsp;the&nbsp;Allocator&nbsp;able&nbsp;to&nbsp;handle&nbsp;two&nbsp;regions,&nbsp;and&nbsp;have&nbsp;it&nbsp;hard-allocate&nbsp;the&nbsp;DMA&nbsp;block&nbsp;during&nbsp;its&nbsp;initialisation&nbsp;and&nbsp;thereafter&nbsp;allocate&nbsp;from&nbsp;the&nbsp;region&nbsp;before&nbsp;and&nbsp;the&nbsp;region&nbsp;after&nbsp;like&nbsp;listed&nbsp;previously.&nbsp;That's&nbsp;what&nbsp;I'd&nbsp;do.&lt;br&gt;&lt;br&gt;Tom&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
