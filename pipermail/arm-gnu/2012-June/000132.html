<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [arm-gnu] Regarding Double Data Type Support on Cortex M4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:arm-gnu%40codesourcery.com?Subject=Re%3A%20%5Barm-gnu%5D%20Regarding%20Double%20Data%20Type%20Support%20on%20Cortex%20M4&In-Reply-To=%3C0M6kE0-1RoASv34WS-00wrA5%40mrelay.perfora.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000131.html">
   <LINK REL="Next"  HREF="000133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[arm-gnu] Regarding Double Data Type Support on Cortex M4</H1>
    <B>Vikas R</B> 
    <A HREF="mailto:arm-gnu%40codesourcery.com?Subject=Re%3A%20%5Barm-gnu%5D%20Regarding%20Double%20Data%20Type%20Support%20on%20Cortex%20M4&In-Reply-To=%3C0M6kE0-1RoASv34WS-00wrA5%40mrelay.perfora.net%3E"
       TITLE="[arm-gnu] Regarding Double Data Type Support on Cortex M4">vikasr at renuelectronics.com
       </A><BR>
    <I>Tue Jun  5 12:30:58 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000131.html">[arm-gnu] Regarding Double Data Type Support on Cortex M4
</A></li>
        <LI>Next message: <A HREF="000133.html">[arm-gnu] Regarding Double Data Type Support on Cortex M4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#132">[ date ]</a>
              <a href="thread.html#132">[ thread ]</a>
              <a href="subject.html#132">[ subject ]</a>
              <a href="author.html#132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Carlos,

           As per your suggestion we translated c code in to assembly. Here
are the findings :--

 Our C Code :- 

void double_test(void)
{
	volatile double AA = 10.2;
	volatile double BB = 10.2;
	volatile double CC = 5.1;

	if(AA == 10.2)
	{
		volatile int i;
		i = 0;
	}

	BB = AA;
}

Equivalent ASM code generated by compiler is ;--

double_test():

    d728:	b510      	push	{r4, lr}
    d72a:	a30e      	add	r3, pc, #56	;(adr r3, d764
&lt;double_test+0x3c&gt;)
    d72c:	e9d3 2300 	ldrd	r2, r3, [r3]
    d730:	a10e      	add	r1, pc, #56	;(adr r1, d76c
&lt;double_test+0x44&gt;)
    d732:	e9d1 0100 	ldrd	r0, r1, [r1]
    d736:	b088      	sub	sp, #32
    d738:	e9cd 2304 	strd	r2, r3, [sp, #16]
    d73c:	e9cd 2302 	strd	r2, r3, [sp, #8]
    d740:	e9cd 0100 	strd	r0, r1, [sp]
    d744:	e9dd 0104 	ldrd	r0, r1, [sp, #16]
    d748:	4c05      	ldr	r4, [pc, #20]; (d760
&lt;double_test+0x38&gt;)
    d74a:	47a0      	blx	r4
    d74c:	b108      	cbz	r0, d752 &lt;double_test+0x2a&gt;
    d74e:	2300      	movs	r3, #0
    d750:	9307      	str	r3, [sp, #28]
    d752:	e9dd 2304 	ldrd	r2, r3, [sp, #16]
    d756:	e9cd 2302 	strd	r2, r3, [sp, #8]
    d75a:	b008      	add	sp, #32
    d75c:	bd10      	pop	{r4, pc}
    d75e:	bf00      	nop
    d760:	000334b4 	.word	0x000334b4
    d764:	66666666 	.word	0x66666666
    d768:	40246666 	.word	0x40246666
    d76c:	66666666 	.word	0x66666666
    d770:	40146666 	.word	0x40146666
   

     Also corresponding map file is attached with this mail.

     Our Points :--
       1) When variables AA,BB and CC are not defined as volatile, hard
fault does not occure, because compiler is optimizing the code.
       2) Above code is generated by keeping FPU is enabled.



Thanks and Regards,

Vikas Raskar

-----Original Message-----
From: Carlos O'Donell [mailto:<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">carlos_odonell at mentor.com</A>] 
Sent: 04/06/2012 8:53 PM
To: <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">arm-gnu at codesourcery.com</A>; <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">vikasr at renuelectronics.com</A>; Freddie Chopin
Subject: Re: [arm-gnu] Regarding Double Data Type Support on Cortex M4

On 6/4/2012 2:22 AM, Vikas R wrote:
&gt;<i> Hello Carlos,
</I>&gt;<i>             Thanks for your prompt reply.
</I>&gt;<i> 
</I>&gt;<i>             I made changes suggested by you (i.e. I added
</I>`-mfpu=fpv4-sp-d16
&gt;<i> -mfloat-abi=softfp)option in command, but it is still not working.
</I>Processor
&gt;<i> goes in to hard fault for the &quot;double&quot; data types. 
</I>&gt;<i>
</I>&gt;<i>             I have also tried following command for emulated &quot;float&quot; data
</I>&gt;<i> type keeping FPU disabled but still not working. 
</I>&gt;<i> 
</I>&gt;<i> 		arm-none-eabi-gcc -Wall -mfpu=fpv4-sp-d16 -mfloat-abi=soft
</I>&gt;<i> -mcpu=cortex-m4 -mthumb -Qn -Os  -mlong-calls -c main.c -o main.o
</I>&gt;<i> 
</I>&gt;<i>            we are using Code Sourcery G++ Light Version 4.5.2.
</I>&gt;<i> 
</I>&gt;<i>           Is it possible to support &quot;float&quot; and &quot;double&quot; data types
</I>without
&gt;<i> enabling FPU?
</I>
[including the public list this time around]

Yes, that's what -mfloat-abi=soft does.

If `-mfloat-abi=soft' doesn't work then something else is wrong with your
application.

Try using `arm-none-eabi-objdump -ldr &lt;binary&gt;' and review the instructions
being used in your final application.

When you debug this *exactly* which instruction causes the fault?

Cheers,
Carlos.
-- 
Carlos O'Donell
Mentor Graphics / CodeSourcery
<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">carlos_odonell at mentor.com</A>
<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">carlos at codesourcery.com</A>
+1 (613) 963 1026
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Map.txt
URL: &lt;<A HREF="http://sourcerytools.com/pipermail/arm-gnu/attachments/20120605/3cf61f78/attachment.txt">http://sourcerytools.com/pipermail/arm-gnu/attachments/20120605/3cf61f78/attachment.txt</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000131.html">[arm-gnu] Regarding Double Data Type Support on Cortex M4
</A></li>
	<LI>Next message: <A HREF="000133.html">[arm-gnu] Regarding Double Data Type Support on Cortex M4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#132">[ date ]</a>
              <a href="thread.html#132">[ thread ]</a>
              <a href="subject.html#132">[ subject ]</a>
              <a href="author.html#132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/arm-gnu">More information about the arm-gnu
mailing list</a><br>
</body></html>
