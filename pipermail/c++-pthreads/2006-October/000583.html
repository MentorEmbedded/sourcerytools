<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [c++-pthreads] Initialization of local static mutex
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:c%2B%2B-pthreads%40codesourcery.com?Subject=Re%3A%20%5Bc%2B%2B-pthreads%5D%20Initialization%20of%20local%20static%20mutex&In-Reply-To=%3C45291361.8020605%40chello.at%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000592.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[c++-pthreads] Initialization of local static mutex</H1>
    <B>Roland Schwarz</B> 
    <A HREF="mailto:c%2B%2B-pthreads%40codesourcery.com?Subject=Re%3A%20%5Bc%2B%2B-pthreads%5D%20Initialization%20of%20local%20static%20mutex&In-Reply-To=%3C45291361.8020605%40chello.at%3E"
       TITLE="[c++-pthreads] Initialization of local static mutex">roland.schwarz at chello.at
       </A><BR>
    <I>Sun Oct  8 15:04:01 UTC 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000592.html">[c++-pthreads] Initialization of local static mutex
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#583">[ date ]</a>
              <a href="thread.html#583">[ thread ]</a>
              <a href="subject.html#583">[ subject ]</a>
              <a href="author.html#583">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Your answer does not yet silence my doubts:

George Shimanovich wrote:
 &gt; There will be no race condition between two static initializations and
 &gt; any static and non-static initialization:
 &gt; 1) The zero-initialization of static mutex is performed before its
 &gt; initialization with constant-expression PTHREAD_MUTEX_INITIALIZER

Ok, this is said by the first sentence of 6.7/4.

 &gt; 2) The initialization with that constant-expression occurs before any
 &gt; non-static initialization in foo

Ok, this is covered by the next sentence

 &gt; 3) Compiler makes sure that each static initialization is done only once

The 3) still puzzles me. If the compiler makes this sure, he has to
remember this fact somewhere, i.e. in a (global, hidden) state variable.
Access to this variable poses a race condition, and since the
PTHREAD_MUTEX_INITIALIZER might not be copied in an atomic manner, the
assignment itself is not thread safe.


Roland




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000592.html">[c++-pthreads] Initialization of local static mutex
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#583">[ date ]</a>
              <a href="thread.html#583">[ thread ]</a>
              <a href="subject.html#583">[ subject ]</a>
              <a href="author.html#583">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/c++-pthreads">More information about the c++-pthreads
mailing list</a><br>
</body></html>
