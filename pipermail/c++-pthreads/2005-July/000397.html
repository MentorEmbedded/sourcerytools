<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [c++-pthreads]  Re: pthread_cancel and EH: let's try this again
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:c%2B%2B-pthreads%40codesourcery.com?Subject=Re%3A%20%5Bc%2B%2B-pthreads%5D%20%20Re%3A%20pthread_cancel%20and%20EH%3A%20let%27s%20try%20this%20again&In-Reply-To=%3C42D84BBC.7060504%40hp.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000385.html">
   <LINK REL="Next"  HREF="000398.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[c++-pthreads]  Re: pthread_cancel and EH: let's try this again</H1>
    <B>Dave Butenhof</B> 
    <A HREF="mailto:c%2B%2B-pthreads%40codesourcery.com?Subject=Re%3A%20%5Bc%2B%2B-pthreads%5D%20%20Re%3A%20pthread_cancel%20and%20EH%3A%20let%27s%20try%20this%20again&In-Reply-To=%3C42D84BBC.7060504%40hp.com%3E"
       TITLE="[c++-pthreads]  Re: pthread_cancel and EH: let's try this again">david.butenhof at hp.com
       </A><BR>
    <I>Fri Jul 15 23:50:20 UTC 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000385.html">[c++-pthreads]  Re: pthread_cancel and EH: let's try this again
</A></li>
        <LI>Next message: <A HREF="000398.html">pthread_cancel and EH: let's try this again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#397">[ date ]</a>
              <a href="thread.html#397">[ thread ]</a>
              <a href="subject.html#397">[ subject ]</a>
              <a href="author.html#397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David Abrahams wrote:

&gt;<i>Dave Butenhof &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/c++-pthreads">david.butenhof at hp.com</A>&gt; writes:
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>OK, I'll admit to being in the privileged elite -- my principle 
</I>&gt;&gt;<i>development environment has been OpenVMS and Tru64 UNIX, both of which 
</I>&gt;&gt;<i>had architected common exception environments from the start and C 
</I>&gt;&gt;<i>compiler support to participate.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>Sure, in an ideal world all languages' exception systems should
</I>&gt;<i>interoperate.
</I>&gt;<i>  
</I>&gt;<i>
</I>The problem here for me is that so many consider this a &quot;nice but 
unrealistic&quot; goal; but it's something I've relied on and taken for 
granted for most of my professional career on OpenVMS and Tru64 UNIX. 
There's nothing unrealistic. And if you can implement a C++ exception 
runtime, you can implement and deploy a language-independent exception 
runtime everyone can share. This isn't rocket science -- just basic 
computer science.

&gt;&gt;<i>This is the way it SHOULD work. The only way it CAN work in the long
</I>&gt;&gt;<i>run. Unless you're planning to say &quot;C++ is C++, and you can't mix it
</I>&gt;&gt;<i>with anything else.&quot; (A very &quot;UNIX&quot; philosophy, perhaps; but one
</I>&gt;&gt;<i>with which I strongly disagree...
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>Me too.  Why would I want to isolate C++ that way?
</I>&gt;<i>  
</I>&gt;<i>
</I>Good.

&gt;&gt;<i>and I think also one that's highly impractical and unrealistic in
</I>&gt;&gt;<i>our current universe.)
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>And becoming less realistic as the IA64 ABI propagates itself.
</I>&gt;<i>However, it does seem likely that interpreted languages such as Python
</I>&gt;<i>will not be able to easily achieve such smooth interoperability, even
</I>&gt;<i>where the ABI is adopted.
</I>&gt;<i>  
</I>&gt;<i>
</I>Java does. Of course it's 'semi-compiled'. So is Perl, and perhaps 
Python although I know little about Python. (The last whitespace 
dependent language I tried to learn was RPG-II [OK, that's an extreme 
example], and I can't dredge up any interest in dealing with another. ;-) )

&gt;&gt;<i>In the long process of developing the IA64 ABI for UNIX98 (which
</I>&gt;&gt;<i>unfortunately was abandoned for political reasons), I invested a lot
</I>&gt;&gt;<i>of time in convincing not only the general ABI committee but also
</I>&gt;&gt;<i>the C++ committee
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>?? I'm pretty sure I would have noticed any traffic from you in the
</I>&gt;<i>C++ committee reflectors on exceptions during that period.
</I>&gt;<i>  
</I>&gt;<i>
</I>I don't recall much email discussion on the ABI working groups -- this 
was almost exclusively teleconferences, and the status and reports 
weren't on any established C++ email list.

&gt;&gt;<i>that exception-based cancel, on top of a common platform exception
</I>&gt;&gt;<i>library shared by C, C++, Ada, Java, and anyone else, was an
</I>&gt;&gt;<i>absolute basic necessity. I succeeded, incidentally, and a variant
</I>&gt;&gt;<i>of an existing C++ exception package generalized to support a common
</I>&gt;&gt;<i>cross-language exception model was proposed. It wouldn't have been a
</I>&gt;&gt;<i>big deal for anyone with a C++ implementation to provide such a
</I>&gt;&gt;<i>library.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>So, OK; I don't have a strong vested interest at this point in
</I>&gt;&gt;<i>trying to build a decent C++ threading model. I've spent an enormous
</I>&gt;&gt;<i>amount of time and energy doing that several times before; it's all
</I>&gt;&gt;<i>been wasted, and I'm tired. I'm trying to provide some background
</I>&gt;&gt;<i>and assistance to help you guys do it all yet again for the nth time
</I>&gt;&gt;<i>without dropping the ball, but if you're going to go a different
</I>&gt;&gt;<i>way, that's your business.  I'll just shut up and listen.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>Whoa, dude; chill.  It's my impression that most of us are debating in
</I>&gt;<i>order to achieve clarity, not to try to force a particular decision.
</I>&gt;<i>  
</I>&gt;<i>
</I>OK, so I'm being overdramatic. Comes from living with 2 daughters who 
are into acting, I suppose. Still, it's frustrating to have the same 
issues crop up over and again. And, yeah, part of the point was 
precisely that I really can chill -- this isn't my job or my problem, 
and I can cut back and sit it out rather than drive myself crazy arguing 
the same stuff over again. And I'm about to chill (despite the heat and 
humidity here in New England) because tomorrow I leave for a week on a 
quiet island in Lake Winnipesauke with no internet.

&gt;<i>BTW, I still haven't seen a clear statement of your position in the
</I>&gt;<i>scheme #1,2,3 contest.
</I>&gt;<i>  
</I>&gt;<i>
</I>My goals are along different lines.

   1. POSIX cancel and exit, C++ exceptions, Ada exceptions, and so
      forth, are all implemented under a common unified runtime model.
   2. Propagation of any of these &quot;structured unwinds&quot; (by whatever name
      and purpose) will run appropriate language-specified cleanup,
      including POSIX cleanup handlers, C++ destructors, Ada finally
      clauses, and so forth; no matter how various language frames may
      be interleaved.

Although I have personal preferences, I really don't care that much 
whether C++ allows catching cancel/exit with catch(...), whether a 
re-raise is forced or discretionary, whether it has a class name that 
can be caught explicitly.

MY involvement is not as an expert in C++ language (standards or common 
usage); but as a casual C++ user with a lot of experience in threads and 
with several comprehensive exception models that have worked in 
practice. There are many corners into which C++ is trapped by existing 
standards and practices. (Some for perfectly good reasons, but it really 
doesn't matter now since nobody's going to tear the language apart and 
start over.)

To put it another way, MY points 1 and 2 affect the ability to correctly 
and cleanly integrate POSIX threads and C++. The distinctions between 
schemes 1, 2, and 3 outlined in this discussion thread are &quot;internal C++ 
politics&quot;. I don't consider any of them IDEAL, nor do I think does 
anyone else. The world will muddle through with any of them if necessary.

But I suppose that's not really answering the implicit challenge, is it?

If I had to make a counter-proposal, I'd probably have to suggest &quot;#4&quot;: 
the cancel &amp; exit EXCEPTIONS have names. They can be caught AND 
FINALIZED (legally not re-thrown) BY NAME (only). If caught anonymously, 
they must be re-thrown. I don't like automatically re-throwing on 
destruction (though it's a clever compromise for some scenerios, I'm 
trying to approximate some abstract idealism here so we'll discount 
that), so destruction (e.g., 'catch(...)' without a rethrow) should 
abort with some brilliantly enlightening usage message.

Where things get complicated is dealing with destructors, 'throw' and 
and nothrow clauses. I don't know; and I tried to write up paragraphs of 
ideas a few times, but deleted them. Managing a dynamic scoping system 
by throw clauses has some merit -- no throw restrictions, or a throw 
specification that includes cancel, makes the frame cancellable; nothrow 
or a throw clause omitting cancel is non-cancellable. (This might make 
large chunks of code that ought to be, or even want to be cancellable, 
non-cancellable.)

(I'm sure I'll be thrilled to be greeted by the followup when I get back 
on the 25th!)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: david.butenhof.vcf
Type: text/x-vcard
Size: 476 bytes
Desc: not available
URL: &lt;<A HREF="http://sourcerytools.com/pipermail/c++-pthreads/attachments/20050715/8ae1ca1c/attachment.vcf">http://sourcerytools.com/pipermail/c++-pthreads/attachments/20050715/8ae1ca1c/attachment.vcf</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000385.html">[c++-pthreads]  Re: pthread_cancel and EH: let's try this again
</A></li>
	<LI>Next message: <A HREF="000398.html">pthread_cancel and EH: let's try this again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#397">[ date ]</a>
              <a href="thread.html#397">[ thread ]</a>
              <a href="subject.html#397">[ subject ]</a>
              <a href="author.html#397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/c++-pthreads">More information about the c++-pthreads
mailing list</a><br>
</body></html>
