<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> PATCH: Remove old field engines
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20PATCH%3A%20Remove%20old%20field%20engines&In-Reply-To=%3C20010920132510.A11859%40Xenon.stanford.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000727.html">
   <LINK REL="Next"  HREF="000729.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>PATCH: Remove old field engines</H1>
    <B>Jeffrey David Oldham</B> 
    <A HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20PATCH%3A%20Remove%20old%20field%20engines&In-Reply-To=%3C20010920132510.A11859%40Xenon.stanford.edu%3E"
       TITLE="PATCH: Remove old field engines">oldham at CS.Stanford.EDU
       </A><BR>
    <I>Thu Sep 20 20:25:10 UTC 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000727.html">[pooma-dev] SSH Configuration
</A></li>
        <LI>Next message: <A HREF="000729.html">Field/Updater Tests?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#728">[ date ]</a>
              <a href="thread.html#728">[ thread ]</a>
              <a href="subject.html#728">[ subject ]</a>
              <a href="author.html#728">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Fields with meshes replaced fields with geometries.  Remove the old
files.

2001-09-20  Jeffrey D. Oldham  &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">oldham at codesourcery.com</A>&gt;

        * FieldEngine.Lagrangian.h: Remove this file which uses fields
        with geometries.
        * FieldEngine.NoGeometry.h: Likewise.
        * FieldEngine.UR.h: Likewise.
        * FieldEngineApply.h: Likewise.
        * FieldEngineBase.h: Likewise.

Tested on       sequential Linux using gcc 3.1 by compiling Pooma
library
and Field tests Approved by     Stephen Smith
Applied to      mainline

Thanks,
Jeffrey D. Oldham
<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">oldham at cs.stanford.edu</A>
-------------- next part --------------
Index: FieldEngine.Lagrangian.h
===================================================================
RCS file: FieldEngine.Lagrangian.h
diff -N FieldEngine.Lagrangian.h
*** /tmp/cvsBYwNoC	Thu Sep 20 12:08:14 2001
--- /dev/null	Fri Mar 23 21:37:44 2001
***************
*** 1,275 ****
- // -*- C++ -*-
- // ACL:license
- // ----------------------------------------------------------------------
- // This software and ancillary information (herein called &quot;SOFTWARE&quot;)
- // called POOMA (Parallel Object-Oriented Methods and Applications) is
- // made available under the terms described here.  The SOFTWARE has been
- // approved for release with associated LA-CC Number LA-CC-98-65.
- // 
- // Unless otherwise indicated, this SOFTWARE has been authored by an
- // employee or employees of the University of California, operator of the
- // Los Alamos National Laboratory under Contract No. W-7405-ENG-36 with
- // the U.S. Department of Energy.  The U.S. Government has rights to use,
- // reproduce, and distribute this SOFTWARE. The public may copy, distribute,
- // prepare derivative works and publicly display this SOFTWARE without 
- // charge, provided that this Notice and any statement of authorship are 
- // reproduced on all copies.  Neither the Government nor the University 
- // makes any warranty, express or implied, or assumes any liability or 
- // responsibility for the use of this SOFTWARE.
- // 
- // If SOFTWARE is modified to produce derivative works, such modified
- // SOFTWARE should be clearly marked, so as not to confuse it with the
- // version available from LANL.
- // 
- // For more information about POOMA, send e-mail to <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">pooma at acl.lanl.gov</A>,
- // or visit the POOMA web page at <A HREF="http://www.acl.lanl.gov/pooma/.">http://www.acl.lanl.gov/pooma/.</A>
- // ----------------------------------------------------------------------
- // ACL:license
- 
- //-----------------------------------------------------------------------------
- // Classes: 
- //   Lagrangian&lt;Dim, TM, CoordinateSystem&gt;
- //   FieldEngine&lt;Lagrangian&lt;...&gt;, T, EngineTag&gt;
- //-----------------------------------------------------------------------------
- 
- #ifndef POOMA_FIELD_FIELDENGINE_LAGRANGIAN_H
- #define POOMA_FIELD_FIELDENGINE_LAGRANGIAN_H
- 
- //-----------------------------------------------------------------------------
- // Overview: 
- // 
- // FieldEngine&lt;Lagrangian, T, EngineTag&gt;
- //-----------------------------------------------------------------------------
- 
- //-----------------------------------------------------------------------------
- // Includes:
- //-----------------------------------------------------------------------------
- 
- #include &quot;Field/FieldEngine/FieldEngineBase.h&quot;
- 
- #include &quot;Array/Array.h&quot;
- #include &quot;CoordinateSystems/Cartesian.h&quot;
- #include &quot;Domain/Interval.h&quot;
- #include &quot;Engine/ConstantFunctionEngine.h&quot;
- #include &quot;Engine/EnginePatch.h&quot;
- #include &quot;Engine/IndexFunctionEngine.h&quot;
- #include &quot;Layout/INode.h&quot;
- #include &quot;PETE/PETE.h&quot;
- #include &quot;Pooma/Indices.h&quot;
- #include &quot;Tiny/Vector.h&quot;
- #include &quot;Utilities/PAssert.h&quot;
- 
- 
- //-----------------------------------------------------------------------------
- // Forward Declarations:
- //-----------------------------------------------------------------------------
- 
- template&lt;class GeometryTag, class T, class EngineTag&gt; class FieldEngine;
- 
- 
- //-----------------------------------------------------------------------------
- // Full Description:
- // 
- // Lagrangian tag class.
- //-----------------------------------------------------------------------------
- 
- template&lt;int Dim, class TM =  POOMA_DEFAULT_POSITION_TYPE,
-   class CoordinateSystem = Cartesian&lt;Dim&gt; &gt;
- struct Lagrangian;
- 
- 
- //-----------------------------------------------------------------------------
- // Full Description:
- // 
- // FieldEngine, specialized for a rudimentary Lagrangian mesh.
- //-----------------------------------------------------------------------------
- 
- template&lt;int Dim, class TM, class CoordinateSystem, class T, class EngineTag&gt;
- class FieldEngine&lt;Lagrangian&lt;Dim, TM, CoordinateSystem&gt;, T, EngineTag&gt; :
-   public FieldEngineBase&lt;Dim, T, EngineTag&gt;
- {
- public:
- 
-   //---------------------------------------------------------------------------
-   // Exported typedefs and enumerations.
- 
-   // This class.
-   
-   typedef FieldEngine&lt;Lagrangian&lt;Dim, TM, CoordinateSystem&gt;, T, EngineTag&gt;
-     This_t;
-     
-   // Our base class.
-   
-   typedef FieldEngineBase&lt;Dim, T, EngineTag&gt; Base_t;
- 
-   // The geometry tag.
-   
-   typedef Lagrangian&lt;Dim, TM, CoordinateSystem&gt; GeometryTag_t;
-   
-   // The engine tag.
-   
-   typedef EngineTag EngineTag_t;
-   
-   // The coordinate system.
-   
-   typedef CoordinateSystem CoordinateSystem_t;
-   
-   // The domain type.
-   
-   typedef typename Base_t::Domain_t Domain_t;
-   
-   // The number of indices required to select a point in this mesh.
-   
-   enum { dimensions = Dim };
-   
-   // The type used to represent a point in the mesh.
-   
-   typedef Vector&lt;Dim, TM&gt; PointType_t;
-   
-   // Our engine type.
-   
-   typedef Engine&lt;Dim, T, EngineTag&gt; Engine_t;
-   
-   // Our layout type.
-   
-   typedef typename Engine_t::Layout_t Layout_t;
- 
- 
-   //---------------------------------------------------------------------------
-   // Constructors. We don't use default arguments for the origin and spacings
-   // because that produces ambiguities.
- 
-   template&lt;class BaseInitializer&gt;  
-   FieldEngine(const BaseInitializer &amp;baseInit, 
-     const Layout_t &amp;layout,
-     const PointType_t &amp;origin,
-     const PointType_t &amp;spacings)
-   : Base_t(baseInit, layout),
-     positions_m(layout)
-     {
-       positions_m = origin + iota(growRight(totalCellDomain(), 1) - 
-         physicalCellDomain().firsts()) * spacings;
-     }
-     
-   // Copy constructor.
-   
-   FieldEngine(const This_t &amp;model)
-   : Base_t(model),
-     positions_m(model.positions_m)
-     { }
-     
-   // Copy constructor (except for updaters).
- 
-   FieldEngine(const This_t &amp;model, const Pooma::Updaters::DontCopyUpdaters &amp;d)
-   : Base_t(model, d),
-     positions_m(model.positions_m)
-     { }
-     
-   // Sub-field constructor.
-   
-   FieldEngine(const This_t &amp;model, const int &amp;iSubField)
-   : Base_t(model, iSubField),
-     positions_m(model.positions_m)
-     { }
- 
-   // Domain view constructors.
- 
-   template&lt;class T2, class ET2&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
-     const Domain_t &amp;d)
-   : Base_t(model, d),
-     positions_m(model.vertexPositions()(translateToVertexDomain(d)))
-     { }
- 
-   template&lt;class T2, class ET2&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
-     const INode&lt;Dim&gt; &amp;inode)
-   : Base_t(model, inode),
-     positions_m(model.vertexPositions()(inode))
-     { }
- 
-   // Note there is no change to the vertex positions, because EngineView
-   // currently is only used to support RemoteView operations which don't
-   // change the domain.
-   template&lt;class T2, class ET2, class Tag&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
-     const EngineView&lt;Tag&gt; &amp;engineView)
-   : Base_t(model, engineView),
-     positions_m(forEach(model.vertexPositions(), engineView, TreeCombine()))
-   { }
- 
-   // Expression-engine constructor.    
- 
-   FieldEngine(const Engine&lt;Dim, T, EngineTag&gt; &amp;e)
-   : Base_t(e),
-     positions_m(referenceField().fieldEngine().vertexPositions())
-     { }
- 
-   // Patch constructor.    
- 
-   template&lt;class ET2&gt;
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T, ET2&gt; &amp;model, 
-               const FieldEnginePatch&lt;Dim&gt; &amp;p)
-   : Base_t(model, p),
-     positions_m(model.vertexPositions().patchLocal(p.patch_m))
-     { }
- 
- 
-   //---------------------------------------------------------------------------
-   // Copy assignment operator (shallow).
-   
-   This_t &amp;operator=(const This_t &amp;rhs);
- 
- 
-   //---------------------------------------------------------------------------
-   // Empty destructor is fine.
-   
-   ~FieldEngine() { }
- 
- 
-   //---------------------------------------------------------------------------
-   // Return the vertex centers. 
-   
-   typedef Array&lt;Dim, PointType_t, EngineTag_t&gt; VertexPositionsArray_t;
- 
-   const VertexPositionsArray_t &amp;vertexPositions() const
-     {
-       return positions_m;
-     }
-   
- private:
- 
-   VertexPositionsArray_t positions_m;
- 
- };
- 
- template&lt;int Dim, class TM, class CoordinateSystem, class T, class EngineTag,
-   class Tag&gt;
- struct LeafFunctor&lt;
-   FieldEngine&lt;Lagrangian&lt;Dim, TM, CoordinateSystem&gt;, T, EngineTag&gt;, 
-   ExpressionApply&lt;Tag&gt; &gt;
- {
-   typedef Lagrangian&lt;Dim, TM, CoordinateSystem&gt; GeometryTag_t;
-   typedef FieldEngine&lt;GeometryTag_t, T, EngineTag&gt; Subject_t;
-   typedef typename Subject_t::Engine_t Engine_t;
-   typedef LeafFunctor&lt;Engine_t, ExpressionApply&lt;Tag&gt; &gt; LeafFunctor_t;
-   typedef int Type_t;
- 
-   inline static
-   Type_t apply(const Subject_t &amp;fieldEngine, const ExpressionApply&lt;Tag&gt; &amp;tag)
-   {
-     forEach(fieldEngine.vertexPositions(), tag, NullCombine());
-     
-     return LeafFunctor_t::apply(fieldEngine.engine(), tag);
-   }
- };
- 
- #endif // POOMA_FIELD_FIELDENGINE_LAGRANGIAN_H
- 
- // ACL:rcsinfo
- // ----------------------------------------------------------------------
- // $RCSfile: FieldEngine.Lagrangian.h,v $   $Author: oldham $
- // $Revision: 1.1 $   $Date: 2001/08/30 01:15:10 $
- // ----------------------------------------------------------------------
- // ACL:rcsinfo
- 
--- 0 ----
Index: FieldEngine.NoGeometry.h
===================================================================
RCS file: FieldEngine.NoGeometry.h
diff -N FieldEngine.NoGeometry.h
*** /tmp/cvsbKOjVk	Thu Sep 20 12:08:14 2001
--- /dev/null	Fri Mar 23 21:37:44 2001
***************
*** 1,348 ****
- // -*- C++ -*-
- // ACL:license
- // ----------------------------------------------------------------------
- // This software and ancillary information (herein called &quot;SOFTWARE&quot;)
- // called POOMA (Parallel Object-Oriented Methods and Applications) is
- // made available under the terms described here.  The SOFTWARE has been
- // approved for release with associated LA-CC Number LA-CC-98-65.
- // 
- // Unless otherwise indicated, this SOFTWARE has been authored by an
- // employee or employees of the University of California, operator of the
- // Los Alamos National Laboratory under Contract No. W-7405-ENG-36 with
- // the U.S. Department of Energy.  The U.S. Government has rights to use,
- // reproduce, and distribute this SOFTWARE. The public may copy, distribute,
- // prepare derivative works and publicly display this SOFTWARE without 
- // charge, provided that this Notice and any statement of authorship are 
- // reproduced on all copies.  Neither the Government nor the University 
- // makes any warranty, express or implied, or assumes any liability or 
- // responsibility for the use of this SOFTWARE.
- // 
- // If SOFTWARE is modified to produce derivative works, such modified
- // SOFTWARE should be clearly marked, so as not to confuse it with the
- // version available from LANL.
- // 
- // For more information about POOMA, send e-mail to <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">pooma at acl.lanl.gov</A>,
- // or visit the POOMA web page at <A HREF="http://www.acl.lanl.gov/pooma/.">http://www.acl.lanl.gov/pooma/.</A>
- // ----------------------------------------------------------------------
- // ACL:license
- 
- //-----------------------------------------------------------------------------
- // Classes: 
- //   NoGeometry&lt;Dim&gt;
- //   FieldEngine&lt;NoGeometry, T, EngineTag&gt;
- //-----------------------------------------------------------------------------
- 
- #ifndef POOMA_FIELD_FIELDENGINE_NOGEOMETRY_H
- #define POOMA_FIELD_FIELDENGINE_NOGEOMETRY_H
- 
- //-----------------------------------------------------------------------------
- // Overview: 
- // 
- // FieldEngine&lt;NoGeometry, T, EngineTag&gt;
- //-----------------------------------------------------------------------------
- 
- //-----------------------------------------------------------------------------
- // Includes:
- //-----------------------------------------------------------------------------
- #include &quot;Field/FieldEngine/FieldEngineBase.h&quot;
- 
- #include &quot;Array/Array.h&quot;
- #include &quot;Domain/Interval.h&quot;
- #include &quot;Engine/ConstantFunctionEngine.h&quot;
- #include &quot;Engine/IndexFunctionEngine.h&quot;
- #include &quot;Layout/INode.h&quot;
- #include &quot;Field/Updater/UpdaterList.h&quot;
- #include &quot;Tiny/Vector.h&quot;
- #include &quot;Utilities/PAssert.h&quot;
- 
- 
- //-----------------------------------------------------------------------------
- // Forward Declarations:
- //-----------------------------------------------------------------------------
- 
- template&lt;class Components&gt; class ComponentWrapper;
- template&lt;int Dim, class T, class EngineTag&gt; class Engine;
- template&lt;class GeometryTag, class T, class EngineTag&gt; class FieldEngine;
- 
- 
- //-----------------------------------------------------------------------------
- // NoGeometry tag class.
- //-----------------------------------------------------------------------------
- 
- template&lt;int Dim&gt;
- struct NoGeometry;
- 
- 
- //-----------------------------------------------------------------------------
- // FieldEngine, specialized for no geometry. This is really just a field
- // wrapper of a single engine.
- //-----------------------------------------------------------------------------
- 
- template&lt;int Dim, class T, class EngineTag&gt;
- class FieldEngine&lt;NoGeometry&lt;Dim&gt;, T, EngineTag&gt;
- {
- public:
- 
-   //---------------------------------------------------------------------------
-   // Exported typedefs and enumerations.
- 
-   // This class.
-   
-   typedef FieldEngine&lt;NoGeometry&lt;Dim&gt;, T, EngineTag&gt; This_t;
-     
-   // Our base class.
-   
-   typedef FieldEngineBase&lt;Dim, T, EngineTag&gt; Base_t;
- 
-   // The geometry tag.
-   
-   typedef NoGeometry&lt;Dim&gt; GeometryTag_t;
-   
-   // The engine tag.
-   
-   typedef EngineTag EngineTag_t;
-     
-   // The domain type.
-   
-   typedef typename Base_t::Domain_t Domain_t;
-   
-   // The number of indices required to select a point in this mesh.
-   
-   enum { dimensions = Dim };
-   
-   // Our engine type.
-   
-   typedef Engine&lt;Dim, T, EngineTag&gt; Engine_t;
-   
-   // Our layout type.
-   
-   typedef typename Engine_t::Layout_t Layout_t;
-   
-   // Our guard layers type.
-   
-   typedef GuardLayers&lt;Dim&gt; GuardLayers_t;
- 
- 
-   //---------------------------------------------------------------------------
-   // Constructors.
-   //
-   // There is no sub-field constructor because this field-engine can't have
-   // subfields.
- 
-   // Default constructor.
-   FieldEngine()
-   : engine_m(Pooma::NoInit()),
-     guards_m(0),
-     updaters_m()
-     { }
- 
-   // Copy constructor.
-   
-   FieldEngine(const This_t &amp;model)
-   : engine_m(model.engine_m),
-     guards_m(model.guards_m),
-     updaters_m(model.updaters_m)
-     { }
- 
-   // Domain view constructor, including INodes and non-interval
-   // views. 
- 
-   template&lt;class G2, class T2, class ET2, class Domain&gt;  
-   FieldEngine(const FieldEngine&lt;G2, T2, ET2&gt; &amp;model, 
-     const Domain &amp;d)
-   : engine_m(NewEngineEngine&lt;typename 
-       FieldEngine&lt;G2, T2, ET2&gt;::Engine_t, Domain&gt;::apply(model.engine(), d), 
-              NewEngineDomain&lt;typename
-       FieldEngine&lt;G2, T2, ET2&gt;::Engine_t, Domain&gt;::apply(model.engine(), d)),
-     updaters_m(model.updaters())
-     { }
-     
-   // Sub-field constructor. Needs to exist, but shouldn't be called since we
-   // have no subfields.
-   
-   template&lt;class G2, class T2, class ET2&gt;  
-   FieldEngine(const FieldEngine&lt;G2, T2, ET2&gt; &amp;model, const int &amp;)
-   : engine_m(model.engine())
-     {
-       PError(&quot;Can't create a sub-field of a FieldEngine&lt;NoGeometry,...&gt;.&quot;);
-     }
- 
-   // Expression-engine constructor.    
- 
-   FieldEngine(const Engine&lt;Dim, T, EngineTag&gt; &amp;e)
-   : engine_m(e)
-     {
-     }
- 
-   // Patch constructor.    
- 
-   template&lt;class ET2&gt;
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T, ET2&gt; &amp;model, 
-               const FieldEnginePatch&lt;Dim&gt; &amp;p)
-   : engine_m(engineFunctor(model.engine(), p)),
-     updaters_m(model.updaters())
-     { }
-     
-   // ComponentView constructor. The geometry for the model should be the
-   // same since a component view simply mutates the elements.
- 
-   template&lt;class T2, class ET2, class Components&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
-     const ComponentWrapper&lt;Components&gt; &amp;c)
-   : engine_m(model.engine(), c.components()),
-     updaters_m(model.updaters())
-     { }
- 
-   // EngineView version used for remote computations.
- 
-   template&lt;class G2, class T2, class ET2, class Tag&gt;  
-   FieldEngine(const FieldEngine&lt;G2, T2, ET2&gt; &amp;model, 
- 	      const EngineView&lt;Tag&gt; &amp;engineView)
-     : engine_m(leafFunctor(model.engine(), engineView)),
-     updaters_m(model.updaters())
-   { }
-     
-   //---------------------------------------------------------------------------
-   // Copy assignment operator (disabled).
-   
-   This_t &amp;operator=(const This_t &amp;rhs);
- 
- 
-   //---------------------------------------------------------------------------
-   // Empty destructor is fine.
-   
-   ~FieldEngine() { }
-       
- 
-   //---------------------------------------------------------------------------
-   // Accessors and modifiers.
-     
-   inline int numSubFields() const
-     {
-       return 0;
-     }
- 
-   const Loc&lt;Dim&gt; offsets() const
-     {
-       // Always vert-centered...
-       
-       return Loc&lt;Dim&gt;(1); 
-     }
-     
-   Engine_t &amp;engine()
-     {
-       return engine_m;
-     }
-     
-   const Engine_t &amp;engine() const
-     {
-       return engine_m;
-     }
- 
-   const UpdaterList &amp;updaters() const
-     {
-       return updaters_m;
-     }
- 
-   UpdaterList &amp;updaters()
-     {
-       return updaters_m;
-     }
-     
-   const GuardLayers_t &amp;guardLayers() const
-     {
-       return guards_m;
-     }
- 
- 
-   //---------------------------------------------------------------------------
-   // Domain accessor functions.
-   //
-   // This field-engine always has vert-centering and the total domain is
-   // given by the engine.
-         
-   inline const Domain_t physicalCellDomain() const
-     {
-       return shrinkRight(physicalDomain(), 1);
-     }
-         
-   inline Domain_t totalCellDomain() const
-     {
-       return shrinkRight(engine_m.domain(), 1);
-     }
- 
-   Domain_t physicalDomain() const
-     {
-       return shrink(engine_m.domain(), guards_m);
-     }
- 
-   Domain_t totalDomain() const
-     {
-       return engine_m.domain();
-     }
- 
-   Domain_t physicalDomain(int iSubField) const
-     {
-       // This field engine cannot have subfields.
-       PAssert(iSubField == 0);
-       return physicalDomain();
-     }
- 
-   Domain_t totalDomain(int iSubField) const
-     {
-       // This field engine cannot have subfields.
-       PAssert(iSubField == 0);
-       return engine_m.domain();
-     }
- 
- 
-   //---------------------------------------------------------------------------
-   // Make a distinct copy of this fieldEngineBase.   
-  
-   template&lt;class Subject&gt;
-   void makeOwnCopy(const Subject &amp;s)
-     {
-       // Deepen the copies of the engine &amp; updaters list.
-       
-       engine().makeOwnCopy();
-       updaters().makeOwnCopy(s);
-     }
-   
- private:
- 
-   Engine_t engine_m;
-   GuardLayers_t guards_m;
-   UpdaterList updaters_m;
- };
- 
- // This version of field engine requires a specialization of ExpressionApply,
- // since the default version assume a field engine that uses FieldEngineBase.
- 
- template&lt;int Dim, class T, class EngineTag, class Tag&gt;
- struct LeafFunctor&lt;
-   FieldEngine&lt;NoGeometry&lt;Dim&gt;, T, EngineTag&gt;, 
-   ExpressionApply&lt;Tag&gt; &gt;
- {
-   typedef NoGeometry&lt;Dim&gt; GeometryTag_t;
-   typedef FieldEngine&lt;GeometryTag_t, T, EngineTag&gt; Subject_t;
-   typedef typename Subject_t::Engine_t Engine_t;
-   typedef LeafFunctor&lt;Engine_t, ExpressionApply&lt;Tag&gt; &gt; LeafFunctor_t;
-   typedef int Type_t;
- 
-   inline static
-   Type_t apply(const Subject_t &amp;fieldEngine, const ExpressionApply&lt;Tag&gt; &amp;tag)
-   {
-     return LeafFunctor_t::apply(fieldEngine.engine(), tag);
-   }
- };
- 
- 
- #endif // POOMA_FIELD_FIELDENGINE_NOGEOMETRY_H
- 
- // ACL:rcsinfo
- // ----------------------------------------------------------------------
- // $RCSfile: FieldEngine.NoGeometry.h,v $   $Author: oldham $
- // $Revision: 1.1 $   $Date: 2001/08/30 01:15:10 $
- // ----------------------------------------------------------------------
- // ACL:rcsinfo
- 
--- 0 ----
Index: FieldEngine.UR.h
===================================================================
RCS file: FieldEngine.UR.h
diff -N FieldEngine.UR.h
*** /tmp/cvs4HJ4r3	Thu Sep 20 12:08:14 2001
--- /dev/null	Fri Mar 23 21:37:44 2001
***************
*** 1,377 ****
- // -*- C++ -*-
- // ACL:license
- // ----------------------------------------------------------------------
- // This software and ancillary information (herein called &quot;SOFTWARE&quot;)
- // called POOMA (Parallel Object-Oriented Methods and Applications) is
- // made available under the terms described here.  The SOFTWARE has been
- // approved for release with associated LA-CC Number LA-CC-98-65.
- // 
- // Unless otherwise indicated, this SOFTWARE has been authored by an
- // employee or employees of the University of California, operator of the
- // Los Alamos National Laboratory under Contract No. W-7405-ENG-36 with
- // the U.S. Department of Energy.  The U.S. Government has rights to use,
- // reproduce, and distribute this SOFTWARE. The public may copy, distribute,
- // prepare derivative works and publicly display this SOFTWARE without 
- // charge, provided that this Notice and any statement of authorship are 
- // reproduced on all copies.  Neither the Government nor the University 
- // makes any warranty, express or implied, or assumes any liability or 
- // responsibility for the use of this SOFTWARE.
- // 
- // If SOFTWARE is modified to produce derivative works, such modified
- // SOFTWARE should be clearly marked, so as not to confuse it with the
- // version available from LANL.
- // 
- // For more information about POOMA, send e-mail to <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">pooma at acl.lanl.gov</A>,
- // or visit the POOMA web page at <A HREF="http://www.acl.lanl.gov/pooma/.">http://www.acl.lanl.gov/pooma/.</A>
- // ----------------------------------------------------------------------
- // ACL:license
- 
- //-----------------------------------------------------------------------------
- // Classes: 
- //   UniformRectilinear&lt;Dim, TM, CoordinateSystem&gt;
- //   FieldEngine&lt;UniformRectilinear, T, EngineTag&gt;
- //-----------------------------------------------------------------------------
- 
- #ifndef POOMA_FIELD_FIELDENGINE_UR_H
- #define POOMA_FIELD_FIELDENGINE_UR_H
- 
- //-----------------------------------------------------------------------------
- // Overview: 
- // 
- // FieldEngine&lt;UniformRectilinear, T, EngineTag&gt;
- //-----------------------------------------------------------------------------
- 
- //-----------------------------------------------------------------------------
- // Includes:
- //-----------------------------------------------------------------------------
- 
- #include &quot;Field/FieldEngine/FieldEngineBase.h&quot;
- 
- #include &quot;Array/Array.h&quot;
- #include &quot;CoordinateSystems/Cartesian.h&quot;
- #include &quot;Domain/Interval.h&quot;
- #include &quot;Engine/ConstantFunctionEngine.h&quot;
- #include &quot;Engine/IndexFunctionEngine.h&quot;
- #include &quot;Layout/INode.h&quot;
- #include &quot;Tiny/Vector.h&quot;
- #include &quot;Utilities/PAssert.h&quot;
- 
- 
- //-----------------------------------------------------------------------------
- // Forward Declarations:
- //-----------------------------------------------------------------------------
- 
- template&lt;class GeometryTag, class T, class EngineTag&gt; class FieldEngine;
- template&lt;class Components&gt; class ComponentWrapper;
- 
- 
- //-----------------------------------------------------------------------------
- // Full Description:
- // 
- // UniformRectilinear tag class.
- //-----------------------------------------------------------------------------
- 
- template&lt;int Dim, class T = POOMA_DEFAULT_POSITION_TYPE,
-   class CoordinateSystem = Cartesian&lt;Dim&gt; &gt;
- struct UniformRectilinear;
- 
- 
- //-----------------------------------------------------------------------------
- // Full Description:
- // 
- // FieldEngine, specialized for uniform rectilinear meshes.
- //-----------------------------------------------------------------------------
- 
- template&lt;int Dim, class TM, class CoordinateSystem, class T, class EngineTag&gt;
- class FieldEngine&lt;UniformRectilinear&lt;Dim, TM, CoordinateSystem&gt;, T, EngineTag&gt;
- : public FieldEngineBase&lt;Dim, T, EngineTag&gt;
- {
- public:
- 
-   //---------------------------------------------------------------------------
-   // Exported typedefs and enumerations.
- 
-   // This class.
-   
-   typedef 
-     FieldEngine&lt;UniformRectilinear&lt;Dim, TM, CoordinateSystem&gt;, T, EngineTag&gt;
-       This_t;
-     
-   // Our base class.
-   
-   typedef FieldEngineBase&lt;Dim, T, EngineTag&gt; Base_t;
- 
-   // The geometry tag.
-   
-   typedef UniformRectilinear&lt;Dim, TM, CoordinateSystem&gt; GeometryTag_t;
-   
-   // The engine tag.
-   
-   typedef EngineTag EngineTag_t;
-   
-   // The coordinate system.
-   
-   typedef CoordinateSystem CoordinateSystem_t;
-   
-   // The domain type.
-   
-   typedef typename Base_t::Domain_t Domain_t;
-   
-   // The number of indices required to select a point in this mesh.
-   
-   enum { dimensions = Dim };
-   
-   // The type used to represent a point in the mesh.
-   
-   typedef Vector&lt;Dim, TM&gt; PointType_t;
-   
-   // Our engine type.
-   
-   typedef Engine&lt;Dim, T, EngineTag&gt; Engine_t;
-   
-   // Our layout type.
-   
-   typedef typename Engine_t::Layout_t Layout_t;
- 
- 
-   //---------------------------------------------------------------------------
-   // Constructors. We don't use default arguments for the origin and spacings
-   // because that produces ambiguities.
- 
-   FieldEngine()
-   : Base_t()
-     { }
- 
-   template&lt;class BaseInitializer&gt;  
-   FieldEngine(const BaseInitializer &amp;baseInit, 
-     const Layout_t &amp;layout,
-     const PointType_t &amp;origin,
-     const PointType_t &amp;spacings)
-   : Base_t(baseInit, layout),
-     origin_m(origin),
-     spacings_m(spacings)
-     { }
- 
-   // Version that constructs a field with a new centering but based on the
-   // same geometry.
- 
-   template&lt;class BaseInitializer, class T2, class ET2&gt;  
-   FieldEngine(const BaseInitializer &amp;baseInit,
- 	      const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model)
-   : Base_t(baseInit, model),
-     origin_m(model.origin()),
-     spacings_m(model.spacings())
-     {
-     }
-     
-   // Copy constructor.
-   
-   FieldEngine(const This_t &amp;model)
-   : Base_t(model),
-     origin_m(model.origin_m),
-     spacings_m(model.spacings_m)
-     { }
-     
-   // Copy constructor (except for updaters).
- 
-   FieldEngine(const This_t &amp;model, const Pooma::Updaters::DontCopyUpdaters &amp;d)
-   : Base_t(model, d),
-     origin_m(model.origin_m),
-     spacings_m(model.spacings_m)
-     { }
-     
-   // Sub-field constructor.
- 
-   template&lt;class ET2&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T, ET2&gt; &amp;model, 
-     const int &amp;iSubField)
-   : Base_t(model, iSubField),
-     origin_m(model.origin()),
-     spacings_m(model.spacings())
-     { }
- 
-   // Domain view constructor.
- 
-   template&lt;class T2, class ET2&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
-     const Domain_t &amp;d)
-   : Base_t(model, d),
-     origin_m(model.origin()),
-     spacings_m(model.spacings())
-     {
-       for (int i = 0; i &lt; Dim; i++)
-         origin_m(i) += 
-           (d[i].first() - model.physicalCellDomain()[i].first()) *
-           spacings_m(i);
-     }
- 
-   template&lt;class T2, class ET2&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
-     const INode&lt;Dim&gt; &amp;inode)
-   : Base_t(model, inode),
-     origin_m(model.origin()),
-     spacings_m(model.spacings())
-     {
-       for (int i = 0; i &lt; Dim; i++)
-         origin_m(i) += 
-           (inode.domain()[i].first() - model.physicalCellDomain()[i].first()) *
-           spacings_m(i);
-     }
- 
-   template&lt;class T2, class ET2, class Tag&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
- 	      const EngineView&lt;Tag&gt; &amp;engineView)
-   : Base_t(model, engineView),
-     origin_m(model.origin()),
-     spacings_m(model.spacings())
-   {
-     // Will need to fix up origin_m if EnginView replaces INode&lt;&gt; view.
-   }
- 
-   // Expression-engine constructor.    
- 
-   FieldEngine(const Engine&lt;Dim, T, EngineTag&gt; &amp;e)
-   : Base_t(e)
-     {
-       origin_m = referenceField().fieldEngine().origin(); 
-       spacings_m = referenceField().fieldEngine().spacings(); 
-     }
- 
-   // Patch constructor.    
- 
-   template&lt;class ET2&gt;
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T, ET2&gt; &amp;model, 
-               const FieldEnginePatch&lt;Dim&gt; &amp;p)
-   : Base_t(model, p),
-     spacings_m(model.spacings())
-     { 
-       for (int i = 0; i &lt; Dim; i++)
-         origin_m(i) += 
-           (physicalCellDomain()[i].first() - 
-           model.physicalCellDomain()[i].first()) *
-           spacings_m(i);
-     }
-     
-   // ComponentView constructor. The geometry for the model should be the
-   // same since a component view simply mutates the elements.
- 
-   template&lt;class T2, class ET2, class Components&gt;  
-   FieldEngine(const FieldEngine&lt;GeometryTag_t, T2, ET2&gt; &amp;model, 
-     const ComponentWrapper&lt;Components&gt; &amp;c)
-   : Base_t(model, c),
-     origin_m(model.origin()),
-     spacings_m(model.spacings())
-     { }
- 
- 
-   //---------------------------------------------------------------------------
-   // Copy assignment operator (shallow).
-   
-   This_t &amp;operator=(const This_t &amp;rhs)
-   {
-     origin_m = rhs.origin();
-     spacings_m = rhs.spacings();
-     initialize(rhs);
-     return *this;
-   }
- 
-   //---------------------------------------------------------------------------
-   // Empty destructor is fine.
-   
-   ~FieldEngine() { }
- 
- 
-   //---------------------------------------------------------------------------
-   // Accessors.
-   
-   inline const PointType_t &amp;origin() const { return origin_m; }
-   inline const PointType_t &amp;spacings() const { return spacings_m; }
- 
- 
-   //---------------------------------------------------------------------------
-   // Return an index-function-engine-based array that can return the positions
-   // of the geometric center of a cell's faces. 
-   
-   class FaceCenterFunctor
-   {
-     public:
-     
-       FaceCenterFunctor() { }
-       
-       FaceCenterFunctor(const PointType_t &amp;origin, const PointType_t &amp;spacings,
-                         const Domain_t &amp;pcd, int orientation)
-       : origin_m(origin), spacings_m(spacings)
-         {
-           for (int i = 0; i &lt; PointType_t::dimensions; i++)
-             {
-               if (i != orientation)
-                 origin_m(i) += 0.5 * spacings_m(i);
-               origin_m(i) -= pcd[i].first() * spacings_m(i);
-             }
-         }
-       
-       PointType_t operator()(int i0) const
-         {
-           return origin_m + PointType_t(i0) * spacings_m;
-         }
-       
-       PointType_t operator()(int i0, int i1) const
-         {
-           return origin_m + PointType_t(i0, i1) * spacings_m;
-         }
- 
-         PointType_t operator()(int i0, int i1, int i2) const
-         {
-           return origin_m + PointType_t(i0, i1, i3) * spacings_m;
-         }
- 
-     private:
-     
-       PointType_t origin_m, spacings_m;
-   };
-     
-   typedef Array&lt;Dim, PointType_t, IndexFunction&lt;FaceCenterFunctor&gt; &gt; 
-     FaceCentersArray_t;
- 
-   FaceCentersArray_t faceCenters(int orientation, const Domain_t &amp;d) const;
-   
- private:
- 
-   PointType_t origin_m, spacings_m;
- 
- };
- 
- 
- ///////////////////////////////////////////////////////////////////////////////
- //
- // Non-inline members.
- //
- ///////////////////////////////////////////////////////////////////////////////
- 
- //-----------------------------------------------------------------------------
- // Return the face centers.
- //-----------------------------------------------------------------------------
- 
- template &lt;int Dim, class TM, class CoordinateSystem, class T, class EngineTag&gt;
- typename 
-   FieldEngine&lt;UniformRectilinear&lt;Dim, TM, CoordinateSystem&gt;, T, EngineTag&gt;::
-     FaceCentersArray_t 
- FieldEngine&lt;UniformRectilinear&lt;Dim, TM, CoordinateSystem&gt;, T, EngineTag&gt;::
- faceCenters(int orientation, const Domain_t &amp;d) const
- {
-   FaceCentersArray_t array(d);
-   FaceCenterFunctor functor(origin_m, spacings_m, physicalCellDomain(),
-     orientation);
-   array.engine().setFunctor(functor);
-   return array;
- }
- 
- #endif // POOMA_FIELD_FIELDENGINE_UR_H
- 
- // ACL:rcsinfo
- // ----------------------------------------------------------------------
- // $RCSfile: FieldEngine.UR.h,v $   $Author: oldham $
- // $Revision: 1.1 $   $Date: 2001/08/30 01:15:10 $
- // ----------------------------------------------------------------------
- // ACL:rcsinfo
- 
--- 0 ----
Index: FieldEngineApply.h
===================================================================
RCS file: FieldEngineApply.h
diff -N FieldEngineApply.h
*** /tmp/cvsALibZL	Thu Sep 20 12:08:14 2001
--- /dev/null	Fri Mar 23 21:37:44 2001
***************
*** 1,34 ****
- 
- 
- template&lt;class Geometry, class T, class E, class Tag&gt;
- struct LeafFunctor&lt;Field&lt;Geometry, T, E&gt;, EngineApply&lt;Tag&gt; &gt;
- {
-   typedef Field&lt;Geometry, T, E&gt; Subject_t;
-   typedef typename Subject_t::FieldEngine_t FieldEngine_t;
-   typedef LeafFunctor&lt;FieldEngine_t, EngineApply&lt;Tag&gt; &gt; LeafFunctor_t;
-   typedef typename LeafFunctor_t::Type_t Type_t;
- 
-   inline static
-   Type_t apply(const Subject_t &amp;field, 
- 	       const EngineApply&lt;Tag&gt; &amp;tag)
-     {
-       return LeafFunctor_t::apply(field.fieldEngine(), tag);
-     }
- };
- 
- template&lt;class Geometry, class T, class E, class Tag&gt;
- struct LeafFunctor&lt;FieldEngine&lt;Geometry, T, E&gt;, EngineApply&lt;Tag&gt; &gt;
- {
-   typedef FieldEngine&lt;Geometry, T, E&gt; Subject_t;
-   typedef typename Subject_t::Engine_t Engine_t;
-   typedef LeafFunctor&lt;Engine_t, EngineApply&lt;Tag&gt; &gt; LeafFunctor_t;
-   typedef typename LeafFunctor_t::Type_t Type_t;
- 
-   inline static
-   Type_t apply(const Subject_t &amp;fieldEngine, 
- 	       const EngineApply&lt;Tag&gt; &amp;tag)
-     {
-       return LeafFunctor_t::apply(fieldEngine.engine(), tag);
-     }
- };
- 
--- 0 ----
Index: FieldEngineBase.h
===================================================================
RCS file: FieldEngineBase.h
diff -N FieldEngineBase.h
*** /tmp/cvsu3ikwu	Thu Sep 20 12:08:14 2001
--- /dev/null	Fri Mar 23 21:37:44 2001
***************
*** 1,589 ****
- // -*- C++ -*-
- // ACL:license
- // ----------------------------------------------------------------------
- // This software and ancillary information (herein called &quot;SOFTWARE&quot;)
- // called POOMA (Parallel Object-Oriented Methods and Applications) is
- // made available under the terms described here.  The SOFTWARE has been
- // approved for release with associated LA-CC Number LA-CC-98-65.
- // 
- // Unless otherwise indicated, this SOFTWARE has been authored by an
- // employee or employees of the University of California, operator of the
- // Los Alamos National Laboratory under Contract No. W-7405-ENG-36 with
- // the U.S. Department of Energy.  The U.S. Government has rights to use,
- // reproduce, and distribute this SOFTWARE. The public may copy, distribute,
- // prepare derivative works and publicly display this SOFTWARE without 
- // charge, provided that this Notice and any statement of authorship are 
- // reproduced on all copies.  Neither the Government nor the University 
- // makes any warranty, express or implied, or assumes any liability or 
- // responsibility for the use of this SOFTWARE.
- // 
- // If SOFTWARE is modified to produce derivative works, such modified
- // SOFTWARE should be clearly marked, so as not to confuse it with the
- // version available from LANL.
- // 
- // For more information about POOMA, send e-mail to <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">pooma at acl.lanl.gov</A>,
- // or visit the POOMA web page at <A HREF="http://www.acl.lanl.gov/pooma/.">http://www.acl.lanl.gov/pooma/.</A>
- // ----------------------------------------------------------------------
- // ACL:license
- 
- //-----------------------------------------------------------------------------
- // Classes: 
- //   FieldEngineBase
- //-----------------------------------------------------------------------------
- 
- #ifndef POOMA_FIELD_FIELDENGINE_FIELDENGINEBASE_H
- #define POOMA_FIELD_FIELDENGINE_FIELDENGINEBASE_H
- 
- //-----------------------------------------------------------------------------
- // Overview: 
- // 
- // FieldEngineBase and related classes. POOMA supports a flexible form 
- // of &quot;centering&quot; that allows a hierarchy of multiple centering points per 
- // cell. The centering information, managed by the FieldEngineBase
- // class, is initialized using a flexible set of functors.
- //-----------------------------------------------------------------------------
- 
- //-----------------------------------------------------------------------------
- // Includes:
- //-----------------------------------------------------------------------------
- 
- #include &quot;Domain/Interval.h&quot;
- #include &quot;Domain/Loc.h&quot;
- #include &quot;Domain/Shrink.h&quot;
- #include &quot;Layout/INode.h&quot;
- #include &quot;Layout/GuardLayers.h&quot;
- #include &quot;Utilities/PAssert.h&quot;
- #include &quot;Utilities/RefCountedBlockPtr.h&quot;
- #include &quot;Engine/EnginePatch.h&quot;
- #include &quot;Engine/EngineFunctor.h&quot;
- #include &quot;Field/Updater/UpdaterList.h&quot;
- #include &quot;Field/FieldEngine/FieldEnginePatch.h&quot;
- 
- //-----------------------------------------------------------------------------
- // Forward declarations:
- //-----------------------------------------------------------------------------
- 
- template&lt;int Dim, class T, class EngineTag&gt; class Engine;
- template&lt;class Components&gt; class ComponentWrapper;
- 
- 
- // ----------------------------------------------------------------------------
- // FieldEngineBaseData holds offset information about the centering along
- // with a copy of the engine containing the data associated with the centering.
- // ----------------------------------------------------------------------------
- 
- template &lt;int Dim, class T, class EngineTag&gt;
- class FieldEngineBaseData : public RefCounted
- {
- public:
- 
-   template&lt;class Initializer&gt;
-   FieldEngineBaseData(const Loc&lt;Dim&gt; &amp;offsets, 
-                       const Initializer &amp;init)
-     : offsets_m(offsets), 
-       engine_m(init)
-     { }
- 
-   template&lt;class Initializer&gt;
-   FieldEngineBaseData(const Loc&lt;Dim&gt; &amp;offsets, 
-                       const Initializer &amp;init, const UpdaterList &amp;l)
-     : offsets_m(offsets), 
-       engine_m(init),
-       updaters_m(l)
-     { }
- 
-   template&lt;class Engine, class Domain&gt;
-   FieldEngineBaseData(const Loc&lt;Dim&gt; &amp;offsets, const Engine &amp;e,
-     const Domain &amp;d, const UpdaterList &amp;l)
-     : offsets_m(offsets), 
-       engine_m(NewEngineEngine&lt;Engine, Domain&gt;::apply(e, d), 
-                NewEngineDomain&lt;Engine, Domain&gt;::apply(e, d)),
-       updaters_m(l)
-     { }
-     
-   const Loc&lt;Dim&gt; &amp;offsets() const { return offsets_m; }
- 
-   const Engine&lt;Dim, T, EngineTag&gt; &amp;engine() const { return engine_m; }
-   Engine&lt;Dim, T, EngineTag&gt; &amp;engine() { return engine_m; }
- 
-   const UpdaterList &amp;updaters() const { return updaters_m; }
-   UpdaterList &amp;updaters() { return updaters_m; }
-   
- private:
- 
-   Loc&lt;Dim&gt; offsets_m;
-   Engine&lt;Dim, T, EngineTag&gt; engine_m;
-   UpdaterList updaters_m;
- };
- 
- 
- // ----------------------------------------------------------------------------
- // FieldEngineBase manages a hierarchy of engines, making it possible for
- // FieldEngine specializations to implement geometry-specific behavior only.
- // ----------------------------------------------------------------------------
- 
- template&lt;int Dim, class T, class EngineTag&gt;
- class FieldEngineBase
- {
- public:
- 
-   //---------------------------------------------------------------------------
-   // Exported typedefs and enumerations.
-     
-   typedef FieldEngineBase&lt;Dim, T, EngineTag&gt; This_t;
-   typedef FieldEngineBaseData&lt;Dim, T, EngineTag&gt; Data_t;
-   typedef Engine&lt;Dim, T, EngineTag&gt; Engine_t;
-   typedef typename Engine_t::Domain_t Domain_t;
-   typedef typename Engine_t::Layout_t Layout_t;
-   typedef typename Engine_t::Element_t Element_t;
-   typedef typename Engine_t::ElementRef_t ElementRef_t;
-   enum { dimensions = Dim };
-   typedef GuardLayers&lt;Dim&gt; GuardLayers_t;
- 
- 
-   //---------------------------------------------------------------------------
-   // Constructors.
- 
-   // Default constructor.
-   
-   FieldEngineBase()
-   : physicalCellDomain_m(Pooma::NoInit()),
-     guards_m(0)
-     { }
-   
-   // Layout constructor. Takes a layout appropriate for the contained
-   // engines and, based on the logic contained in the InitFunctor, sets
-   // up centering information and the engines.
-     
-   template&lt;class InitFunctor&gt;
-   FieldEngineBase(const InitFunctor &amp;f, const Layout_t &amp;layout)
-   : physicalCellDomain_m(layout.domain()),
-     guards_m(layout.externalGuards())
-     {
-       shrinkInPlace(physicalCellDomain_m, guards_m);
-       shrinkRightInPlace(physicalCellDomain_m, 1);
-       f.initialize(*this, layout);
-     }
- 
-   // Initialize with a new centering from a model.
- 
-   template&lt;class InitFunctor, class T2, class ET2&gt;
-   FieldEngineBase(const InitFunctor &amp;f,
- 		  const FieldEngineBase&lt;Dim, T2, ET2&gt; &amp;model)
-   : physicalCellDomain_m(model.physicalCellDomain()),
-     guards_m(model.guardLayers())
-     {
-       f.initialize(*this, Pooma::NoInit());
-     }
- 
-   // Copy constructor.
-   
-   FieldEngineBase(const This_t &amp;model)
-   : subFields_m(model.subFields_m),
-     data_m(model.data_m),
-     physicalCellDomain_m(model.physicalCellDomain_m),
-     guards_m(model.guards_m)
-     { }
- 
-   // Sub-field view constructor. This is when we want to construct a view of
-   // one of the subFields in our top-level list.
-   
-   FieldEngineBase(const This_t &amp;model, const int &amp;iSubField)
-   : subFields_m(model.subFields_m[iSubField].subFields_m),
-     data_m(model.subFields_m[iSubField].data_m),
-     physicalCellDomain_m(model.physicalCellDomain_m),
-     guards_m(model.guards_m)
-     { }  
- 
-   // View constructor.  
-   
-   template&lt;int Dim2, class T2, class EngineTag2, class Initializer&gt;
-   FieldEngineBase(const FieldEngineBase&lt;Dim2, T2, EngineTag2&gt; &amp;model, 
-     const Initializer &amp;i)
-     {
-       initialize(*this, model, i); 
-     }  
- 
-   //---------------------------------------------------------------------------
-   // Initialize functions. 
- 
-   template&lt;class Initializer&gt;
-   void initialize(const Loc&lt;Dim&gt; &amp;loc, const Initializer &amp;init)
-     {
-       data_m = new Data_t(loc, init);
-     }
- 
-   template&lt;class Initializer&gt;
-   void initialize(const Loc&lt;Dim&gt; &amp;loc, const Initializer &amp;init, 
-                   const UpdaterList &amp;l)
-     {
-       data_m = new Data_t(loc, init, l);
-     }
- 
-   template&lt;class Engine, class Domain&gt;
-   void initialize(const Loc&lt;Dim&gt; &amp;loc, const Engine &amp;e, const Domain &amp;d,
-     const UpdaterList &amp;l)
-     {
-       data_m = new Data_t(loc, e, d, l);
-     }
- 
-   void initialize(const This_t &amp;model)
-   {
-     subFields_m = model.subFields_m;
-     data_m = model.data_m;
-     physicalCellDomain_m = model.physicalCellDomain_m;
-     guards_m = model.guards_m;
-   }
- 
-   template&lt;int Dim2, class T2, class EngineTag2&gt;
-   void initialize(This_t &amp;s, 
-     const FieldEngineBase&lt;Dim2, T2, EngineTag2&gt; &amp;model, const Domain_t &amp;d)
-     {
-       int n = model.numSubFields();
-       if (n == 0)
-         {
-           s.physicalCellDomain_m = shrinkRight(d - d.firsts(),
- 					       model.offsets());
-           s.initialize(model.offsets(), model.engine(), d, model.updaters());
-         }
-       else
-         {
-           s.physicalCellDomain_m = d - d.firsts();
-           s.addSubFields(n);
-           for (int i = 0; i &lt; n; i++)
-             initialize(s.subFields_m[i], model.subField(i),
-               model.subField(i).translateDomain(d));
-         }
-     }
- 
-   template&lt;int Dim2, class T2, class EngineTag2&gt;
-   void initialize(This_t &amp;s, 
-     const FieldEngineBase&lt;Dim2, T2, EngineTag2&gt; &amp;model, const INode&lt;Dim&gt; &amp;i)
-   {
-       int n = model.numSubFields();
-       if (n == 0)
-         {
- 	  s.physicalCellDomain_m = 
- 	    shrinkRight(i.domain() - i.domain().firsts(), model.offsets());
- 	  s.initialize(model.offsets(), model.engine(), i, model.updaters());
-         }
-       else
-         {
- 	  s.physicalCellDomain_m = i.domain() - i.domain().firsts();
- 	  s.addSubFields(n);
- 	  for (int j = 0; j &lt; n; j++)
- 	    initialize(s.subFields_m[j], model.subField(j),
- 		       model.subField(j).translateDomain(i));
-         }
-   }
- 
-   template&lt;int Dim2, class T2, class EngineTag2, class Tag&gt;
-   void initialize(This_t &amp;s, 
- 		  const FieldEngineBase&lt;Dim2, T2, EngineTag2&gt; &amp;model,
- 		  const EngineView&lt;Tag&gt; &amp;ev)
-   {
-     typedef typename FieldEngineBase&lt;Dim2, T2, EngineTag2&gt;::Engine_t EngIn_t;
-     int n = model.numSubFields();
-     if (n == 0)
-       {
-         s.physicalCellDomain_m = model.physicalCellDomain();
-         s.guards_m = model.guardLayers();
-         s.initialize(model.offsets(),
- 	    	     LeafFunctor&lt;EngIn_t,
- 		     EngineView&lt;Tag&gt; &gt;::apply(model.engine(), ev),
- 		     model.updaters());
-       }
-     else
-       {
-         s.physicalCellDomain_m = model.physicalCellDomain();
-         s.guards_m = model.guardLayers();
-         s.addSubFields(n);
-         for (int i = 0; i &lt; n; i++)
- 	  initialize(s.subFields_m[i], model.subField(i), ev);
-       }
-   }
- 
-   template&lt;class EngineTag2&gt;
-   void initialize(This_t &amp;s, 
-                   const FieldEngineBase&lt;Dim, T, EngineTag2&gt; &amp;model,
-                   const FieldEnginePatch&lt;Dim&gt; &amp;p)
-     {
-       PAssert(model.numSubFields() == 0);
-       s.initialize(model.offsets(), engineFunctor(model.engine(),
-                                                   EnginePatch(p.patch_m)));
-       s.physicalCellDomain_m = shrinkRight(p.domain_m, model.offsets());
-       s.guards_m = model.guardLayers();
-     }
- 
-   template&lt;int Dim2, class T2, class EngineTag2, class Components&gt;
-   void initialize(This_t &amp;s, 
-     const FieldEngineBase&lt;Dim2, T2, EngineTag2&gt; &amp;model, 
-     const ComponentWrapper&lt;Components&gt; &amp;c)
-     {
-       int n = model.numSubFields();
-       if (n == 0)
-         {
-           s.physicalCellDomain_m = model.physicalCellDomain();
-           s.guards_m = model.guardLayers();
-           s.initialize(model.offsets(), 
-                        Engine_t(model.engine(), c.components()),
-                        model.updaters());
-         }
-       else
-         {
-           s.physicalCellDomain_m = model.physicalCellDomain();
-           s.guards_m = model.guardLayers();
-           s.addSubFields(n);
-           for (int i = 0; i &lt; n; i++)
-             initialize(s.subFields_m[i], model.subField(i), c);
-         }
-     }
- 
-   void initialize(This_t &amp;s, const This_t &amp;model, 
-     const Pooma::Updaters::DontCopyUpdaters &amp;d)
-     {
-       int n = model.numSubFields();
-       s.physicalCellDomain_m = model.physicalCellDomain();
-       s.guards_m = model.guardLayers();
-       if (n == 0)
-         {
-           s.initialize(model.offsets(), model.engine());
-         }
-       else
-         {
-           s.addSubFields(n);
-           for (int i = 0; i &lt; n; i++)
-             initialize(s.subFields_m[i], model.subField(i), d);
-         }
-     }
-       
- 
-   //---------------------------------------------------------------------------
-   // Accessors and modifiers.
-     
-   void addSubFields(int n)
-     {
-       PAssert(subFields_m.size() == 0);
-       
-       subFields_m.reserve(n);
-       subFields_m.resize(n);
-       for (int i = 0; i &lt; n; i++)
-         {
-           subFields_m[i].physicalCellDomain_m = physicalCellDomain_m;
-           subFields_m[i].guards_m = guards_m;
-         }
-     }
-     
-   inline int numSubFields() const
-     {
-       return subFields_m.size();
-     }
-     
-   This_t &amp;subField(int i)
-     {
-       return subFields_m[i];
-     }
-     
-   const This_t &amp;subField(int i) const
-     {
-       return subFields_m[i];
-     }
- 
-   const Loc&lt;Dim&gt; &amp;offsets() const
-     {
-       PAssert(data_m.isValid());
-       return data_m-&gt;offsets();
-     }
-     
-   Engine_t &amp;engine()
-     {
-       PAssert(data_m.isValid());
-       return data_m-&gt;engine();
-     }
-     
-   const Engine_t &amp;engine() const
-     {
-       PAssert(data_m.isValid());
-       return data_m-&gt;engine();
-     }
- 
-   const UpdaterList &amp;updaters() const
-     {
-       PAssert(data_m.isValid());
-       return data_m-&gt;updaters();
-     }
- 
-   UpdaterList &amp;updaters()
-     {
-       PAssert(data_m.isValid());
-       return data_m-&gt;updaters();
-     }
-     
-   const GuardLayers_t &amp;guardLayers() const
-     {
-       return guards_m;
-     }
- 
-   GuardLayers_t &amp;guardLayers()
-     {
-       return guards_m;
-     }
- 
- 
-   //---------------------------------------------------------------------------
-   // Domain accessor functions. 
-         
-   inline const Domain_t physicalCellDomain() const
-     {
-       return physicalCellDomain_m;
-     }
-         
-   inline Domain_t totalCellDomain() const
-     {
-       return grow(physicalCellDomain_m, guards_m);
-     }
- 
-   Domain_t physicalDomain(int iSubField) const
-     {
-       return subFields_m[iSubField].
-         translateDomain(physicalCellDomain_m);
-     }
- 
-   Domain_t totalDomain(int iSubField) const
-     {
-       return subFields_m[iSubField].
-         translateDomain(totalCellDomain());
-     }
- 
-   Domain_t physicalDomain() const
-     {
-       return translateDomain(physicalCellDomain_m);
-     }
- 
-   Domain_t totalDomain() const
-     {
-       return translateDomain(totalCellDomain());
-     }
- 
-   
-   //---------------------------------------------------------------------------
-   // Make a distinct copy of this fieldEngineBase.   
-  
-   template&lt;class Subject&gt;
-   void makeOwnCopy(const Subject &amp;s)
-     {
-       // This only make sense if we have no subfields.
-       
-       PAssert(data_m.isValid());
- 
-       // Create a new data block with shallow copies of the engine and the
-       // updaters.
-       
-       initialize(offsets(), engine(), updaters());
-       
-       // Deepen the copies of the engine &amp; updaters list.
-       
-       engine().makeOwnCopy();
-       updaters().makeOwnCopy(s);
-     }
- 
- 
-   //---------------------------------------------------------------------------
-   // Domain translation function. 
-   
-   inline Domain_t
-   translateDomain(const Domain_t &amp;d) const
-     {
-       if (subFields_m.size() == 0)
-         return growRight(d, offsets());
-       else
-         return d;
-     }
-   
-   inline INode&lt;Dim&gt;
-   translateDomain(const INode&lt;Dim&gt; &amp;inode) const
-   {
-     return INode&lt;Dim&gt;(inode, translateDomain(inode.domain()));
-   }
-   
-   inline Domain_t
-   translateToVertexDomain(const Domain_t &amp;d) const
-     {
-       if (subFields_m.size() == 0)
-         return d;
-       else
-         return growRight(d, 1);
-     }
- 
-       
- private:
- 
-   RefCountedBlockPtr&lt;This_t&gt; subFields_m;
-   RefCountedPtr&lt;Data_t&gt; data_m;
-   Domain_t physicalCellDomain_m;
-   GuardLayers_t guards_m;
- };
- 
- template&lt;int Dim, class T, class EngineTag, class Tag&gt;
- struct LeafFunctor&lt;FieldEngineBase&lt;Dim, T, EngineTag&gt;,
-   ExpressionApply&lt;Tag&gt; &gt;
- {
-   typedef FieldEngineBase&lt;Dim, T, EngineTag&gt; Subject_t;
-   typedef typename Subject_t::Engine_t Engine_t;
-   typedef LeafFunctor&lt;Engine_t, ExpressionApply&lt;Tag&gt; &gt; LeafFunctor_t;
-   typedef int Type_t;
- 
-   inline static
-   Type_t apply(const Subject_t &amp;fieldEngineBase, 
- 	       const ExpressionApply&lt;Tag&gt; &amp;tag)
-   {
-     int n = fieldEngineBase.numSubFields();
- 
-     if (n == 0)
-     {
-       LeafFunctor_t::apply(fieldEngineBase.engine(), tag);
-     }
-     else
-     {
-       int i;
-       for (i = 0; i &lt; n; ++i)
-       {
- 	apply(fieldEngineBase.subField(i), tag);
-       }
-     }
-     return 0;
-   }
- };
- 
- // This function applies a generic thing to all the FieldEngineBase
- // objects that contain an engine.
- 
- template&lt;int Dim, class T, class ETag, class Thing&gt;
- void
- applyThingToFieldEngineBase(FieldEngineBase&lt;Dim, T, ETag&gt; &amp;fieldEngineBase, 
- 			    const Thing &amp;thing)
- {
-   int n = fieldEngineBase.numSubFields();
- 
-   if (n == 0)
-   {
-     thing(fieldEngineBase);
-   }
-   else
-   {
-     int i;
-     for (i = 0; i &lt; n; ++i)
-     {
-       applyThingToFieldEngineBase(fieldEngineBase.subField(i), thing);
-     }
-   }
- }
- 
- #endif // POOMA_FIELD_FIELDENGINE_FIELDENGINEBASE_H
- 
- // ACL:rcsinfo
- // ----------------------------------------------------------------------
- // $RCSfile: FieldEngineBase.h,v $   $Author: oldham $
- // $Revision: 1.1 $   $Date: 2001/08/30 01:15:11 $
- // ----------------------------------------------------------------------
- // ACL:rcsinfo
--- 0 ----
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000727.html">[pooma-dev] SSH Configuration
</A></li>
	<LI>Next message: <A HREF="000729.html">Field/Updater Tests?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#728">[ date ]</a>
              <a href="thread.html#728">[ thread ]</a>
              <a href="subject.html#728">[ subject ]</a>
              <a href="author.html#728">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">More information about the pooma-dev
mailing list</a><br>
</body></html>
