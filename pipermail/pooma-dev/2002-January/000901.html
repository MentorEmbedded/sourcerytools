<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Manual Patch: Programs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20Manual%20Patch%3A%20Programs&In-Reply-To=%3C20020131142550.A29745%40vaio.codesourcery.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000900.html">
   <LINK REL="Next"  HREF="000902.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Manual Patch: Programs</H1>
    <B>Jeffrey</B> 
    <A HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20Manual%20Patch%3A%20Programs&In-Reply-To=%3C20020131142550.A29745%40vaio.codesourcery.com%3E"
       TITLE="Manual Patch: Programs">oldham at mail.codesourcery.com
       </A><BR>
    <I>Thu Jan 31 22:25:50 UTC 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="000900.html">Manual Patch: Tidy Programs
</A></li>
        <LI>Next message: <A HREF="000902.html">Manual Patch: Example Code 1 of x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#901">[ date ]</a>
              <a href="thread.html#901">[ thread ]</a>
              <a href="subject.html#901">[ subject ]</a>
              <a href="author.html#901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The files containing the DocBook annotations for programs included in
the POOMA manual got mangled.  Hopefully, the attached changes ensured
every file appears exactly once.

Sorry,
Jeffrey D. Oldham
<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">oldham at codesourcery.com</A>
-------------- next part --------------
? programs-2002Jan31.patch
Index: Makefile
===================================================================
RCS file: Makefile
diff -N Makefile
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Makefile	Thu Jan 31 15:19:46 2002
***************
*** 0 ****
--- 1,15 ----
+ ### Oldham, Jeffrey D.
+ ### 2001Nov27
+ ### Pooma
+ ###
+ ### Produce Annotated Source Code
+ 
+ ## These rules combine executable code, which can be compiled and run,
+ ## with DocBook annotations used in the manual to explain the code.
+ 
+ all: array-copy-annotated.cpp dynamicarray-annotated.cpp \
+      initialize-finalize-annotated.cpp \
+      pairs-templated-annotated.cpp pairs-untemplated-annotated.cpp
+ 
+ %-annotated.cpp: %-annotated.patch %.cpp
+ 	patch -o $@ &lt; $&lt;
Index: array-copy-annotated.patch
===================================================================
RCS file: array-copy-annotated.patch
diff -N array-copy-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- array-copy-annotated.patch	Thu Jan 31 15:19:46 2002
***************
*** 0 ****
--- 1,78 ----
+ *** array-copy.cpp	Thu Jan 24 11:12:23 2002
+ --- array-copy-annotated.cpp	Thu Jan 31 09:22:57 2002
+ ***************
+ *** 1,8 ****
+   #include &quot;Pooma/Pooma.h&quot;
+   #include &quot;Pooma/Arrays.h&quot;
+ ! #include &lt;iostream&gt;
+   
+   // Changes the Array value at index (0,0).
+ ! void changeValue(Array&lt;2,int,Brick&gt;&amp; z)
+   { z(0,0) = 6; }
+   
+ --- 1,9 ----
+ + &lt;programlisting id=&quot;array-copy-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+   #include &quot;Pooma/Pooma.h&quot;
+   #include &quot;Pooma/Arrays.h&quot;
+ ! #include &lt;iostream&gt;
+   
+   // Changes the Array value at index (0,0).
+ ! void changeValue(Array&lt;2,int,Brick&gt;&amp; z)
+   { z(0,0) = 6; }
+   
+ ***************
+ *** 11,35 ****
+     Pooma::initialize(argc,argv);
+   
+ !   Array&lt;2,int,Brick&gt; a(3,4, ModelElement&lt;int&gt;(4));
+ !   std::cout &lt;&lt; &quot;Initial value:\n&quot;;
+ !   std::cout &lt;&lt; &quot;a: &quot; &lt;&lt; a(0,0) &lt;&lt; std::endl;
+   
+     // Array copies share the same underlying values.
+   
+ !   // Explicit initialization uses reference semantics so changing the
+ !   // copy's value at (0,0) also changes the original's value.
+ !   Array&lt;2,int,Brick&gt; b(a);
+     b(0,0) = 5;
+ !   std::cout &lt;&lt; &quot;After explicit initialization.\n&quot;;
+ !   std::cout &lt;&lt; &quot;a: &quot; &lt;&lt; a(0,0) &lt;&lt; std::endl;
+ !   std::cout &lt;&lt; &quot;b: &quot; &lt;&lt; b(0,0) &lt;&lt; std::endl;
+ ! 
+ !   // Initialization of function arguments also uses reference semantics.
+ !   std::cout &lt;&lt; &quot;After function call:\n&quot;;
+     changeValue(a);
+ !   std::cout &lt;&lt; &quot;a: &quot; &lt;&lt; a(0,0) &lt;&lt; std::endl;
+ !   std::cout &lt;&lt; &quot;b: &quot; &lt;&lt; b(0,0) &lt;&lt; std::endl;
+   
+     Pooma::finalize();
+     return 0;
+   }
+ --- 12,39 ----
+     Pooma::initialize(argc,argv);
+   
+ !   Array&lt;2,int,Brick&gt; a(3,4, ModelElement&lt;int&gt;(4));
+ !   std::cout &openopen; &quot;Initial value:\n&quot;;
+ !   std::cout &openopen; &quot;a: &quot; &openopen; a(0,0) &openopen; std::endl;
+   
+     // Array copies share the same underlying values.
+   
+ !   // Explicit initialization uses reference semantics
+ !   // so changing the copy's value at (0,0) also
+ !   // changes the original's value.
+ !   Array&lt;2,int,Brick&gt; b(a);
+     b(0,0) = 5;
+ !   std::cout &openopen; &quot;After explicit initialization.\n&quot;;
+ !   std::cout &openopen; &quot;a: &quot; &openopen; a(0,0) &openopen; std::endl;
+ !   std::cout &openopen; &quot;b: &quot; &openopen; b(0,0) &openopen; std::endl;
+ ! 
+ !   // Initialization of function arguments also uses
+ !   // reference semantics.
+ !   std::cout &openopen; &quot;After function call:\n&quot;;
+     changeValue(a);
+ !   std::cout &openopen; &quot;a: &quot; &openopen; a(0,0) &openopen; std::endl;
+ !   std::cout &openopen; &quot;b: &quot; &openopen; b(0,0) &openopen; std::endl;
+   
+     Pooma::finalize();
+     return 0;
+   }
+ + &lt;/programlisting&gt;
Index: array-size-annotated.patch
===================================================================
RCS file: array-size-annotated.patch
diff -N array-size-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- array-size-annotated.patch	Thu Jan 31 15:19:46 2002
***************
*** 0 ****
--- 1,80 ----
+ *** array-size.cpp	Tue Jan 15 13:30:53 2002
+ --- array-size-annotated.cpp	Thu Jan 31 09:24:16 2002
+ ***************
+ *** 1,25 ****
+   #include &quot;Pooma/Pooma.h&quot;
+   #include &quot;Pooma/Arrays.h&quot;
+ ! #include &lt;iostream&gt;
+   
+   // Print an Array's Size
+   
+ ! // This program illustrates using the Array member functions.
+ ! // computeArraySize's computation is redundant because Array's size()
+ ! // function computes the same value, but it illustrates using Array
+   // member functions.
+   
+ ! template &lt;int Dim, typename Type, typename EngineTag&gt;
+   inline
+ ! long computeArraySize(const Array&lt;Dim,Type,EngineTag&gt;&amp; a)
+   {
+ !   const Loc&lt;Dim&gt; fs = a.firsts();
+ !   const Loc&lt;Dim&gt; ls = a.lasts();
+ !   const Loc&lt;Dim&gt; lens = a.lengths();
+     long size = 1;
+ !   for (int d = 0; d &lt; Dim; ++d) {
+ !     size *= lens[d].first();
+       // Check that lengths() and our computed lengths agree.
+ !     PAssert((ls[d] - fs[d] + 1).first() == a.length(d));
+     }
+     return size;
+ --- 1,27 ----
+ + &lt;programlisting id=&quot;array-size-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+   #include &quot;Pooma/Pooma.h&quot;
+   #include &quot;Pooma/Arrays.h&quot;
+ ! #include &lt;iostream&gt;
+   
+   // Print an Array's Size
+   
+ ! // This program illustrates using the Array member
+ ! // functions.  computeArraySize's computation is
+ ! // redundant because Array's size() function computes
+ ! // the same value, but it illustrates using Array
+   // member functions.
+   
+ ! template &lt;int Dim,typename Type,typename EngineTag&gt;  &lt;co id=&quot;arrays-arrays_use-members-example-template_parameters&quot;&gt;&lt;/co&gt;
+   inline
+ ! long computeArraySize(const Array&lt;Dim,Type,EngineTag&gt;&amp; a)
+   {
+ !   const Loc&lt;Dim&gt; fs = a.firsts();  &lt;co id=&quot;arrays-arrays_use-members-example-function_call&quot;&gt;&lt;/co&gt;
+ !   const Loc&lt;Dim&gt; ls = a.lasts();
+ !   const Loc&lt;Dim&gt; lens = a.lengths();
+     long size = 1;
+ !   for (int d = 0; d &lt; Dim; ++d) {
+ !     size *= lens[d].first();  &lt;co id=&quot;arrays-arrays_use-members-example-loc_use&quot;&gt;&lt;/co&gt;
+       // Check that lengths() and our computed lengths agree.
+ !     PAssert((ls[d]-fs[d]+1).first()==a.length(d));  &lt;co id=&quot;arrays-arrays_use-members-example-check_length&quot;&gt;&lt;/co&gt;
+     }
+     return size;
+ ***************
+ *** 30,38 ****
+     Pooma::initialize(argc,argv);
+   
+ !   Array&lt;3,int,Brick&gt; a(3,4,5, ModelElement&lt;int&gt;(4));
+ !   PAssert(computeArraySize(a) == a.size());
+ !   std::cout &lt;&lt; &quot;The array's size is &quot; &lt;&lt; a.size() &lt;&lt; &quot;.\n&quot;;
+   
+     Pooma::finalize();
+     return 0;
+   }
+ --- 32,42 ----
+     Pooma::initialize(argc,argv);
+   
+ !   Array&lt;3,int,Brick&gt; a(3,4,5, ModelElement&lt;int&gt;(4));
+ !   PAssert(computeArraySize(a) == a.size());  &lt;co id=&quot;arrays-arrays_use-members-example-compare_size&quot;&gt;&lt;/co&gt;
+ !   std::cout &openopen;
+ !     &quot;The array's size is &quot; &openopen; a.size() &openopen; &quot;.\n&quot;;
+   
+     Pooma::finalize();
+     return 0;
+   }
+ + &lt;/programlisting&gt;
Index: dynamicarray-annotated.patch
===================================================================
RCS file: dynamicarray-annotated.patch
diff -N dynamicarray-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- dynamicarray-annotated.patch	Thu Jan 31 15:19:46 2002
***************
*** 0 ****
--- 1,80 ----
+ *** dynamicarray.cpp	Mon Jan 21 17:29:38 2002
+ --- dynamicarray-annotated.cpp	Tue Jan 22 07:06:15 2002
+ ***************
+ *** 1,5 ****
+   #include &quot;Pooma/Pooma.h&quot;
+ ! #include &quot;Pooma/DynamicArrays.h&quot;
+ ! #include &lt;iostream&gt;
+   
+   // Demonstrate using DynamicArrays.
+ --- 1,6 ----
+ + &lt;programlisting id=&quot;dynamicarray-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+   #include &quot;Pooma/Pooma.h&quot;
+ ! #include &quot;Pooma/DynamicArrays.h&quot;  &lt;co id=&quot;arrays-dynamic_arrays-example-header&quot;&gt;&lt;/co&gt;
+ ! #include &lt;iostream&gt;
+   
+   // Demonstrate using DynamicArrays.
+ ***************
+ *** 9,38 ****
+     Pooma::initialize(argc,argv);
+   
+ !   // Create a DynamicArray with one element.
+ !   DynamicArray&lt;&gt; d0(1);
+ !   DynamicArray&lt;double&gt; d01(1);
+ !   DynamicArray&lt;double, Dynamic&gt; d02(1);
+   
+ !   // Add five more elements.
+     d0.create(5);
+     // Store values in the array.
+ !   for (int i = d0.domain().first(); i &lt;= d0.domain().last(); ++i)
+ !     d0(i) = i;
+   
+ !   // Delete every other element.
+ !   d0.destroy(Range&lt;1&gt;(d0.domain().first(),d0.domain().last(),2), BackFill());
+   
+     // Print the resulting array.
+ !   std::cout &lt;&lt; d0 &lt;&lt; std::endl;
+   
+     // Use the iterator form of 'destroy.'
+ !   DynamicArray&lt;&gt; d1(6);
+     for (int i = d1.domain().first(); i &lt;= d1.domain().last(); ++i)
+       d1(i) = i;
+ !   int killList[] = { 0, 2, 4 };
+     d1.destroy(killList, killList+3);
+ !   std::cout &lt;&lt; d1 &lt;&lt; std::endl;
+   
+     Pooma::finalize();
+     return 0;
+   }
+ --- 10,40 ----
+     Pooma::initialize(argc,argv);
+   
+ !   // Create a DynamicArray with one element.  &lt;co id=&quot;arrays-dynamic_arrays-example-identical_declarations&quot;&gt;&lt;/co&gt;
+ !   DynamicArray&lt;&gt; d0(1);
+ !   DynamicArray&lt;double&gt; d01(1);
+ !   DynamicArray&lt;double, Dynamic&gt; d02(1);
+   
+ !   // Add five more elements.  &lt;co id=&quot;arrays-dynamic_arrays-example-extension&quot;&gt;&lt;/co&gt;
+     d0.create(5);
+     // Store values in the array.
+ !   for (int i = d0.domain().first(); i &lt;= d0.domain().last(); ++i)
+ !     d0(i) = i;  &lt;co id=&quot;arrays-dynamic_arrays-example-access&quot;&gt;&lt;/co&gt;
+   
+ !   // Delete every other element.  &lt;co id=&quot;arrays-dynamic_arrays-example-destroy_range&quot;&gt;&lt;/co&gt;
+ !   d0.destroy(Range&lt;1&gt;(d0.domain().first(),d0.domain().last(),2), BackFill());
+   
+     // Print the resulting array.
+ !   std::cout &openopen; d0 &openopen; std::endl;
+   
+     // Use the iterator form of 'destroy.'
+ !   DynamicArray&lt;&gt; d1(6);
+     for (int i = d1.domain().first(); i &lt;= d1.domain().last(); ++i)
+       d1(i) = i;
+ !   int killList[] = { 0, 2, 4 };  &lt;co id=&quot;arrays-dynamic_arrays-example-destroy_iterators&quot;&gt;&lt;/co&gt;
+     d1.destroy(killList, killList+3);
+ !   std::cout &openopen; d1 &openopen; std::endl;
+   
+     Pooma::finalize();
+     return 0;
+   }
+ + &lt;/programlisting&gt;
Index: initialize-finalize-annotated.patch
===================================================================
RCS file: initialize-finalize-annotated.patch
diff -N initialize-finalize-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- initialize-finalize-annotated.patch	Thu Jan 31 15:19:46 2002
***************
*** 0 ****
--- 1,20 ----
+ *** initialize-finalize.cpp	Thu Jan 24 11:14:13 2002
+ --- initialize-finalize-annotated.cpp	Thu Jan 24 11:14:17 2002
+ ***************
+ *** 1,4 ****
+   #include &quot;Pooma/Pooma.h&quot;
+ ! #include &lt;iostream&gt;
+   
+   int main(int argc, char *argv[])
+ --- 1,5 ----
+ + &lt;programlisting id=&quot;initialize-finalize-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+   #include &quot;Pooma/Pooma.h&quot;
+ ! #include &lt;iostream&gt;
+   
+   int main(int argc, char *argv[])
+ ***************
+ *** 11,12 ****
+ --- 12,14 ----
+     return 0;
+   }
+ + &lt;/programlisting&gt;
Index: pairs-templated-annotated.patch
===================================================================
RCS file: pairs-templated-annotated.patch
diff -N pairs-templated-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- pairs-templated-annotated.patch	Thu Jan 31 15:19:46 2002
***************
*** 0 ****
--- 1,38 ----
+ *** pairs-templated.cpp	Mon Jan  7 16:11:56 2002
+ --- pairs-templated-annotated.cpp	Thu Jan 31 08:44:35 2002
+ ***************
+ *** 1,15 ****
+ ! // Declare a template class storing a pair of values with the same type.
+ ! template &lt;typename T&gt;
+   struct pair {
+ !   pair(const int&amp; left, const int&amp; right)
+       : left_(left), right_(right) {}
+   
+ !   T left_;
+     T right_;
+   };
+   
+ ! // Define a class storing a pair of integers.
+ ! pair&lt;int&gt; pair1;
+   
+ ! // Define a class storing a pair of doubles;
+ ! pair&lt;double&gt; pair2;
+ --- 1,18 ----
+ ! &lt;programlisting id=&quot;template_programming-template_use-templated_pair_program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! // Declare a template class storing a pair of values
+ ! // with the same type.
+ ! template &lt;typename T&gt;  // &lt;co id=&quot;template_programming-template_use-templated_pair_program-template_declaration&quot;&gt;&lt;/co&gt;
+   struct pair {
+ !   pair(const T&amp; left, const T&amp; right)  // &lt;co id=&quot;template_programming-template_use-templated_pair_program-constructor&quot;&gt;&lt;/co&gt;
+       : left_(left), right_(right) {}
+   
+ !   T left_;  // &lt;co id=&quot;template_programming-template_use-templated_pair_program-members&quot;&gt;&lt;/co&gt;
+     T right_;
+   };
+   
+ ! // Use a class storing a pair of integers. &lt;co id=&quot;template_programming-template_use-templated_pair_program-use&quot;&gt;&lt;/co&gt;
+ ! pair&lt;int&gt; pair1;
+   
+ ! // Use a class storing a pair of doubles;
+ ! pair&lt;double&gt; pair2;
+ ! &lt;/programlisting&gt;
Index: pairs-untemplated-annotated.patch
===================================================================
RCS file: pairs-untemplated-annotated.patch
diff -N pairs-untemplated-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- pairs-untemplated-annotated.patch	Thu Jan 31 15:19:46 2002
***************
*** 0 ****
--- 1,35 ----
+ *** pairs-untemplated.cpp	Wed Dec 26 13:48:10 2001
+ --- pairs-untemplated-annotated.cpp	Wed Dec 26 14:02:58 2001
+ ***************
+ *** 1,5 ****
+   // Declare a class storing a pair of integers.
+   struct pairOfInts {
+ !   pairOfInts(const int&amp; left, const int&amp; right)
+       : left_(left), right_(right) {}
+   
+ --- 1,6 ----
+ + &lt;programlisting id=&quot;template_programming-template_use-untemplated_pair_program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+   // Declare a class storing a pair of integers.
+   struct pairOfInts {
+ !   pairOfInts(const int&amp; left, const int&amp; right)
+       : left_(left), right_(right) {}
+   
+ ***************
+ *** 10,14 ****
+   // Declare a class storing a pair of doubles.
+   struct pairOfDoubles {
+ !   pairOfDoubles(const double&amp; left, const double&amp; right)
+       : left_(left), right_(right) {}
+   
+ --- 11,15 ----
+   // Declare a class storing a pair of doubles.
+   struct pairOfDoubles {
+ !   pairOfDoubles(const double&amp; left, const double&amp; right)
+       : left_(left), right_(right) {}
+   
+ ***************
+ *** 16,17 ****
+ --- 17,19 ----
+     double right_;
+   };
+ + &lt;/programlisting&gt;
-------------- next part --------------
Index: Doof2d-Array-distributed-annotated.patch
===================================================================
RCS file: Doof2d-Array-distributed-annotated.patch
diff -N Doof2d-Array-distributed-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Doof2d-Array-distributed-annotated.patch	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,251 ----
+ *** Doof2d-Array-distributed.cpp	Mon Jan 28 20:35:07 2002
+ --- Doof2d-Array-distributed-annotated.cpp	Thu Jan 31 09:12:19 2002
+ ***************
+ *** 1,6 ****
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;	// has POOMA's Array declarations
+   
+ ! // Doof2d: POOMA Arrays, stencil, multiple processor implementation
+   
+   // Define the stencil class performing the computation.
+ --- 1,10 ----
+ ! &lt;programlisting id=&quot;tutorial-array_distributed-doof2d-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;
+ !     // has POOMA's Array declarations
+   
+ ! // Doof2d: POOMA Arrays, stencil, multiple
+ ! // processor implementation
+   
+   // Define the stencil class performing the computation.
+ ***************
+ *** 11,26 ****
+     DoofNinePt() : weight(1.0/9.0) {}
+   
+ !   // This stencil operator is applied to each interior domain position
+ !   // (i,j).  The &quot;C&quot; template parameter permits use of this stencil
+     // operator with both Arrays and Fields.
+ !   template &lt;class C&gt;
+     inline
+     typename C::Element_t
+ !   operator()(const C&amp; x, int i, int j) const
+ !   {
+ !     return ( weight *
+ !              ( x.read(i+1,j+1) + x.read(i+1,j  ) + x.read(i+1,j-1) +
+ !                x.read(i  ,j+1) + x.read(i  ,j  ) + x.read(i  ,j-1) +
+ !                x.read(i-1,j+1) + x.read(i-1,j  ) + x.read(i-1,j-1) ) );
+     }
+   
+ --- 15,31 ----
+     DoofNinePt() : weight(1.0/9.0) {}
+   
+ !   // This stencil operator is applied to each interior
+ !   // domain position (i,j).  The &quot;C&quot; template
+ !   // parameter permits use of this stencil
+     // operator with both Arrays and Fields.
+ !   template &lt;class C&gt;
+     inline
+     typename C::Element_t
+ !   operator()(const C&amp; x, int i, int j) const {
+ !     return
+ !       weight *
+ !       (x.read(i+1,j+1)+x.read(i+1,j)+x.read(i+1,j-1) +
+ !        x.read(i  ,j+1)+x.read(i  ,j)+x.read(i  ,j-1) +
+ !        x.read(i-1,j+1)+x.read(i-1,j)+x.read(i-1,j-1));
+     }
+   
+ ***************
+ *** 39,52 ****
+     Pooma::initialize(argc,argv);
+   
+ !   // Since multiple copies of this program may simultaneously run, we
+ !   // cannot use standard input and output.  Instead we use command-line
+ !   // arguments, which are replicated, for input, and we use an Inform
+ !   // stream for output.
+     Inform output;
+   
+ !   // Read the program input from the command-line arguments.
+     if (argc != 4) {
+       // Incorrect number of command-line arguments.
+ !     output &lt;&lt; argv[0] &lt;&lt; &quot;: number-of-processors number-of-averagings number-of-values&quot; &lt;&lt; std::endl;
+       return EXIT_FAILURE;
+     }
+ --- 44,63 ----
+     Pooma::initialize(argc,argv);
+   
+ !   // Since multiple copies of this program may simul-
+ !   // taneously run, we cannot use standard input and
+ !   // output.  Instead we use command-line arguments,
+ !   // which are replicated, for input, and we use an
+ !   // Inform stream for output.  &lt;co id=&quot;tutorial-array_distributed-doof2d-io&quot;&gt;&lt;/co&gt;
+     Inform output;
+   
+ !   // Read the program input from the command-line
+ !   // arguments.
+     if (argc != 4) {
+       // Incorrect number of command-line arguments.
+ !     output &openopen;
+ !       argv[0] &openopen;
+ !       &quot;: number-of-processors number-of-averagings&quot;
+ !       &openopen; &quot; number-of-values&quot;
+ !       &openopen; std::endl;
+       return EXIT_FAILURE;
+     }
+ ***************
+ *** 55,112 ****
+     // Determine the number of processors.
+     long nuProcessors;
+ !   nuProcessors = strtol(argv[1], &amp;tail, 0);
+   
+     // Determine the number of averagings.
+     long nuAveragings, nuIterations;
+ !   nuAveragings = strtol(argv[2], &amp;tail, 0);
+ !   nuIterations = (nuAveragings+1)/2; // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one dimension of
+ !   // the grid.
+     long n;
+ !   n = strtol(argv[3], &amp;tail, 0);
+ !   // The dimension must be a multiple of the number of processors
+ !   // since we are using a UniformGridLayout.
+ !   n = ((n+nuProcessors-1) / nuProcessors) * nuProcessors;
+   
+     // Specify the arrays' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;2&gt; interiorDomain(I,I);
+   
+     // Create the distributed arrays.
+ !   // Partition the arrays' domains uniformly, i.e., each patch has the
+ !   // same size.  The first parameter tells how many patches for each
+ !   // dimension.  Guard layers optimize communication between patches.
+ !   // Internal guards surround each patch.  External guards surround
+ !   // the entire array domain.
+ !   UniformGridPartition&lt;2&gt; partition(Loc&lt;2&gt;(nuProcessors, nuProcessors),
+ ! 				    GuardLayers&lt;2&gt;(1),  // internal
+ ! 				    GuardLayers&lt;2&gt;(0)); // external
+ !   UniformGridLayout&lt;2&gt; layout(vertDomain, partition, DistributedTag());
+ ! 
+ !   // The Array template parameters indicate 2 dimensions and a 'double'
+ !   // value type.  MultiPatch indicates multiple computation patches,
+ !   // i.e., distributed computation.  The UniformTag indicates the
+ !   // patches should have the same size.  Each patch has Brick type.
+ !   Array&lt;2, double, MultiPatch&lt;UniformTag, Remote&lt;Brick&gt; &gt; &gt; a(layout);
+ !   Array&lt;2, double, MultiPatch&lt;UniformTag, Remote&lt;Brick&gt; &gt; &gt; b(layout);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+   
+     // Create the stencil performing the computation.
+ !   Stencil&lt;DoofNinePt&gt; stencil;
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.
+       a(interiorDomain) = stencil(b, interiorDomain);
+   
+ --- 66,137 ----
+     // Determine the number of processors.
+     long nuProcessors;
+ !   nuProcessors = strtol(argv[1], &amp;tail, 0);
+   
+     // Determine the number of averagings.
+     long nuAveragings, nuIterations;
+ !   nuAveragings = strtol(argv[2], &amp;tail, 0);
+ !   nuIterations = (nuAveragings+1)/2;
+ !     // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along 
+ !   // one dimension of the grid.
+     long n;
+ !   n = strtol(argv[3], &amp;tail, 0);
+ !   // The dimension must be a multiple of the number 
+ !   // of processors since we are using a
+ !   // UniformGridLayout.
+ !   n=((n+nuProcessors-1)/nuProcessors)*nuProcessors;
+   
+     // Specify the arrays' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1)
+ !   // for computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;2&gt; interiorDomain(I,I);
+   
+     // Create the distributed arrays.
+ ! 
+ !   // Partition the arrays' domains uniformly, i.e.,
+ !   // each patch has the same size.  The first para-
+ !   // meter tells how many patches for each dimension.
+ !   // Guard layers optimize communication between
+ !   // patches.  Internal guards surround each patch.
+ !   // External guards surround the entire array
+ !   // domain.  &lt;co id=&quot;tutorial-array_distributed-doof2d-layout&quot;&gt;&lt;/co&gt;
+ !   UniformGridPartition&lt;2&gt; 
+ !     partition(Loc&lt;2&gt;(nuProcessors, nuProcessors),
+ ! 	     GuardLayers&lt;2&gt;(1),  // internal
+ ! 	     GuardLayers&lt;2&gt;(0)); // external
+ !   UniformGridLayout&lt;2&gt; layout(vertDomain, partition,
+ ! 				    DistributedTag());
+ ! 
+ !   // The Array template parameters indicate 2 dims
+ !   // and a 'double' value type. MultiPatch indicates
+ !   // multiple computation patches, i.e, distributed
+ !   // computation.  The UniformTag indicates the
+ !   // patches should have the same size.  Each patch
+ !   // has Brick type.  &lt;co id=&quot;tutorial-array_distributed-doof2d-remote&quot;&gt;&lt;/co&gt;
+ !   Array&lt;2, double, MultiPatch&lt;UniformTag,
+ ! 	   Remote&lt;Brick&gt; &gt; &gt; a(layout);
+ !   Array&lt;2, double, MultiPatch&lt;UniformTag,
+ !            Remote&lt;Brick&gt; &gt; &gt; b(layout);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the
+ !   // central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes
+ !   // before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+   
+     // Create the stencil performing the computation.
+ !   Stencil&lt;DoofNinePt&gt; stencil;
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.  &lt;co id=&quot;tutorial-array_distributed-doof2d-first_write&quot;&gt;&lt;/co&gt;
+       a(interiorDomain) = stencil(b, interiorDomain);
+   
+ ***************
+ *** 116,121 ****
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();	// Ensure all computation has finished.
+ !   output &lt;&lt; (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2)) &lt;&lt; std::endl;
+   
+     // The arrays are automatically deallocated.
+ --- 141,149 ----
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();
+ !     // Ensure all computation has finished.
+ !   output &openopen;
+ !     (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2))
+ !     &openopen; std::endl;
+   
+     // The arrays are automatically deallocated.
+ ***************
+ *** 125,126 ****
+ --- 153,155 ----
+     return EXIT_SUCCESS;
+   }
+ + &lt;/programlisting&gt;
Index: Doof2d-Array-element-annotated.patch
===================================================================
RCS file: Doof2d-Array-element-annotated.patch
diff -N Doof2d-Array-element-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Doof2d-Array-element-annotated.patch	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,149 ----
+ *** Doof2d-Array-element.cpp	Wed Jan 23 19:18:17 2002
+ --- Doof2d-Array-element-annotated.cpp	Thu Jan 31 08:55:57 2002
+ ***************
+ *** 1,5 ****
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;	// has POOMA's Array declarations
+   
+   // Doof2d: POOMA Arrays, element-wise implementation
+ --- 1,7 ----
+ ! &lt;programlisting id=&quot;tutorial-array_elementwise-doof2d-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;
+ !     // has POOMA's Array declarations  &lt;co id=&quot;tutorial-array_elementwise-doof2d-header&quot;&gt;&lt;/co&gt;
+   
+   // Doof2d: POOMA Arrays, element-wise implementation
+ ***************
+ *** 7,37 ****
+   int main(int argc, char *argv[])
+   {
+ !   // Prepare the POOMA library for execution.
+     Pooma::initialize(argc,argv);
+     
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &lt;&lt; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &gt;&gt; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2; // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one dimension of
+ !   // the grid.
+     long n;
+ !   std::cout &lt;&lt; &quot;Please enter the array size: &quot;;
+ !   std::cin &gt;&gt; n;
+   
+ !   // Specify the arrays' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+ ! 
+ !   // Create the arrays.
+ !   // The Array template parameters indicate 2 dimensions, a 'double' value
+     // type, and ordinary 'Brick' storage.
+ !   Array&lt;2, double, Brick&gt; a(vertDomain);
+ !   Array&lt;2, double, Brick&gt; b(vertDomain);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the central value.
+     for (int j = 1; j &lt; n-1; j++)
+       for (int i = 1; i &lt; n-1; i++)
+ --- 9,42 ----
+   int main(int argc, char *argv[])
+   {
+ !   // Prepare the POOMA library for execution.  &lt;co id=&quot;tutorial-array_elementwise-doof2d-pooma_initialize&quot;&gt;&lt;/co&gt;
+     Pooma::initialize(argc,argv);
+     
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &openopen; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &closeclose; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2;
+ !     // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along
+ !   // one dimension of the grid.
+     long n;
+ !   std::cout &openopen; &quot;Please enter the array size: &quot;;
+ !   std::cin &closeclose; n;
+   
+ !   // Specify the arrays' domains [0,n) x [0,n).  &lt;co id=&quot;tutorial-array_elementwise-doof2d-domain&quot;&gt;&lt;/co&gt;
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+ ! 
+ !   // Create the arrays.  &lt;co id=&quot;tutorial-array_elementwise-doof2d-array_creation&quot;&gt;&lt;/co&gt;
+ !   // The Array template parameters indicate
+ !   // 2 dimensions, a 'double' value
+     // type, and ordinary 'Brick' storage.
+ !   Array&lt;2, double, Brick&gt; a(vertDomain);
+ !   Array&lt;2, double, Brick&gt; b(vertDomain);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the
+ !   // central value.  &lt;co id=&quot;tutorial-array_elementwise-doof2d-initialization&quot;&gt;&lt;/co&gt;
+     for (int j = 1; j &lt; n-1; j++)
+       for (int i = 1; i &lt; n-1; i++)
+ ***************
+ *** 43,51 ****
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+       // Read from b.  Write to a.
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+ !         a(i,j) = weight *
+             (b(i+1,j+1) + b(i+1,j  ) + b(i+1,j-1) +
+              b(i  ,j+1) + b(i  ,j  ) + b(i  ,j-1) +
+ --- 48,56 ----
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+       // Read from b.  Write to a.
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+ !         a(i,j) = weight *  &lt;co id=&quot;tutorial-array_elementwise-doof2d-first_write&quot;&gt;&lt;/co&gt;
+             (b(i+1,j+1) + b(i+1,j  ) + b(i+1,j-1) +
+              b(i  ,j+1) + b(i  ,j  ) + b(i  ,j-1) +
+ ***************
+ *** 53,58 ****
+   
+       // Read from a.  Write to b.
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+           b(i,j) = weight *
+             (a(i+1,j+1) + a(i+1,j  ) + a(i+1,j-1) +
+ --- 58,63 ----
+   
+       // Read from a.  Write to b.
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+           b(i,j) = weight *
+             (a(i+1,j+1) + a(i+1,j  ) + a(i+1,j-1) +
+ ***************
+ *** 62,71 ****
+   
+     // Print out the final central value.
+ !   std::cout &lt;&lt; (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2)) &lt;&lt; std::endl;
+   
+ !   // The arrays are automatically deallocated.
+   
+ !   // Tell the POOMA library execution has finished.
+     Pooma::finalize();
+     return EXIT_SUCCESS;
+   }
+ --- 67,81 ----
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();
+ !     // Ensure all computation has finished.
+ !   std::cout &openopen;
+ !      (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2))
+ !      &openopen; std::endl;
+   
+ !   // The arrays are automatically deallocated.  &lt;co id=&quot;tutorial-array_elementwise-doof2d-deallocation&quot;&gt;&lt;/co&gt;
+   
+ !   // Tell the POOMA library execution finished.  &lt;co id=&quot;tutorial-array_elementwise-doof2d-pooma_finish&quot;&gt;&lt;/co&gt;
+     Pooma::finalize();
+     return EXIT_SUCCESS;
+   }
+ + &lt;/programlisting&gt;
Index: Doof2d-Array-parallel-annotated.patch
===================================================================
RCS file: Doof2d-Array-parallel-annotated.patch
diff -N Doof2d-Array-parallel-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Doof2d-Array-parallel-annotated.patch	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,128 ----
+ *** Doof2d-Array-parallel.cpp	Wed Jan 23 19:18:32 2002
+ --- Doof2d-Array-parallel-annotated.cpp	Mon Jan 28 20:41:18 2002
+ ***************
+ *** 1,5 ****
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;	// has POOMA's Array declarations
+   
+   // Doof2d: POOMA Arrays, data-parallel implementation
+ --- 1,7 ----
+ ! &lt;programlisting id=&quot;tutorial-array_parallel-doof2d-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;
+ !     // has POOMA's Array declarations
+   
+   // Doof2d: POOMA Arrays, data-parallel implementation
+ ***************
+ *** 12,43 ****
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &lt;&lt; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &gt;&gt; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2; // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one dimension of
+ !   // the grid.
+     long n;
+ !   std::cout &lt;&lt; &quot;Please enter the array size: &quot;;
+ !   std::cin &gt;&gt; n;
+   
+     // Specify the arrays' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;1&gt; J(1,n-2);
+   
+     // Create the arrays.
+ !   // The Array template parameters indicate 2 dimensions, a 'double' value
+     // type, and ordinary 'Brick' storage.
+ !   Array&lt;2, double, Brick&gt; a(vertDomain);
+ !   Array&lt;2, double, Brick&gt; b(vertDomain);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+ --- 14,50 ----
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &openopen; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &closeclose; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2;
+ !     // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one
+ !   // dimension of the grid.
+     long n;
+ !   std::cout &openopen; &quot;Please enter the array size: &quot;;
+ !   std::cin &closeclose; n;
+   
+     // Specify the arrays' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) 
+ !   // for computation.  &lt;co id=&quot;tutorial-array_parallel-doof2d-innerdomain&quot;&gt;&lt;/co&gt;
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;1&gt; J(1,n-2);
+   
+     // Create the arrays.
+ !   // The Array template parameters indicate 2 dimensions,
+ !   //  a 'double' value
+     // type, and ordinary 'Brick' storage.
+ !   Array&lt;2, double, Brick&gt; a(vertDomain);
+ !   Array&lt;2, double, Brick&gt; b(vertDomain);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the
+ !   // central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes
+ !   // before accessing a value.  &lt;co id=&quot;tutorial-array_parallel-doof2d-blockAndEvaluate&quot;&gt;&lt;/co&gt;
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+ ***************
+ *** 47,52 ****
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.
+       a(I,J) = weight *
+         (b(I+1,J+1) + b(I+1,J  ) + b(I+1,J-1) +
+ --- 54,59 ----
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.  &lt;co id=&quot;tutorial-array_parallel-doof2d-first_write&quot;&gt;&lt;/co&gt;
+       a(I,J) = weight *
+         (b(I+1,J+1) + b(I+1,J  ) + b(I+1,J-1) +
+ ***************
+ *** 62,67 ****
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();	// Ensure all computation has finished.
+ !   std::cout &lt;&lt; (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2)) &lt;&lt; std::endl;
+   
+     // The arrays are automatically deallocated.
+ --- 69,77 ----
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();
+ !     // Ensure all computation has finished.
+ !   std::cout &openopen;
+ !     (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2))
+ !     &openopen; std::endl;
+   
+     // The arrays are automatically deallocated.
+ ***************
+ *** 71,72 ****
+ --- 81,83 ----
+     return EXIT_SUCCESS;
+   }
+ + &lt;/programlisting&gt;
Index: Doof2d-Array-stencil-annotated.patch
===================================================================
RCS file: Doof2d-Array-stencil-annotated.patch
diff -N Doof2d-Array-stencil-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Doof2d-Array-stencil-annotated.patch	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,181 ----
+ *** Doof2d-Array-stencil.cpp	Wed Jan 23 19:18:49 2002
+ --- Doof2d-Array-stencil-annotated.cpp	Thu Jan 31 09:11:12 2002
+ ***************
+ *** 1,9 ****
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;	// has POOMA's Array declarations
+   
+   // Doof2d: POOMA Arrays, stencil implementation
+   
+ ! // Define the stencil class performing the computation.
+   class DoofNinePt
+   {
+ --- 1,11 ----
+ ! &lt;programlisting id=&quot;tutorial-array_stencil-doof2d-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Arrays.h&quot;
+ !    // has POOMA's Array declarations
+   
+   // Doof2d: POOMA Arrays, stencil implementation
+   
+ ! // Define a stencil class performing computation.  &lt;co id=&quot;tutorial-array_stencil-doof2d-stencil&quot;&gt;&lt;/co&gt;
+   class DoofNinePt
+   {
+ ***************
+ *** 12,30 ****
+     DoofNinePt() : weight(1.0/9.0) {}
+   
+ !   // This stencil operator is applied to each interior domain position
+ !   // (i,j).  The &quot;C&quot; template parameter permits use of this stencil
+ !   // operator with both Arrays and Fields.
+ !   template &lt;class C&gt;
+     inline
+     typename C::Element_t
+ !   operator()(const C&amp; c, int i, int j) const
+ !   {
+ !     return ( weight *
+ !              ( c.read(i+1,j+1) + c.read(i+1,j  ) + c.read(i+1,j-1) +
+ !                c.read(i  ,j+1) + c.read(i  ,j  ) + c.read(i  ,j-1) +
+ !                c.read(i-1,j+1) + c.read(i-1,j  ) + c.read(i-1,j-1) ) );
+     }
+   
+ !   inline int lowerExtent(int) const { return 1; }
+     inline int upperExtent(int) const { return 1; }
+   
+ --- 14,33 ----
+     DoofNinePt() : weight(1.0/9.0) {}
+   
+ !   // This stencil operator is applied to each
+ !   // interior domain position (i,j).  The &quot;C&quot;
+ !   // template parameter permits use of this
+ !   // stencil operator with both Arrays &amp; Fields.  &lt;co id=&quot;tutorial-array_stencil-doof2d-stencil_operator&quot;&gt;&lt;/co&gt;
+ !   template &lt;class C&gt;
+     inline
+     typename C::Element_t
+ !   operator()(const C&amp; c, int i, int j) const {
+ !     return
+ !       weight *
+ !       (c.read(i+1,j+1)+c.read(i+1,j)+c.read(i+1,j-1)+
+ !        c.read(i  ,j+1)+c.read(i  ,j)+c.read(i  ,j-1)+
+ !        c.read(i-1,j+1)+c.read(i-1,j)+c.read(i-1,j-1));
+     }
+   
+ !   inline int lowerExtent(int) const { return 1; }  &lt;co id=&quot;tutorial-array_stencil-doof2d-stencil_extent&quot;&gt;&lt;/co&gt;
+     inline int upperExtent(int) const { return 1; }
+   
+ ***************
+ *** 42,82 ****
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &lt;&lt; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &gt;&gt; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2; // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one dimension of
+ !   // the grid.
+     long n;
+ !   std::cout &lt;&lt; &quot;Please enter the array size: &quot;;
+ !   std::cin &gt;&gt; n;
+   
+     // Specify the arrays' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;2&gt; interiorDomain(I,I);
+   
+     // Create the arrays.
+ !   // The Array template parameters indicate 2 dimensions, a 'double' value
+     // type, and ordinary 'Brick' storage.
+ !   Array&lt;2, double, Brick&gt; a(vertDomain);
+ !   Array&lt;2, double, Brick&gt; b(vertDomain);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+   
+ !   // Create the stencil performing the computation.
+ !   Stencil&lt;DoofNinePt&gt; stencil;
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.
+       a(interiorDomain) = stencil(b, interiorDomain);
+   
+ --- 45,90 ----
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &openopen; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &closeclose; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2;
+ !     // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one
+ !   // dimension of the grid.
+     long n;
+ !   std::cout &openopen; &quot;Please enter the array size: &quot;;
+ !   std::cin &closeclose; n;
+   
+     // Specify the arrays' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for
+ !   // computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;2&gt; interiorDomain(I,I);
+   
+     // Create the arrays.
+ !   // The Array template parameters indicate
+ !   // 2 dimensions, a 'double' value
+     // type, and ordinary 'Brick' storage.
+ !   Array&lt;2, double, Brick&gt; a(vertDomain);
+ !   Array&lt;2, double, Brick&gt; b(vertDomain);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the
+ !   // central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes
+ !   // before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+   
+ !   // Create a stencil performing the computation.  &lt;co id=&quot;tutorial-array_stencil-doof2d-stencil_creation&quot;&gt;&lt;/co&gt;
+ !   Stencil&lt;DoofNinePt&gt; stencil;
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.  &lt;co id=&quot;tutorial-array_stencil-doof2d-first_write&quot;&gt;&lt;/co&gt;
+       a(interiorDomain) = stencil(b, interiorDomain);
+   
+ ***************
+ *** 86,91 ****
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();	// Ensure all computation has finished.
+ !   std::cout &lt;&lt; (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2)) &lt;&lt; std::endl;
+   
+     // The arrays are automatically deallocated.
+ --- 94,102 ----
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate(); 
+ !     // Ensure all computation has finished.
+ !   std::cout &openopen;
+ !     (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2))
+ !     &openopen; std::endl;
+   
+     // The arrays are automatically deallocated.
+ ***************
+ *** 95,96 ****
+ --- 106,108 ----
+     return EXIT_SUCCESS;
+   }
+ + &lt;/programlisting&gt;
Index: Doof2d-C-element-annotated.patch
===================================================================
RCS file: Doof2d-C-element-annotated.patch
diff -N Doof2d-C-element-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Doof2d-C-element-annotated.patch	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,154 ----
+ *** Doof2d-C-element.cpp	Thu Jan 31 08:46:50 2002
+ --- Doof2d-C-element-annotated.cpp	Thu Jan 31 08:47:14 2002
+ ***************
+ *** 1,4 ****
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+   
+   // Doof2d: C-like, element-wise implementation
+ --- 1,5 ----
+ ! &lt;programlisting id=&quot;tutorial-hand_coded-doof2d-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+   
+   // Doof2d: C-like, element-wise implementation
+ ***************
+ *** 6,30 ****
+   int main()
+   {
+ !   // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &lt;&lt; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &gt;&gt; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2; // Each iteration performs two averagings.
+   
+ !   // Use two-dimensional grids of values.
+     double **a;
+     double **b;
+   
+ !   // Ask the user for the number n of values along one dimension of
+ !   // the grid.
+     long n;
+ !   std::cout &lt;&lt; &quot;Please enter the array size: &quot;;
+ !   std::cin &gt;&gt; n;
+   
+ !   // Allocate the arrays.
+     typedef double* doublePtr;
+     a = new doublePtr[n];
+     b = new doublePtr[n];
+ !   for (int i = 0; i &lt; n; i++) {
+       a[i] = new double[n];
+       b[i] = new double[n];
+ --- 7,32 ----
+   int main()
+   {
+ !   // Ask the user for the number of averagings.  &lt;co id=&quot;tutorial-hand_coded-doof2d-nuaveragings&quot;&gt;&lt;/co&gt;
+     long nuAveragings, nuIterations;
+ !   std::cout &openopen; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &closeclose; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2;
+ !     // Each iteration performs two averagings.
+   
+ !   // Use two-dimensional grids of values.  &lt;co id=&quot;tutorial-hand_coded-doof2d-array_storage&quot;&gt;&lt;/co&gt;
+     double **a;
+     double **b;
+   
+ !   // Ask the user for the number n of values along one 
+ !   // dimension of the grid.  &lt;co id=&quot;tutorial-hand_coded-doof2d-grid_size&quot;&gt;&lt;/co&gt;
+     long n;
+ !   std::cout &openopen; &quot;Please enter the array size: &quot;;
+ !   std::cin &closeclose; n;
+   
+ !   // Allocate the arrays.  &lt;co id=&quot;tutorial-hand_coded-doof2d-allocation&quot;&gt;&lt;/co&gt;
+     typedef double* doublePtr;
+     a = new doublePtr[n];
+     b = new doublePtr[n];
+ !   for (int i = 0; i &lt; n; i++) {
+       a[i] = new double[n];
+       b[i] = new double[n];
+ ***************
+ *** 32,49 ****
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the central value.
+ !   for (int j = 0; j &lt; n; j++)
+ !     for (int i = 0; i &lt; n; i++)
+         a[i][j] = b[i][j] = 0.0;
+     b[n/2][n/2] = 1000.0;
+   
+ !   // Average using this weight.
+     const double weight = 1.0/9.0;
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+           a[i][j] = weight *
+             (b[i+1][j+1] + b[i+1][j  ] + b[i+1][j-1] +
+ --- 34,52 ----
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the
+ !   // central value.  &lt;co id=&quot;tutorial-hand_coded-doof2d-initialization&quot;&gt;&lt;/co&gt;
+ !   for (int j = 0; j &lt; n; j++)
+ !     for (int i = 0; i &lt; n; i++)
+         a[i][j] = b[i][j] = 0.0;
+     b[n/2][n/2] = 1000.0;
+   
+ !   // Average using this weight.  &lt;co id=&quot;tutorial-hand_coded-doof2d-constants&quot;&gt;&lt;/co&gt;
+     const double weight = 1.0/9.0;
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.  &lt;co id=&quot;tutorial-hand_coded-doof2d-first_write&quot;&gt;&lt;/co&gt;
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+           a[i][j] = weight *
+             (b[i+1][j+1] + b[i+1][j  ] + b[i+1][j-1] +
+ ***************
+ *** 51,57 ****
+              b[i-1][j+1] + b[i-1][j  ] + b[i-1][j-1]);
+   
+ !     // Read from a.  Write to b.
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+           b[i][j] = weight *
+             (a[i+1][j+1] + a[i+1][j  ] + a[i+1][j-1] +
+ --- 54,60 ----
+              b[i-1][j+1] + b[i-1][j  ] + b[i-1][j-1]);
+   
+ !     // Read from a.  Write to b.  &lt;co id=&quot;tutorial-hand_coded-doof2d-second_write&quot;&gt;&lt;/co&gt;
+ !     for (int j = 1; j &lt; n-1; j++)
+ !       for (int i = 1; i &lt; n-1; i++)
+           b[i][j] = weight *
+             (a[i+1][j+1] + a[i+1][j  ] + a[i+1][j-1] +
+ ***************
+ *** 60,68 ****
+     }
+   
+ !   // Print out the final central value.
+ !   std::cout &lt;&lt; (nuAveragings % 2 ? a[n/2][n/2] : b[n/2][n/2]) &lt;&lt; std::endl;
+   
+ !   // Deallocate the arrays.
+ !   for (int i = 0; i &lt; n; i++) {
+       delete [] a[i];
+       delete [] b[i];
+ --- 63,73 ----
+     }
+   
+ !   // Print out the final central value.  &lt;co id=&quot;tutorial-hand_coded-doof2d-answer&quot;&gt;&lt;/co&gt;
+ !   std::cout &openopen;
+ !     (nuAveragings % 2 ? a[n/2][n/2] : b[n/2][n/2])
+ !     &openopen; std::endl;
+   
+ !   // Deallocate the arrays.  &lt;co id=&quot;tutorial-hand_coded-doof2d-deallocation&quot;&gt;&lt;/co&gt;
+ !   for (int i = 0; i &lt; n; i++) {
+       delete [] a[i];
+       delete [] b[i];
+ ***************
+ *** 73,74 ****
+ --- 78,80 ----
+     return EXIT_SUCCESS;
+   }
+ + &lt;/programlisting&gt;
Index: Doof2d-Field-distributed-annotated.patch
===================================================================
RCS file: Doof2d-Field-distributed-annotated.patch
diff -N Doof2d-Field-distributed-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Doof2d-Field-distributed-annotated.patch	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,219 ----
+ *** Doof2d-Field-distributed.cpp	Wed Jan 23 19:20:15 2002
+ --- Doof2d-Field-distributed-annotated.cpp	Wed Jan 30 16:40:27 2002
+ ***************
+ *** 1,6 ****
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Fields.h&quot;	// has POOMA's Field declarations
+   
+ ! // Doof2d: POOMA Fields, data-parallel, multiple processor implementation
+   
+   int main(int argc, char *argv[])
+ --- 1,9 ----
+ ! &lt;programlisting id=&quot;tutorial-field_distributed-doof2d-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Fields.h&quot;
+ !     // has POOMA's Field declarations
+   
+ ! // Doof2d: POOMA Fields, data-parallel, multiple
+ ! // processor implementation
+   
+   int main(int argc, char *argv[])
+ ***************
+ *** 9,16 ****
+     Pooma::initialize(argc,argv);
+     
+ !   // Since multiple copies of this program may simultaneously run, we
+ !   // canot use standard input and output.  Instead we use command-line
+ !   // arguments, which are replicated, for input, and we use an Inform
+ !   // stream for output.
+     Inform output;
+   
+ --- 12,20 ----
+     Pooma::initialize(argc,argv);
+     
+ !   // Since multiple copies of this program may
+ !   // simultaneously run, we canot use standard input
+ !   // and output.  Instead we use command-line
+ !   // arguments, which are replicated, for input, and we
+ !   // use an Inform stream for output.  &lt;co id=&quot;tutorial-field_distributed-doof2d-io&quot;&gt;&lt;/co&gt;
+     Inform output;
+   
+ ***************
+ *** 18,22 ****
+     if (argc != 4) {
+       // Incorrect number of command-line arguments.
+ !     output &lt;&lt; argv[0] &lt;&lt; &quot;: number-of-processors number-of-averagings number-of-values&quot; &lt;&lt; std::endl;
+       return EXIT_FAILURE;
+     }
+ --- 22,29 ----
+     if (argc != 4) {
+       // Incorrect number of command-line arguments.
+ !     output &openopen; argv[0] &openopen;
+ !       &quot;: number-of-processors number-of-averagings&quot;
+ !       &openopen; &quot; number-of-values&quot;
+ !       &openopen; std::endl;
+       return EXIT_FAILURE;
+     }
+ ***************
+ *** 25,79 ****
+     // Determine the number of processors.
+     long nuProcessors;
+ !   nuProcessors = strtol(argv[1], &amp;tail, 0);
+   
+     // Determine the number of averagings.
+     long nuAveragings, nuIterations;
+ !   nuAveragings = strtol(argv[2], &amp;tail, 0);
+ !   nuIterations = (nuAveragings+1)/2; // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one dimension of
+ !   // the grid.
+     long n;
+ !   n = strtol(argv[3], &amp;tail, 0);
+ !   // The dimension must be a multiple of the number of processors
+ !   // since we are using a UniformGridLayout.
+     n = ((n+nuProcessors-1) / nuProcessors) * nuProcessors;
+   
+     // Specify the fields' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;1&gt; J(1,n-2);
+ ! 
+ !   // Partition the fields' domains uniformly, i.e., each patch has the
+ !   // same size.  The first parameter tells how many patches for each
+ !   // dimension.  Guard layers optimize communication between patches.
+ !   // Internal guards surround each patch.  External guards surround
+ !   // the entire field domain.
+ !   UniformGridPartition&lt;2&gt; partition(Loc&lt;2&gt;(nuProcessors, nuProcessors),
+ ! 				    GuardLayers&lt;2&gt;(1),  // internal
+ ! 				    GuardLayers&lt;2&gt;(0)); // external
+ !   UniformGridLayout&lt;2&gt; layout(vertDomain, partition, DistributedTag());
+ ! 
+ !   // Specify the fields' mesh, i.e., its spatial extent, and its
+ !   // centering type.
+ !   UniformRectilinearMesh&lt;2&gt; mesh(layout, Vector&lt;2&gt;(0.0), Vector&lt;2&gt;(1.0, 1.0));
+ !   Centering&lt;2&gt; cell = canonicalCentering&lt;2&gt;(CellType, Continuous, AllDim);
+ ! 
+ !   // The Field template parameters indicate a mesh and a 'double'
+ !   // value type.  MultiPatch indicates multiple computation patches,
+ !   // i.e., distributed computation.  The UniformTag indicates the
+ !   // patches should have the same size.  Each patch has Brick type.
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double, MultiPatch&lt;UniformTag,
+ !     Remote&lt;Brick&gt; &gt; &gt; a(cell, layout, mesh);
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double, MultiPatch&lt;UniformTag,
+ !     Remote&lt;Brick&gt; &gt; &gt; b(cell, layout, mesh);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+ --- 32,99 ----
+     // Determine the number of processors.
+     long nuProcessors;
+ !   nuProcessors = strtol(argv[1], &amp;tail, 0);
+   
+     // Determine the number of averagings.
+     long nuAveragings, nuIterations;
+ !   nuAveragings = strtol(argv[2], &amp;tail, 0);
+ !   nuIterations = (nuAveragings+1)/2;
+ !     // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along
+ !   // one dimension of the grid.
+     long n;
+ !   n = strtol(argv[3], &amp;tail, 0);
+ !   // The dimension must be a multiple of the number of
+ !   // processors since we are using a UniformGridLayout.
+     n = ((n+nuProcessors-1) / nuProcessors) * nuProcessors;
+   
+     // Specify the fields' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for
+ !   // computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;1&gt; J(1,n-2);
+ ! 
+ !   // Partition the fields' domains uniformly, i.e.,
+ !   // each patch has the same size.  The first parameter
+ !   // tells how many patches for each dimension.  Guard
+ !   // layers optimize communication between patches.
+ !   // Internal guards surround each patch.  External
+ !   // guards surround the entire field domain.  &lt;co id=&quot;tutorial-field_distributed-doof2d-layout&quot;&gt;&lt;/co&gt;
+ !   UniformGridPartition&lt;2&gt;
+ !     partition(Loc&lt;2&gt;(nuProcessors, nuProcessors),
+ ! 	     GuardLayers&lt;2&gt;(1),  // internal
+ ! 	     GuardLayers&lt;2&gt;(0)); // external
+ !   UniformGridLayout&lt;2&gt;
+ !     layout(vertDomain, partition, DistributedTag());
+ ! 
+ !   // Specify the fields' mesh, i.e., its spatial
+ !   // extent, and its centering type.  &lt;co id=&quot;tutorial-field_distributed-doof2d-mesh&quot;&gt;&lt;/co&gt;
+ !   UniformRectilinearMesh&lt;2&gt;
+ !     mesh(layout, Vector&lt;2&gt;(0.0), Vector&lt;2&gt;(1.0, 1.0));
+ !   Centering&lt;2&gt; cell =
+ !     canonicalCentering&lt;2&gt;(CellType, Continuous, AllDim);
+ ! 
+ !   // The Field template parameters indicate a mesh and
+ !   // a 'double' value type.  MultiPatch indicates
+ !   // multiple computation patches, i.e., distributed
+ !   // computation.  The UniformTag indicates the patches
+ !   // should have the same size.  Each patch has Brick
+ !   // type.  &lt;co id=&quot;tutorial-field_distributed-doof2d-remote&quot;&gt;&lt;/co&gt;
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double,
+ !            MultiPatch&lt;UniformTag, Remote&lt;Brick&closecloseclose;
+ !     a(cell, layout, mesh);
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double,
+ !     MultiPatch&lt;UniformTag, Remote&lt;Brick&closecloseclose;
+ !     b(cell, layout, mesh);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the
+ !   // central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes
+ !   // before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+ ***************
+ *** 83,87 ****
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+       // Read from b.  Write to a.
+       a(I,J) = weight *
+ --- 103,107 ----
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+       // Read from b.  Write to a.
+       a(I,J) = weight *
+ ***************
+ *** 98,103 ****
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();	// Ensure all computation has finished.
+ !   output &lt;&lt; (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2)) &lt;&lt; std::endl;
+   
+     // The fields are automatically deallocated.
+ --- 118,126 ----
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();
+ !     // Ensure all computation has finished.
+ !   output &openopen;
+ !     (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2))
+ !     &openopen; std::endl;
+   
+     // The fields are automatically deallocated.
+ ***************
+ *** 107,108 ****
+ --- 130,132 ----
+     return EXIT_SUCCESS;
+   }
+ + &lt;/programlisting&gt;
Index: Doof2d-Field-parallel-annotated.patch
===================================================================
RCS file: Doof2d-Field-parallel-annotated.patch
diff -N Doof2d-Field-parallel-annotated.patch
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Doof2d-Field-parallel-annotated.patch	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,144 ----
+ *** Doof2d-Field-parallel.cpp	Wed Jan 23 19:20:33 2002
+ --- Doof2d-Field-parallel-annotated.cpp	Thu Jan 31 09:07:32 2002
+ ***************
+ *** 1,5 ****
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Fields.h&quot;	// has POOMA's Field declarations
+   
+   // Doof2d: POOMA Fields, data-parallel implementation
+ --- 1,7 ----
+ ! &lt;programlisting id=&quot;tutorial-field_parallel-doof2d-program&quot; linenumbering=&quot;numbered&quot; format=&quot;linespecific&quot;&gt;
+ ! #include &lt;iostream&gt;		// has std::cout, ...
+ ! #include &lt;stdlib.h&gt;		// has EXIT_SUCCESS
+ ! #include &quot;Pooma/Fields.h&quot;
+ !    // has POOMA's Field declarations  &lt;co id=&quot;tutorial-field_parallel-doof2d-header&quot;&gt;&lt;/co&gt;
+   
+   // Doof2d: POOMA Fields, data-parallel implementation
+ ***************
+ *** 12,49 ****
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout &lt;&lt; &quot;Please enter the number of averagings: &quot;;
+ !   std::cin &gt;&gt; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2; // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along one dimension of
+ !   // the grid.
+     long n;
+ !   std::cout &lt;&lt; &quot;Please enter the field size: &quot;;
+ !   std::cin &gt;&gt; n;
+   
+     // Specify the fields' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;1&gt; J(1,n-2);
+ ! 
+ !   // Specify the fields' mesh, i.e., its spatial extent, and its
+ !   // centering type.
+ !   DomainLayout&lt;2&gt; layout(vertDomain);
+ !   UniformRectilinearMesh&lt;2&gt; mesh(layout, Vector&lt;2&gt;(0.0), Vector&lt;2&gt;(1.0, 1.0));
+ !   Centering&lt;2&gt; cell = canonicalCentering&lt;2&gt;(CellType, Continuous, AllDim);
+   
+     // Create the fields.
+ !   // The Field template parameters indicate a mesh, a 'double' value
+ !   // type, and ordinary 'Brick' storage.
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double, Brick&gt; a(cell, layout, mesh);
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double, Brick&gt; b(cell, layout, mesh);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+ --- 14,60 ----
+     // Ask the user for the number of averagings.
+     long nuAveragings, nuIterations;
+ !   std::cout&openopen;&quot;Please enter the number of averagings: &quot;;
+ !   std::cin &closeclose; nuAveragings;
+ !   nuIterations = (nuAveragings+1)/2;
+ !     // Each iteration performs two averagings.
+   
+ !   // Ask the user for the number n of values along
+ !   // one dimension of the grid.
+     long n;
+ !   std::cout &openopen; &quot;Please enter the field size: &quot;;
+ !   std::cin &closeclose; n;
+   
+     // Specify the fields' domains [0,n) x [0,n).
+ !   Interval&lt;1&gt; N(0, n-1);
+ !   Interval&lt;2&gt; vertDomain(N, N);
+   
+ !   // Set up interior domains [1,n-1) x [1,n-1) for
+ !   // computation.
+ !   Interval&lt;1&gt; I(1,n-2);
+ !   Interval&lt;1&gt; J(1,n-2);
+ ! 
+ !   // Specify the fields' mesh, i.e., its spatial
+ !   //  extent, and its centering type.  &lt;co id=&quot;tutorial-field_parallel-doof2d-mesh&quot;&gt;&lt;/co&gt;
+ !   DomainLayout&lt;2&gt; layout(vertDomain);
+ !   UniformRectilinearMesh&lt;2&gt;
+ !     mesh(layout, Vector&lt;2&gt;(0.0), Vector&lt;2&gt;(1.0, 1.0));
+ !   Centering&lt;2&gt; cell =
+ !     canonicalCentering&lt;2&gt;(CellType, Continuous, AllDim);
+   
+     // Create the fields.
+ !   // The Field template parameters indicate a mesh, a
+ !   // 'double' value type, and ordinary 'Brick'
+ !   // storage. &lt;co id=&quot;tutorial-field_parallel-doof2d-field_creation&quot;&gt;&lt;/co&gt;
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double, Brick&gt;
+ !     a(cell, layout, mesh);
+ !   Field&lt;UniformRectilinearMesh&lt;2&gt;, double, Brick&gt;
+ !     b(cell, layout, mesh);
+   
+     // Set up the initial conditions.
+ !   // All grid values should be zero except for the
+ !   // central value.
+     a = b = 0.0;
+ !   // Ensure all data-parallel computation finishes
+ !   // before accessing a value.
+     Pooma::blockAndEvaluate();
+     b(n/2,n/2) = 1000.0;
+ ***************
+ *** 53,58 ****
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.
+       a(I,J) = weight *
+         (b(I+1,J+1) + b(I+1,J  ) + b(I+1,J-1) +
+ --- 64,69 ----
+   
+     // Perform the simulation.
+ !   for (int k = 0; k &lt; nuIterations; ++k) {
+ !     // Read from b.  Write to a.  &lt;co id=&quot;tutorial-field_parallel-doof2d-first_write&quot;&gt;&lt;/co&gt;
+       a(I,J) = weight *
+         (b(I+1,J+1) + b(I+1,J  ) + b(I+1,J-1) +
+ ***************
+ *** 68,73 ****
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();	// Ensure all computation has finished.
+ !   std::cout &lt;&lt; (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2)) &lt;&lt; std::endl;
+   
+     // The fields are automatically deallocated.
+ --- 79,87 ----
+   
+     // Print out the final central value.
+ !   Pooma::blockAndEvaluate();
+ !     // Ensure all computation has finished.
+ !   std::cout &openopen;
+ !     (nuAveragings % 2 ? a(n/2,n/2) : b(n/2,n/2))
+ !     &openopen; std::endl;
+   
+     // The fields are automatically deallocated.
+ ***************
+ *** 77,78 ****
+ --- 91,93 ----
+     return EXIT_SUCCESS;
+   }
+ + &lt;/programlisting&gt;
Index: Makefile
===================================================================
RCS file: Makefile
diff -N Makefile
*** /dev/null	Fri Mar 23 21:37:44 2001
--- Makefile	Thu Jan 31 15:14:50 2002
***************
*** 0 ****
--- 1,16 ----
+ ### Oldham, Jeffrey D.
+ ### 2001Nov27
+ ### Pooma
+ ###
+ ### Produce Annotated Source Code for the POOMA Manual
+ 
+ ## These rules combine executable code, which can be compiled and run,
+ ## with DocBook annotations used in the manual to explain the code.
+ 
+ all: Doof2d-C-element-annotated.cpp Doof2d-Array-element-annotated.cpp \
+      Doof2d-Array-parallel-annotated.cpp Doof2d-Array-stencil-annotated.cpp \
+      Doof2d-Array-distributed-annotated.cpp \
+      Doof2d-Field-parallel-annotated.cpp Doof2d-Field-distributed-annotated.cpp
+ 
+ %-annotated.cpp: %-annotated.patch %.cpp
+ 	patch -o $@ &lt; $&lt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000900.html">Manual Patch: Tidy Programs
</A></li>
	<LI>Next message: <A HREF="000902.html">Manual Patch: Example Code 1 of x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#901">[ date ]</a>
              <a href="thread.html#901">[ thread ]</a>
              <a href="subject.html#901">[ subject ]</a>
              <a href="author.html#901">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">More information about the pooma-dev
mailing list</a><br>
</body></html>
