<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [pooma-dev] Compile Time Problems and Pooma 2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20%5Bpooma-dev%5D%20Compile%20Time%20Problems%20and%20Pooma%202&In-Reply-To=%3C15123.51609.122947.372321%40mutley.lanl.gov%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000420.html">
   <LINK REL="Next"  HREF="000429.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[pooma-dev] Compile Time Problems and Pooma 2</H1>
    <B>Dave Nystrom</B> 
    <A HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20%5Bpooma-dev%5D%20Compile%20Time%20Problems%20and%20Pooma%202&In-Reply-To=%3C15123.51609.122947.372321%40mutley.lanl.gov%3E"
       TITLE="[pooma-dev] Compile Time Problems and Pooma 2">wdn at lanl.gov
       </A><BR>
    <I>Tue May 29 17:53:16 UTC 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000420.html">[pooma-dev] Compile Time Problems and Pooma 2
</A></li>
        <LI>Next message: <A HREF="000429.html">[pooma-dev] Compile Time Problems and Pooma 2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#426">[ date ]</a>
              <a href="thread.html#426">[ thread ]</a>
              <a href="subject.html#426">[ subject ]</a>
              <a href="author.html#426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Stephen,

Thanks for your reply.

Stephen Smith writes:
 &gt; I have a few comments/questions.
 &gt; 
 &gt; When I looked at compile times on Nirvana, they were
 &gt; generally linearly related to the intermediate c file
 &gt; size (In K, not the number of lines).  Do you know what
 &gt; the sizes of the intermediate files are?  A lot of the time

Here are the b18 results with the extra info you requested.  I decided to
record the size of the .int.c files in MBytes for obvious reasons:-).

b18 results: Irix 6.5, MipsPro 7.3.1.2m
---------------------------------------

Filename           | # of .ii | # lines of | +K0 Compile | Line  | Time   | Size In
                   |  lines   | int C code |    Time     | Ratio | Ratio  | MBytes
------------------------------------------------------------------------------------
assign_arg7_03.cc  |   341    |   566783   |  7070.603   |  5.46 |  24.14 |  61.73
------------------------------------------------------------------------------------
assign_arg5_01.cc  |   349    |   314395   |  3266.179   |  3.03 |  11.15 |  32.59
------------------------------------------------------------------------------------
assign_arg7_09.cc  |   144    |   314070   |  2320.959   |  3.02 |   7.92 |  33.55
------------------------------------------------------------------------------------
assign_arg7_13.cc  |   124    |   209043   |  1142.474   |  2.01 |   3.90 |  22.54
------------------------------------------------------------------------------------
assign_arg5_03.cc  |     0    |   103832   |   292.872   |  1.00 |   1.00 |  10.66
------------------------------------------------------------------------------------

 &gt; is related to just writing the file to disk.  Compile times
 &gt; are significantly faster if you checkout the repository
 &gt; on a local filesystem. (I used to use /scratch.)  You would
 &gt; probably see significantly slower compile time on Linux if
 &gt; you compiled on directories mounted using NFS.

I read your later email so I know you picked up on the fact that I am using
/scratch on b18.  Also, b18 was essentially idle so that I had a pretty
dedicated compile platform.  The only stuff I was grabbing from an NFS disk
was the KCC headers and the system headers.  I have actually installed KCC on 
the scratch disk in the past and noticed about a 10% reduction in compile
time by having the KCC headers local.  I've never copied the system headers
over to scratch but I thought about it once.  Should not be hard but I
figured the performance increase would be comparable to making KCC local
i.e. about 10%.  On our secure Pooma 1 code when I moved Pooma 1 and our
Blanca source code from NFS to the scratch disk, I reduced compile times by a 
factor of 3.  That was after we already had /tmp on scratch and all our build 
products going to scratch.

 &gt; I'm not sure why you're instantiating View1 etc. instead of
 &gt; the functions that Blanca uses directly.  For arrays, this would
 &gt; be op() and read().  For example:
 &gt; 
 &gt; template View1&lt;Array&lt;2, double, Brick&gt;, Interval&lt;2&gt; &gt;::Type_t
 &gt; Array&lt;2, double, Brick&gt;::operator()(const Interval&lt;2&gt; &amp;) const;

I am trying to make a custom Blanca instantiation library for Pooma 2
templates and to also explicitly instantiate all the templates that Blanca
uses, including STL templates and Blanca templates.  The fundamental reason
for this tedious exercise is to significantly reduce the overall compile time 
required to build Blanca software.  There are two ways to get compile time
reductions.  One is to instantiate Pooma 2 templates that we are using in a
separate Pooma2Instantiations library that only gets recompiled when we
update or change Pooma 2.  Then, all of the Pooma 2 templates that would have 
normally been assigned to Blanca translation units are now in this
instantiation library that only needs to be rebuilt on an infrequent basis
i.e. when we update Pooma 2.  So, a tremendous amount of compilation work has 
been pushed to a lower level.  The second way to significantly reduce compile 
times is to eliminate recompiles that the prelinker performs.  But the way
this works is that you start reducing the number of templates that get
assigned to a translation unit by the prelinker but until you make that
number go to 0, you will still be recompiling the file.  One problem with
relying on the prelinker is that you can't very easily control which
translation units it chooses to assign templates to and it tends to be pretty 
democratic and assign some to all.  Maybe we need a republican prelinker that 
would assign all the templates to just a few:-).  Anyway, the bottom line is
that I need to be able to explicitly instantiate any template that the
compiler can instantiate which when using EDG based compilers is via the
prelinker.  The absolute only reason that I want to instantiate the
View1&lt;...&gt;::sv template is because when I analyse the .ii files for our
Blanca compiles I find that the compiler has found references to 1800+ of
these templates that if feels obliged to instantiate.  I need to be able to
instantiate them myself so the prelinker does not put some in nearly every
translation unit and then feel obliged to recompile that translation unit.

 &gt; You can't instantiate the AltView classes because there is a
 &gt; circular dependency between the field and the view class that
 &gt; AltView is used to solve.

I realize this.  I'm just pointing out in my previous email that Jeffrey's
fix unfortunately did not really solve the fundamental problem that I am
trying to solve.  I can now instantiate the View1 class but now I have just
as many AltView1 templates that I cannot instantiate and the prelinker is
going to be very democratic about where it assigns them as well.

 &gt; Finally, what are the compile times for Debug?  Probably a set of

The times that I reported were Debug compile times i.e. +K0 - at least for
the b18 stuff.  The second experiment that I did was aimed at studying how
many lines of C code would be generated for different compile optimization
levels for just one of these global assign functions i.e. the one with the
longest template argument which would presumably be associated with the most
complex assignment expression that we were using or at least pretty close to
the most complex.  So in the second experiment, I did +K0, +K1, +K2 and +K3
builds.  For optimization levels of +K1 and higher, I included these options
as well.  These were what my optimized builds of the Pooma 2 library were
adding on.

	-DNOCHEETAHCTAssert -DNOCHEETAHRTAssert -DNOPAssert -DNOCTAssert \
	--restrict --inline_keyword_space_time=10000.0

 &gt; compile options that don't inline and don't add the bounds checking
 &gt; code would give you much shorter compile times.  Adding a non-expression
 &gt; template implementation would be a moderate chunk of work and may or may
 &gt; not improve compile times significantly.  Compile times come from making
 &gt; the views, and building the expression.  Compiling the expression evaluation
 &gt; is insignificant.  Replacing expression templates could save you the
 &gt; compile time related to building the expression, but the cost of making
 &gt; the view objects may still be significant.

Hmmmmmmmmm.  Well, I don't really understand what drives the compile times
for Pooma 2 based code very well.  At the lowest level there seems a strong
correlation with the amount of intermediate C code that is generated whether
measured in lines or bytes.  Also, when it comes to optimizing functions, I
am under the impression that the optimization process generally scales
quadratically or perhaps worse with the size of the function body.  But I
have no idea why the intermediate C code to evaluate a single complex
expression should be measured in tens of thousands of lines of code even
though it is evaluating this expression in a parallel environment, etc.  This 
somehow does not seem reasonable to me but I claim ignorance and am perhaps
being naive.  I would imagine that reductions could be made but I don't know
if this would involve trade offs and if so, what they would be.  From my
position of ignorance about the details of Pooma 2, I worry that 1). the
design is not properly factored so that alot of the code for one global
assign function looks the same as that for another global assign function,
only the template parameters are a little different and 2). that functions
are being inlined that do not really need to be inlined for runtime
performance reasons.  But again, I must emphasize my position of ignorance
because I just have not had time to study the details of Pooma 2 - spending
too much time trying to get manageable compile times.

Hope others will chime in with their evaluation of all this stuff.  Thanks
again, Stephen, for your response.  Let me know if I can provide additional
information.

-- 
Dave Nystrom			email: <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">wdn at lanl.gov</A>
LANL X-3			phone: 505-667-7913	fax: 505-665-3046

 &gt;     Stephen
 &gt; 
 &gt; -----Original Message-----
 &gt; From: Dave Nystrom [mailto:<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">wdn at lanl.gov</A>]
 &gt; Sent: Monday, May 28, 2001 2:47 PM
 &gt; To: pooma-dev
 &gt; Cc: Arch Robison; KCC Support; Dave Nystrom; John Hall; Jean Marshall;
 &gt; Don Marshall
 &gt; Subject: [pooma-dev] Compile Time Problems and Pooma 2
 &gt; 
 &gt; 
 &gt; Hi Guys,
 &gt; 
 &gt; I wanted to share some results which I have accumulated over the last week
 &gt; or 
 &gt; so regarding compile times and Pooma 2.  Some of these results I find to be
 &gt; truly stunning in a negative sense.  First, I spent most of last week trying
 &gt; to build a couple of versions of my Pooma2Instantiations library on the
 &gt; secure bluemountain b18 machine.  I built a debug and an optimized version
 &gt; of 
 &gt; the library using KCC-4.0d.  I had the source code for Pooma 2 and the
 &gt; Pooma2Instantiations library located on the local scratch disk.  I was doing
 &gt; a parallel using 16 processors including 16 processors for the parallel
 &gt; prelink phase.  The timing results which I will be reporting were
 &gt; accumulated 
 &gt; this last Friday when b18 was virtually idle except for my compiles.  The
 &gt; stunning result is that I could build either a debug or optimized version of
 &gt; the library faster on my 2 year old 366 MHz Pentium 2 laptop with 384 MBytes
 &gt; of memory than I could on an idle b18 using 16 processors.  I find this
 &gt; result to be truly stunning.  The majority of the compile time, at least
 &gt; 90%, 
 &gt; on b18 was spent in the backend C compiler.  Here are some timings that I
 &gt; did 
 &gt; on 5 files that were associated with instantiating the Pooma 2 global assign
 &gt; function on both b18 and my old laptop.  The timing results are not totally
 &gt; comparable because the prelinker chooses to assign templates a little
 &gt; differently from one machine to the other because of doing a parallel
 &gt; compile 
 &gt; on b18.  These compiles were +K0 compiles using KCC-4.0d.  Anyway, here they
 &gt; are:
 &gt; 
 &gt; b18 results: Irix 6.5, MipsPro 7.3.1.2m
 &gt; ---------------------------------------
 &gt; 
 &gt; Filename           | # of .ii | # lines of | +K0 Compile | Line  | Time
 &gt;                    |  lines   | int C code |    Time     | Ratio | Ratio
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg7_03.cc  |   341    |   566783   |  7070.603   |  5.46 |  24.14
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg5_01.cc  |   349    |   314395   |  3266.179   |  3.03 |  11.15
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg7_09.cc  |   144    |   314070   |  2320.959   |  3.02 |   7.92
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg7_13.cc  |   124    |   209043   |  1142.474   |  2.01 |   3.90
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg5_03.cc  |     0    |   103832   |   292.872   |  1.00 |   1.00
 &gt; --------------------------------------------------------------------------
 &gt; 
 &gt; 
 &gt; mutley results: RedHat 6.2
 &gt; --------------------------
 &gt; 
 &gt; Filename           | # of .ii | # lines of | +K0 Compile | Line  | Time
 &gt;                    |  lines   | int C code |    Time     | Ratio | Ratio
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg7_03.cc  |     0    |   478303   |   467.63    |  3.63 |  2.84
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg5_01.cc  |   246    |   308959   |   428.92    |  2.28 |  2.61
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg7_09.cc  |    91    |   272079   |   360.49    |  2.01 |  2.19
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg7_13.cc  |   178    |   231415   |   254.78    |  1.71 |  1.55
 &gt; --------------------------------------------------------------------------
 &gt; assign_arg5_03.cc  |   207    |   135366   |   164.39    |  1.00 |  1.00
 &gt; --------------------------------------------------------------------------
 &gt; 
 &gt; It seems that on my linux laptop, gcc's compile time scales roughly linearly
 &gt; with the number of lines of intermediate C code.  That does not seem to be
 &gt; the case for the SGI cc compiler.  I computed these results using both the
 &gt; MipsPro 7.2.1 C compiler and the MipsPro 7.3.1.2m C compiler and the results
 &gt; were essentially identical for practical purposes.
 &gt; 
 &gt; Another experiment which I did was to take the instantiation request for the
 &gt; assign function which had the longest template argument and put that in a
 &gt; separate file and do some testing on my linux laptop.  The longest template
 &gt; argument was 1666 characters in length.  Here are the results with and
 &gt; without exceptions enabled.
 &gt; 
 &gt; With Exceptions:
 &gt; ----------------
 &gt; 
 &gt; Case | # lines of | Compile | Optimization | # lines of int | Compile
 &gt;      | int C code |  Time   |    Level     | C code - base  | Time - base
 &gt; -------------------------------------------------------------------------
 &gt;   1  |   28804    |  33.34  |     +K0      |       51       |  12.50
 &gt; -------------------------------------------------------------------------
 &gt;   2  |   18263    |  35.27  |     +K1      |       37       |  12.33
 &gt; -------------------------------------------------------------------------
 &gt;   3  |   14451    |  62.21  |     +K2      |       18       |  12.35
 &gt; -------------------------------------------------------------------------
 &gt;   4  |   15767    |  76.47  |     +K3      |       18       |  12.30
 &gt; -------------------------------------------------------------------------
 &gt; 
 &gt; Without Exceptions:
 &gt; -------------------
 &gt; 
 &gt; Case | # lines of | Compile | Optimization | # lines of int | Compile
 &gt;      | int C code |  Time   |    Level     | C code - base  | Time - base
 &gt; -------------------------------------------------------------------------
 &gt;   1  |   26975    |  25.01  |     +K0      |       41       |  12.47
 &gt; -------------------------------------------------------------------------
 &gt;   2  |   16288    |  31.08  |     +K1      |       37       |  13.71
 &gt; -------------------------------------------------------------------------
 &gt;   3  |   12476    |  49.62  |     +K2      |       18       |  12.32
 &gt; -------------------------------------------------------------------------
 &gt;   4  |   13037    |  57.00  |     +K3      |       18       |  12.33
 &gt; -------------------------------------------------------------------------
 &gt; 
 &gt; The results recorded in the &quot;base&quot; columns are results obtained when the
 &gt; template instantiation request is commented out and reflects the compile
 &gt; times and lines of intermediate C code for the case where only the included
 &gt; header files are being parsed.  Care was taken to record the number of lines
 &gt; of intermediate C code before the prelinker phase.  The prelinker phase
 &gt; determines that the explicit instantiation request for this single assign
 &gt; function triggers the need for an additional 292 templates and the lines of
 &gt; intermediate C code for these additional 292 templates nearly doubles the
 &gt; above numbers.  It seems amazing that a single assign function would need
 &gt; between 14430 and 28750 lines of intermediate C code to represent it
 &gt; depending on the optimization level and that it would trigger the need for
 &gt; another 292 templates.  Also, I don't think we have gotten to the level of
 &gt; complexity in the expressions for our Pooma 2 based code that we have in our
 &gt; Pooma 1 based code.  In our Pooma 1 based code, I have seen expressions
 &gt; which 
 &gt; generate template parameters over 2800 characters long.
 &gt; 
 &gt; Here is another benchmark to compare the Pooma 2 base code and the Pooma 1
 &gt; based code.  In the Pooma 1 based code, my instantiation library explicitly
 &gt; instantiated nearly every Pooma 1 template.  The +K1 compilation of this
 &gt; instantiation library generated approximately 3.5 million lines of
 &gt; intermediate C code for the whole library and just under 1 million lines for
 &gt; the instantiation of all the global assign functions.  There were about 1196
 &gt; of these global assign functions that were instantiated.  In constrast, the
 &gt; Pooma 2 instantiation library instantiates 1282 global assign functions
 &gt; which 
 &gt; generates 4711082 lines of intermediate C code.  The complete Pooma 2
 &gt; instantiation library currently generates 5327932 lines of intermediate C
 &gt; code.  However, there are still lots of Pooma 2 templates that are currently
 &gt; being instantiated by the prelinker in our Blanca code that need to be moved
 &gt; to the Pooma 2 instantiation library.  So, it appears that there is alot
 &gt; more 
 &gt; intermediate C code generated by KCC for our Pooma 2 code than for our Pooma
 &gt; 1 code.  I'm not sure what to make of all this since to a certain degree I
 &gt; am 
 &gt; comparing apples and oranges.  But I think it does provide some indication
 &gt; of 
 &gt; how Pooma 1 and Pooma 2 compare in regard to code generation which
 &gt; contributes to long compile times.
 &gt; 
 &gt; Also, I tried out Jeffrey's fixes to allow instantiation of the View1 class
 &gt; and have some comments.  It appears that I can now instantiate the View1
 &gt; class but now I find that I have about 1000 AltView1 templates that I am
 &gt; unable to instantiate.  Perhaps we need a new AltAltView1 class:-).  Well,
 &gt; seriously, this fix is not solving the root problem which I have which is
 &gt; that I need to be able to explicitly instantiate anything that the compiler
 &gt; is able to instantiate so that I don't have to depend on the prelinker
 &gt; recompiling files.  Also, I tried the following template instantiation
 &gt; request which did not work.
 &gt; 
 &gt; 	template const bool View1&lt;Field&lt;T1,T2,T3&gt;,T4&gt;::sv;
 &gt; 
 &gt; KCC using --strict complained that I did not provide an implementation.  So,
 &gt; I don't know what the problem is here.  I don't know if the syntax is wrong
 &gt; or there is some bug in KCC.  But I do know that the prelinker is capable of
 &gt; performing the instantiation of this member of the View1 class.  I have this
 &gt; problem with other Pooma 2 classes such as the ElementProperties class.  I
 &gt; wish I could get this problem solved because my compile times are at least
 &gt; twice as long as they would be if I were able to instantiate everything that
 &gt; the compiler is instantiating.
 &gt; 
 &gt; I would like to know what the Pooma 2 team things about these results.  I
 &gt; find them sobering and not something that I want to see publicized.  Do you
 &gt; guys have any ideas about how to modify the relevant parts of Pooma 2 so
 &gt; that 
 &gt; less intermediate C code gets generated by KCC?  Are there tradeoffs here
 &gt; that you are aware of?  Is this code generation problem related specifically
 &gt; to the expression template engine or are there other things involved here?
 &gt; I've been wondering lately if Pooma 2 was designed in a way that would make
 &gt; it easy to use some other expression template engine.  I've also been
 &gt; wondering whether it would be possible to make expression templates a
 &gt; feature 
 &gt; selectable at compile time.  Then for debugging or development perhaps a
 &gt; more 
 &gt; lightweight version of Pooma 2 could be used that would run like a dog but
 &gt; compile much faster and facilitate an effective and efficient development
 &gt; environment.  Then building a high performance runtime version of our code
 &gt; could be banished to a batch script that was done only infrequently or by a
 &gt; very small group of people.  Are things like this reasonable to contemplate
 &gt; with Pooma 2?
 &gt; 
 &gt; Please let me know if you have any questions about the results I have
 &gt; presented in this email or if I can supply additional information.  I plan
 &gt; to 
 &gt; also send a copy of the current version of my Pooma 2 instantiation stuff so
 &gt; you guys can do any testing of your own that you want to do.
 &gt; 
 &gt; -- 
 &gt; Dave Nystrom			email: <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">wdn at lanl.gov</A>
 &gt; LANL X-3			phone: 505-667-7913	fax: 505-665-3046
 &gt; &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2//EN&quot;&gt;
 &gt; &lt;HTML&gt;
 &gt; &lt;HEAD&gt;
 &gt; &lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; charset=iso-8859-1&quot;&gt;
 &gt; &lt;META NAME=&quot;Generator&quot; CONTENT=&quot;MS Exchange Server version 5.5.2650.12&quot;&gt;
 &gt; &lt;TITLE&gt;RE: [pooma-dev] Compile Time Problems and Pooma 2&lt;/TITLE&gt;
 &gt; &lt;/HEAD&gt;
 &gt; &lt;BODY&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;I have a few comments/questions.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;When I looked at compile times on Nirvana, they were&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;generally linearly related to the intermediate c file&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;size (In K, not the number of lines).&nbsp; Do you know what&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the sizes of the intermediate files are?&nbsp; A lot of the time&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;is related to just writing the file to disk.&nbsp; Compile times&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;are significantly faster if you checkout the repository&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;on a local filesystem. (I used to use /scratch.)&nbsp; You would&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;probably see significantly slower compile time on Linux if&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;you compiled on directories mounted using NFS.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;I'm not sure why you're instantiating View1 etc. instead of&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the functions that Blanca uses directly.&nbsp; For arrays, this would&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;be op() and read().&nbsp; For example:&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;template View1&lt;Array&lt;2, double, Brick&gt;, Interval&lt;2&gt; &gt;::Type_t&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Array&lt;2, double, Brick&gt;::operator()(const Interval&lt;2&gt; &amp;) const;&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;You can't instantiate the AltView classes because there is a&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;circular dependency between the field and the view class that&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;AltView is used to solve.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Finally, what are the compile times for Debug?&nbsp; Probably a set of&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;compile options that don't inline and don't add the bounds checking&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;code would give you much shorter compile times.&nbsp; Adding a non-expression&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;template implementation would be a moderate chunk of work and may or may&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;not improve compile times significantly.&nbsp; Compile times come from making&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the views, and building the expression.&nbsp; Compiling the expression evaluation&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;is insignificant.&nbsp; Replacing expression templates could save you the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;compile time related to building the expression, but the cost of making&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the view objects may still be significant.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;&nbsp;&nbsp;&nbsp; Stephen&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;-----Original Message-----&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;From: Dave Nystrom [&lt;A HREF=&quot;mailto:<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">wdn at lanl.gov</A>&quot;&gt;mailto:<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">wdn at lanl.gov</A>&lt;/A&gt;]&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Sent: Monday, May 28, 2001 2:47 PM&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;To: pooma-dev&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Cc: Arch Robison; KCC Support; Dave Nystrom; John Hall; Jean Marshall;&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Don Marshall&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Subject: [pooma-dev] Compile Time Problems and Pooma 2&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; &lt;BR&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Hi Guys,&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;I wanted to share some results which I have accumulated over the last week or &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;so regarding compile times and Pooma 2.&nbsp; Some of these results I find to be&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;truly stunning in a negative sense.&nbsp; First, I spent most of last week trying&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;to build a couple of versions of my Pooma2Instantiations library on the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;secure bluemountain b18 machine.&nbsp; I built a debug and an optimized version of &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the library using KCC-4.0d.&nbsp; I had the source code for Pooma 2 and the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Pooma2Instantiations library located on the local scratch disk.&nbsp; I was doing&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;a parallel using 16 processors including 16 processors for the parallel&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;prelink phase.&nbsp; The timing results which I will be reporting were accumulated &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;this last Friday when b18 was virtually idle except for my compiles.&nbsp; The&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;stunning result is that I could build either a debug or optimized version of&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the library faster on my 2 year old 366 MHz Pentium 2 laptop with 384 MBytes&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;of memory than I could on an idle b18 using 16 processors.&nbsp; I find this&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;result to be truly stunning.&nbsp; The majority of the compile time, at least 90%, &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;on b18 was spent in the backend C compiler.&nbsp; Here are some timings that I did &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;on 5 files that were associated with instantiating the Pooma 2 global assign&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;function on both b18 and my old laptop.&nbsp; The timing results are not totally&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;comparable because the prelinker chooses to assign templates a little&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;differently from one machine to the other because of doing a parallel compile &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;on b18.&nbsp; These compiles were +K0 compiles using KCC-4.0d.&nbsp; Anyway, here they&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;are:&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;b18 results: Irix 6.5, MipsPro 7.3.1.2m&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;---------------------------------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | # of .ii | # lines of | +K0 Compile | Line&nbsp; | Time&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; lines&nbsp;&nbsp; | int C code |&nbsp;&nbsp;&nbsp; Time&nbsp;&nbsp;&nbsp;&nbsp; | Ratio | Ratio&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg7_03.cc&nbsp; |&nbsp;&nbsp; 341&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 566783&nbsp;&nbsp; |&nbsp; 7070.603&nbsp;&nbsp; |&nbsp; 5.46 |&nbsp; 24.14&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg5_01.cc&nbsp; |&nbsp;&nbsp; 349&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 314395&nbsp;&nbsp; |&nbsp; 3266.179&nbsp;&nbsp; |&nbsp; 3.03 |&nbsp; 11.15&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg7_09.cc&nbsp; |&nbsp;&nbsp; 144&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 314070&nbsp;&nbsp; |&nbsp; 2320.959&nbsp;&nbsp; |&nbsp; 3.02 |&nbsp;&nbsp; 7.92&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg7_13.cc&nbsp; |&nbsp;&nbsp; 124&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 209043&nbsp;&nbsp; |&nbsp; 1142.474&nbsp;&nbsp; |&nbsp; 2.01 |&nbsp;&nbsp; 3.90&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg5_03.cc&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 103832&nbsp;&nbsp; |&nbsp;&nbsp; 292.872&nbsp;&nbsp; |&nbsp; 1.00 |&nbsp;&nbsp; 1.00&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; &lt;BR&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;mutley results: RedHat 6.2&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | # of .ii | # lines of | +K0 Compile | Line&nbsp; | Time&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; lines&nbsp;&nbsp; | int C code |&nbsp;&nbsp;&nbsp; Time&nbsp;&nbsp;&nbsp;&nbsp; | Ratio | Ratio&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg7_03.cc&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 478303&nbsp;&nbsp; |&nbsp;&nbsp; 467.63&nbsp;&nbsp;&nbsp; |&nbsp; 3.63 |&nbsp; 2.84&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg5_01.cc&nbsp; |&nbsp;&nbsp; 246&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 308959&nbsp;&nbsp; |&nbsp;&nbsp; 428.92&nbsp;&nbsp;&nbsp; |&nbsp; 2.28 |&nbsp; 2.61&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg7_09.cc&nbsp; |&nbsp;&nbsp;&nbsp; 91&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 272079&nbsp;&nbsp; |&nbsp;&nbsp; 360.49&nbsp;&nbsp;&nbsp; |&nbsp; 2.01 |&nbsp; 2.19&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg7_13.cc&nbsp; |&nbsp;&nbsp; 178&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 231415&nbsp;&nbsp; |&nbsp;&nbsp; 254.78&nbsp;&nbsp;&nbsp; |&nbsp; 1.71 |&nbsp; 1.55&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign_arg5_03.cc&nbsp; |&nbsp;&nbsp; 207&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 135366&nbsp;&nbsp; |&nbsp;&nbsp; 164.39&nbsp;&nbsp;&nbsp; |&nbsp; 1.00 |&nbsp; 1.00&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;--------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;It seems that on my linux laptop, gcc's compile time scales roughly linearly&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;with the number of lines of intermediate C code.&nbsp; That does not seem to be&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the case for the SGI cc compiler.&nbsp; I computed these results using both the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;MipsPro 7.2.1 C compiler and the MipsPro 7.3.1.2m C compiler and the results&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;were essentially identical for practical purposes.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Another experiment which I did was to take the instantiation request for the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;assign function which had the longest template argument and put that in a&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;separate file and do some testing on my linux laptop.&nbsp; The longest template&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;argument was 1666 characters in length.&nbsp; Here are the results with and&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;without exceptions enabled.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;With Exceptions:&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;----------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Case | # lines of | Compile | Optimization | # lines of int | Compile&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp; | int C code |&nbsp; Time&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; Level&nbsp;&nbsp;&nbsp;&nbsp; | C code - base&nbsp; | Time - base&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 1&nbsp; |&nbsp;&nbsp; 28804&nbsp;&nbsp;&nbsp; |&nbsp; 33.34&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 12.50&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 2&nbsp; |&nbsp;&nbsp; 18263&nbsp;&nbsp;&nbsp; |&nbsp; 35.27&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 12.33&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 3&nbsp; |&nbsp;&nbsp; 14451&nbsp;&nbsp;&nbsp; |&nbsp; 62.21&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 12.35&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 4&nbsp; |&nbsp;&nbsp; 15767&nbsp;&nbsp;&nbsp; |&nbsp; 76.47&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 12.30&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Without Exceptions:&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Case | # lines of | Compile | Optimization | # lines of int | Compile&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp; | int C code |&nbsp; Time&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; Level&nbsp;&nbsp;&nbsp;&nbsp; | C code - base&nbsp; | Time - base&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 1&nbsp; |&nbsp;&nbsp; 26975&nbsp;&nbsp;&nbsp; |&nbsp; 25.01&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 12.47&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 2&nbsp; |&nbsp;&nbsp; 16288&nbsp;&nbsp;&nbsp; |&nbsp; 31.08&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 13.71&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 3&nbsp; |&nbsp;&nbsp; 12476&nbsp;&nbsp;&nbsp; |&nbsp; 49.62&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 12.32&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;&nbsp; 4&nbsp; |&nbsp;&nbsp; 13037&nbsp;&nbsp;&nbsp; |&nbsp; 57.00&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp; +K3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 12.33&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;-------------------------------------------------------------------------&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;The results recorded in the &quot;base&quot; columns are results obtained when the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;template instantiation request is commented out and reflects the compile&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;times and lines of intermediate C code for the case where only the included&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;header files are being parsed.&nbsp; Care was taken to record the number of lines&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;of intermediate C code before the prelinker phase.&nbsp; The prelinker phase&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;determines that the explicit instantiation request for this single assign&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;function triggers the need for an additional 292 templates and the lines of&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;intermediate C code for these additional 292 templates nearly doubles the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;above numbers.&nbsp; It seems amazing that a single assign function would need&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;between 14430 and 28750 lines of intermediate C code to represent it&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;depending on the optimization level and that it would trigger the need for&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;another 292 templates.&nbsp; Also, I don't think we have gotten to the level of&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;complexity in the expressions for our Pooma 2 based code that we have in our&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Pooma 1 based code.&nbsp; In our Pooma 1 based code, I have seen expressions which &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;generate template parameters over 2800 characters long.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Here is another benchmark to compare the Pooma 2 base code and the Pooma 1&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;based code.&nbsp; In the Pooma 1 based code, my instantiation library explicitly&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;instantiated nearly every Pooma 1 template.&nbsp; The +K1 compilation of this&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;instantiation library generated approximately 3.5 million lines of&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;intermediate C code for the whole library and just under 1 million lines for&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the instantiation of all the global assign functions.&nbsp; There were about 1196&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;of these global assign functions that were instantiated.&nbsp; In constrast, the&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Pooma 2 instantiation library instantiates 1282 global assign functions which &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;generates 4711082 lines of intermediate C code.&nbsp; The complete Pooma 2&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;instantiation library currently generates 5327932 lines of intermediate C&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;code.&nbsp; However, there are still lots of Pooma 2 templates that are currently&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;being instantiated by the prelinker in our Blanca code that need to be moved&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;to the Pooma 2 instantiation library.&nbsp; So, it appears that there is alot more &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;intermediate C code generated by KCC for our Pooma 2 code than for our Pooma&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;1 code.&nbsp; I'm not sure what to make of all this since to a certain degree I am &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;comparing apples and oranges.&nbsp; But I think it does provide some indication of &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;how Pooma 1 and Pooma 2 compare in regard to code generation which&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;contributes to long compile times.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Also, I tried out Jeffrey's fixes to allow instantiation of the View1 class&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;and have some comments.&nbsp; It appears that I can now instantiate the View1&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;class but now I find that I have about 1000 AltView1 templates that I am&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;unable to instantiate.&nbsp; Perhaps we need a new AltAltView1 class:-).&nbsp; Well,&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;seriously, this fix is not solving the root problem which I have which is&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;that I need to be able to explicitly instantiate anything that the compiler&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;is able to instantiate so that I don't have to depend on the prelinker&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;recompiling files.&nbsp; Also, I tried the following template instantiation&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;request which did not work.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;FONT SIZE=2&gt;template const bool View1&lt;Field&lt;T1,T2,T3&gt;,T4&gt;::sv;&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;KCC using --strict complained that I did not provide an implementation.&nbsp; So,&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;I don't know what the problem is here.&nbsp; I don't know if the syntax is wrong&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;or there is some bug in KCC.&nbsp; But I do know that the prelinker is capable of&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;performing the instantiation of this member of the View1 class.&nbsp; I have this&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;problem with other Pooma 2 classes such as the ElementProperties class.&nbsp; I&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;wish I could get this problem solved because my compile times are at least&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;twice as long as they would be if I were able to instantiate everything that&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;the compiler is instantiating.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;I would like to know what the Pooma 2 team things about these results.&nbsp; I&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;find them sobering and not something that I want to see publicized.&nbsp; Do you&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;guys have any ideas about how to modify the relevant parts of Pooma 2 so that &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;less intermediate C code gets generated by KCC?&nbsp; Are there tradeoffs here&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;that you are aware of?&nbsp; Is this code generation problem related specifically&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;to the expression template engine or are there other things involved here?&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;I've been wondering lately if Pooma 2 was designed in a way that would make&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;it easy to use some other expression template engine.&nbsp; I've also been&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;wondering whether it would be possible to make expression templates a feature &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;selectable at compile time.&nbsp; Then for debugging or development perhaps a more &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;lightweight version of Pooma 2 could be used that would run like a dog but&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;compile much faster and facilitate an effective and efficient development&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;environment.&nbsp; Then building a high performance runtime version of our code&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;could be banished to a batch script that was done only infrequently or by a&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;very small group of people.&nbsp; Are things like this reasonable to contemplate&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;with Pooma 2?&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;Please let me know if you have any questions about the results I have&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;presented in this email or if I can supply additional information.&nbsp; I plan to &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;also send a copy of the current version of my Pooma 2 instantiation stuff so&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;you guys can do any testing of your own that you want to do.&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;P&gt;&lt;FONT SIZE=2&gt;-- &lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;Dave Nystrom&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; email: <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">wdn at lanl.gov</A>&lt;/FONT&gt;
 &gt; &lt;BR&gt;&lt;FONT SIZE=2&gt;LANL X-3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; phone: 505-667-7913&nbsp;&nbsp;&nbsp;&nbsp; fax: 505-665-3046&lt;/FONT&gt;
 &gt; &lt;/P&gt;
 &gt; 
 &gt; &lt;/BODY&gt;
 &gt; &lt;/HTML&gt;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000420.html">[pooma-dev] Compile Time Problems and Pooma 2
</A></li>
	<LI>Next message: <A HREF="000429.html">[pooma-dev] Compile Time Problems and Pooma 2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#426">[ date ]</a>
              <a href="thread.html#426">[ thread ]</a>
              <a href="subject.html#426">[ subject ]</a>
              <a href="author.html#426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">More information about the pooma-dev
mailing list</a><br>
</body></html>
