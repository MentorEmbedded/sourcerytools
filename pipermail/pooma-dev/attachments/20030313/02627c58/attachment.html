<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;5.5.2653.12&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[pooma-dev]&nbsp;[PATCH]&nbsp;Re:&nbsp;Two&nbsp;New&nbsp;Array&nbsp;Failures&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;I&nbsp;wouldn't&nbsp;apply&nbsp;this&nbsp;without&nbsp;careful&nbsp;performance&nbsp;testing&nbsp;on&nbsp;a&nbsp;large-ish&nbsp;problem&nbsp;using&nbsp;KCC&nbsp;(or&nbsp;some&nbsp;other&nbsp;compiler&nbsp;that&nbsp;really&nbsp;inlines&nbsp;everything&nbsp;that&nbsp;it&nbsp;is&nbsp;told&nbsp;to&nbsp;inline&nbsp;and&nbsp;optimizes&nbsp;the&nbsp;hell&nbsp;out&nbsp;of&nbsp;the&nbsp;results).&nbsp;This&nbsp;seems&nbsp;like&nbsp;a&nbsp;reasonable&nbsp;thing&nbsp;to&nbsp;do,&nbsp;but&nbsp;I&nbsp;worry&nbsp;about&nbsp;adding&nbsp;additional&nbsp;code&nbsp;to&nbsp;the&nbsp;construction&nbsp;of&nbsp;expressions&nbsp;since&nbsp;they&nbsp;are&nbsp;constructed&nbsp;recursively&nbsp;and&nbsp;it&nbsp;is&nbsp;expected&nbsp;that&nbsp;a&nbsp;lot&nbsp;of&nbsp;stuff&nbsp;that&nbsp;goes&nbsp;on&nbsp;in&nbsp;their&nbsp;usage&nbsp;will&nbsp;be&nbsp;inlined&nbsp;away.&nbsp;Back&nbsp;in&nbsp;the&nbsp;day&nbsp;we&nbsp;ran&nbsp;into&nbsp;a&nbsp;number&nbsp;of&nbsp;cases&nbsp;where&nbsp;it&nbsp;was&nbsp;easy&nbsp;to&nbsp;push&nbsp;the&nbsp;optimizer&nbsp;over&nbsp;the&nbsp;edge&nbsp;and&nbsp;lose&nbsp;a&nbsp;lot&nbsp;of&nbsp;performance&nbsp;with&nbsp;KCC&nbsp;and&nbsp;SGI&nbsp;CC&nbsp;(the&nbsp;only&nbsp;two&nbsp;compilers&nbsp;that,&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;know,&nbsp;have&nbsp;approached&nbsp;hand-coded&nbsp;loop&nbsp;speed&nbsp;for&nbsp;Pooma&nbsp;Array&nbsp;code,&nbsp;which&nbsp;is&nbsp;THE&nbsp;goal.)&nbsp;This&nbsp;is&nbsp;most&nbsp;important&nbsp;in&nbsp;ExpressionEngines&nbsp;built&nbsp;out&nbsp;of&nbsp;Brick-engines&nbsp;-&nbsp;i.e.&nbsp;the&nbsp;iterates&nbsp;that&nbsp;ultimately&nbsp;are&nbsp;created&nbsp;and&nbsp;evaluated&nbsp;in&nbsp;evaluating&nbsp;a&nbsp;multipatch&nbsp;expression.&nbsp;If&nbsp;the&nbsp;loops&nbsp;over&nbsp;these&nbsp;expression&nbsp;engines&nbsp;don't&nbsp;completely&nbsp;inline,&nbsp;and&nbsp;basically&nbsp;end&nbsp;up&nbsp;looking&nbsp;like&nbsp;what&nbsp;you'd&nbsp;write&nbsp;by&nbsp;hand,&nbsp;you're&nbsp;hosed,&nbsp;from&nbsp;a&nbsp;performance&nbsp;perspective.&nbsp;Unless&nbsp;things&nbsp;have&nbsp;changed&nbsp;dramatically,&nbsp;gcc&nbsp;3&nbsp;is&nbsp;not&nbsp;at&nbsp;the&nbsp;level&nbsp;of&nbsp;performance&nbsp;to&nbsp;make&nbsp;this&nbsp;assessment.&nbsp;(Jeffrey,&nbsp;do&nbsp;you&nbsp;agree?)&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;Jim&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;------------------------------------------------------------------------&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;James&nbsp;A.&nbsp;Crotinger&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email:&nbsp;jimc@proximation.com&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;NumeriX,&nbsp;LLC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phone:&nbsp;&nbsp;(505)&nbsp;424-4477&nbsp;x104&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;2960&nbsp;Rodeo&nbsp;Park&nbsp;Dr.&nbsp;W.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Santa&nbsp;Fe,&nbsp;NM&nbsp;87505&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;-----Original&nbsp;Message-----&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;From:&nbsp;Richard&nbsp;Guenther&nbsp;[&lt;A&nbsp;HREF=&quot;mailto:rguenth@tat.physik.uni-tuebingen.de&quot;&gt;mailto:rguenth@tat.physik.uni-tuebingen.de&lt;/A&gt;]&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Sent:&nbsp;Wednesday,&nbsp;March&nbsp;12,&nbsp;2003&nbsp;4:06&nbsp;PM&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;To:&nbsp;Jeffrey&nbsp;Oldham&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Cc:&nbsp;pooma-dev@pooma.codesourcery.com&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Subject:&nbsp;Re:&nbsp;[pooma-dev]&nbsp;[PATCH]&nbsp;Re:&nbsp;Two&nbsp;New&nbsp;Array&nbsp;Failures&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;On&nbsp;Wed,&nbsp;12&nbsp;Mar&nbsp;2003,&nbsp;Richard&nbsp;Guenther&nbsp;wrote:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;Hi!&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;The&nbsp;attached&nbsp;patch&nbsp;canonicalizes&nbsp;Engine::domain()&nbsp;const&nbsp;to&nbsp;return&nbsp;a&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;const&nbsp;reference&nbsp;to&nbsp;its&nbsp;domain.&nbsp;It&nbsp;can&nbsp;do&nbsp;so&nbsp;by&nbsp;adding&nbsp;a&nbsp;domain_m&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;member&nbsp;to&nbsp;the&nbsp;expression&nbsp;engine&nbsp;(pls&nbsp;review&nbsp;this&nbsp;part&nbsp;carefully,&nbsp;as&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;in&nbsp;some&nbsp;of&nbsp;the&nbsp;constructors&nbsp;we&nbsp;might&nbsp;do&nbsp;things&nbsp;more&nbsp;optimally&nbsp;if&nbsp;I&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;had&nbsp;understood&nbsp;what&nbsp;they&nbsp;actually&nbsp;do...).&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;(We&nbsp;might&nbsp;do&nbsp;something&nbsp;similar&nbsp;to&nbsp;the&nbsp;Engine::layout()&nbsp;const&nbsp;methods,&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;though&nbsp;this&nbsp;would&nbsp;affect&nbsp;many&nbsp;more&nbsp;engines&nbsp;to&nbsp;be&nbsp;added&nbsp;a&nbsp;layout_m&nbsp;member)&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;Testing&nbsp;is&nbsp;still&nbsp;in&nbsp;progress,&nbsp;but&nbsp;the&nbsp;concept&nbsp;sounds&nbsp;reasonable?&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Build&nbsp;and&nbsp;testing&nbsp;completed&nbsp;with&nbsp;no&nbsp;regressions&nbsp;in&nbsp;Engine,&nbsp;Array&nbsp;and&nbsp;Field&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;on&nbsp;ppc-linux&nbsp;with&nbsp;gcc&nbsp;3.2.3&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Ok&nbsp;to&nbsp;apply?&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Thanks,&nbsp;Richard.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
