<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;5.5.2653.12&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[pooma-dev]&nbsp;[PATCH]&nbsp;Fix&nbsp;Engine&lt;..,&nbsp;MultiPatch&lt;..&gt;&nbsp;&gt;::makeOwnCopy()&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Hmmm.&nbsp;I&nbsp;don't&nbsp;have&nbsp;time&nbsp;to&nbsp;play&nbsp;with&nbsp;this,&nbsp;but&nbsp;something&nbsp;looks&nbsp;wrong.&nbsp;The&nbsp;sequence&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;data_m.makeOwnCopy();&lt;/FONT&gt;<br>
&lt;BR&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;if&nbsp;(data_m.isShared())&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;the&nbsp;isShared()&nbsp;test&nbsp;should&nbsp;always&nbsp;return&nbsp;false&nbsp;after&nbsp;a&nbsp;call&nbsp;to&nbsp;makeOwnCopy&nbsp;-&nbsp;that&nbsp;should&nbsp;be&nbsp;an&nbsp;invariant&nbsp;property&nbsp;of&nbsp;any&nbsp;ref-counted&nbsp;thing.&nbsp;That&nbsp;was&nbsp;certainly&nbsp;my&nbsp;intention.&nbsp;&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;Jim&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;------------------------------------------------------------------------&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;James&nbsp;A.&nbsp;Crotinger&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jimc@numerix.com&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;NumeriX,&nbsp;LLC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phone:&nbsp;&nbsp;(505)&nbsp;424-4477&nbsp;x104&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;2960&nbsp;Rodeo&nbsp;Park&nbsp;Dr.&nbsp;W.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Santa&nbsp;Fe,&nbsp;NM&nbsp;87505&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;-----Original&nbsp;Message-----&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;From:&nbsp;Richard&nbsp;Guenther&nbsp;[&lt;A&nbsp;HREF=&quot;mailto:rguenth@tat.physik.uni-tuebingen.de&quot;&gt;mailto:rguenth@tat.physik.uni-tuebingen.de&lt;/A&gt;]&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Sent:&nbsp;Tuesday,&nbsp;April&nbsp;22,&nbsp;2003&nbsp;9:58&nbsp;AM&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;To:&nbsp;pooma-dev@pooma.codesourcery.com&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Cc:&nbsp;Jeffrey&nbsp;D.&nbsp;Oldham&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Subject:&nbsp;[pooma-dev]&nbsp;[PATCH]&nbsp;Fix&nbsp;Engine&lt;..,&nbsp;MultiPatch&lt;..&gt;&nbsp;&gt;::makeOwnCopy()&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Hi!&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Currently&nbsp;for&nbsp;a&nbsp;multipatch&nbsp;engine&nbsp;makeOwnCopy()&nbsp;does&nbsp;no&nbsp;good&nbsp;(it&nbsp;doesnt&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;copy),&nbsp;it&nbsp;seems&nbsp;because&nbsp;just&nbsp;calling&nbsp;makeOwnCopy()&nbsp;on&nbsp;the&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;RefCountedBlockPtr&nbsp;does&nbsp;not&nbsp;copy&nbsp;the&nbsp;underlying&nbsp;engines.&nbsp;I&nbsp;didnt&nbsp;figure&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;out&nbsp;why&nbsp;and&nbsp;so&nbsp;came&nbsp;up&nbsp;with&nbsp;the&nbsp;following&nbsp;fix&nbsp;which&nbsp;works&nbsp;for&nbsp;me.&nbsp;I&nbsp;have&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;also&nbsp;an&nbsp;updated&nbsp;Field/BasicTest3.cpp&nbsp;which&nbsp;now&nbsp;checks&nbsp;every&nbsp;engine&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;combination&nbsp;for&nbsp;makeOwnCopy&nbsp;and&nbsp;it&nbsp;now&nbsp;succeeds&nbsp;for&nbsp;both&nbsp;MultiPatch&lt;Brick&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;and&nbsp;MultiPatch&lt;Remote&lt;Brick&gt;&nbsp;&gt;.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Ok&nbsp;to&nbsp;apply?&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Richard.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;2003&nbsp;Apr&nbsp;22&nbsp;&nbsp;Richard&nbsp;Guenther&nbsp;&lt;richard.guenther@uni-tuebingen.de&gt;&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;*&nbsp;Engine/MultiPatchEngine.cpp:&nbsp;do&nbsp;makeOwnCopy()&nbsp;manually.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;=====&nbsp;MultiPatchEngine.cpp&nbsp;1.3&nbsp;vs&nbsp;edited&nbsp;=====&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;---&nbsp;1.3/r2/src/Engine/MultiPatchEngine.cpp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fri&nbsp;Jan&nbsp;24&nbsp;10:35:52&nbsp;2003&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+++&nbsp;edited/MultiPatchEngine.cpp&nbsp;Tue&nbsp;Apr&nbsp;22&nbsp;17:42:04&nbsp;2003&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;@@&nbsp;-244,8&nbsp;+244,17&nbsp;@@&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;Engine&lt;Dim,&nbsp;T,&nbsp;MultiPatch&lt;LayoutTag,PatchTag&gt;&nbsp;&gt;::&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;makeOwnCopy()&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;{&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;-&nbsp;&nbsp;data_m.makeOwnCopy();&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;-&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;PAssert(data_m.isValid());&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;if&nbsp;(data_m.isShared())&nbsp;{&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;&nbsp;&nbsp;PatchContainer_t&nbsp;model&nbsp;=&nbsp;data_m;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;&nbsp;&nbsp;data_m&nbsp;=&nbsp;PatchContainer_t(model.size());&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i=0;&nbsp;i&lt;model.size();&nbsp;++i)&nbsp;{&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data_m[i]&nbsp;=&nbsp;model[i];&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data_m[i].makeOwnCopy();&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;&nbsp;&nbsp;}&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;&nbsp;&nbsp;pDirty_m&nbsp;=&nbsp;new&nbsp;bool(*pDirty_m);&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&nbsp;&nbsp;}&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;+&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;return&nbsp;*this;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;}&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
