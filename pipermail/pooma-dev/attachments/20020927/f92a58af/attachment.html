<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;5.5.2653.12&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[pooma-dev]&nbsp;Assigning&nbsp;to&nbsp;internal&nbsp;guards&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;A&nbsp;good&nbsp;starting&nbsp;point&nbsp;would&nbsp;be&nbsp;Engine/Intersector.h.&nbsp;You&nbsp;might&nbsp;want&nbsp;to&nbsp;step&nbsp;through&nbsp;the&nbsp;MultiPatch&nbsp;evaluation&nbsp;to&nbsp;see&nbsp;how&nbsp;this&nbsp;all&nbsp;flows.&nbsp;I&nbsp;think&nbsp;it&nbsp;currently&nbsp;just&nbsp;bails&nbsp;out&nbsp;of&nbsp;the&nbsp;process&nbsp;of&nbsp;accumulating&nbsp;intersected&nbsp;patches&nbsp;if&nbsp;its&nbsp;already&nbsp;seem&nbsp;the&nbsp;same&nbsp;layout&nbsp;ID&nbsp;(not&nbsp;the&nbsp;same&nbsp;layout&nbsp;-&nbsp;we&nbsp;want&nbsp;this&nbsp;bail-out&nbsp;even&nbsp;if&nbsp;different&nbsp;layouts&nbsp;have&nbsp;differing&nbsp;numbers&nbsp;of&nbsp;internal&nbsp;guards).&nbsp;I&nbsp;think&nbsp;you'll&nbsp;have&nbsp;to&nbsp;change&nbsp;this&nbsp;by&nbsp;building&nbsp;a&nbsp;new&nbsp;PETE&nbsp;functor&nbsp;that&nbsp;just&nbsp;gets&nbsp;you&nbsp;the&nbsp;layout&nbsp;reference&nbsp;(this&nbsp;may&nbsp;already&nbsp;exist)&nbsp;and&nbsp;then&nbsp;you'll&nbsp;have&nbsp;to&nbsp;do&nbsp;a&nbsp;ForEach&nbsp;that&nbsp;checks&nbsp;if&nbsp;all&nbsp;layouts&nbsp;have&nbsp;the&nbsp;same&nbsp;address.&nbsp;Hmmm.&nbsp;Layouts&nbsp;have&nbsp;shallow&nbsp;copy&nbsp;semantics,&nbsp;so&nbsp;what&nbsp;you'd&nbsp;really&nbsp;like&nbsp;is&nbsp;an&nbsp;operator==&nbsp;on&nbsp;layouts&nbsp;that&nbsp;just&nbsp;compared&nbsp;object&nbsp;identity.&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;if&nbsp;that&nbsp;is&nbsp;there.&nbsp;Anyway,&nbsp;if&nbsp;all&nbsp;the&nbsp;layouts&nbsp;are&nbsp;the&nbsp;same,&nbsp;then&nbsp;you'd&nbsp;want&nbsp;to&nbsp;generate&nbsp;a&nbsp;list&nbsp;of&nbsp;patches&nbsp;that&nbsp;was&nbsp;the&nbsp;total-domain&nbsp;of&nbsp;each&nbsp;underlying&nbsp;patch.&nbsp;If&nbsp;any&nbsp;layout&nbsp;was&nbsp;different,&nbsp;then&nbsp;you'd&nbsp;have&nbsp;to&nbsp;branch&nbsp;to&nbsp;the&nbsp;existing&nbsp;intersector&nbsp;code.&nbsp;Doesn't&nbsp;really&nbsp;sound&nbsp;all&nbsp;that&nbsp;hard.&nbsp;You&nbsp;probably&nbsp;want&nbsp;to&nbsp;protect&nbsp;the&nbsp;new&nbsp;code&nbsp;with&nbsp;a&nbsp;configuration&nbsp;flag&nbsp;and&nbsp;maybe&nbsp;even&nbsp;a&nbsp;runtime&nbsp;flag&nbsp;to&nbsp;allow&nbsp;comparisons.&nbsp;&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;In&nbsp;your&nbsp;example:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;temp(I)&nbsp;=&nbsp;a(I)&nbsp;+&nbsp;b(I);&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;c(I)&nbsp;=&nbsp;temp(I-1)&nbsp;+&nbsp;temp(I+1);&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;you&nbsp;should&nbsp;also&nbsp;compare&nbsp;with&nbsp;doing&nbsp;a&nbsp;and&nbsp;b&nbsp;with&nbsp;no&nbsp;guards,&nbsp;which&nbsp;they&nbsp;don't&nbsp;need&nbsp;in&nbsp;this&nbsp;expression.&nbsp;If&nbsp;your&nbsp;stuff&nbsp;is&nbsp;1D,&nbsp;the&nbsp;memory&nbsp;is&nbsp;probably&nbsp;not&nbsp;an&nbsp;issue,&nbsp;but&nbsp;in&nbsp;multiple&nbsp;dimensions&nbsp;it&nbsp;can&nbsp;be&nbsp;a&nbsp;big&nbsp;problem&nbsp;-&nbsp;when&nbsp;the&nbsp;difference&nbsp;is&nbsp;&quot;runs,&nbsp;but&nbsp;communicates&nbsp;a&nbsp;lot&quot;&nbsp;and&nbsp;&quot;doesn't&nbsp;run&nbsp;because&nbsp;it&nbsp;won't&nbsp;fit&nbsp;into&nbsp;memory&quot;,&nbsp;people&nbsp;tend&nbsp;to&nbsp;choose&nbsp;the&nbsp;first.&nbsp;:)&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;FONT&nbsp;SIZE=2&gt;Jim&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;-----Original&nbsp;Message-----&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;From:&nbsp;Richard&nbsp;Guenther&nbsp;[&lt;A&nbsp;HREF=&quot;mailto:rguenth@tat.physik.uni-tuebingen.de&quot;&gt;mailto:rguenth@tat.physik.uni-tuebingen.de&lt;/A&gt;]&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Sent:&nbsp;Friday,&nbsp;September&nbsp;27,&nbsp;2002&nbsp;1:57&nbsp;PM&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;To:&nbsp;James&nbsp;Crotinger&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Cc:&nbsp;pooma-dev@pooma.codesourcery.com&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Subject:&nbsp;RE:&nbsp;[pooma-dev]&nbsp;Assigning&nbsp;to&nbsp;internal&nbsp;guards&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;On&nbsp;Wed,&nbsp;25&nbsp;Sep&nbsp;2002,&nbsp;James&nbsp;Crotinger&nbsp;wrote:&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;We&nbsp;considered&nbsp;this&nbsp;and&nbsp;it&nbsp;was&nbsp;on&nbsp;the&nbsp;list&nbsp;of&nbsp;things&nbsp;to&nbsp;work&nbsp;on&nbsp;someday.&nbsp;If&nbsp;I&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;remember&nbsp;correctly,&nbsp;we&nbsp;were&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;figure&nbsp;out&nbsp;if&nbsp;the&nbsp;layouts&nbsp;all&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;matched,&nbsp;including&nbsp;the&nbsp;numbers&nbsp;of&nbsp;internal&nbsp;guards,&nbsp;and&nbsp;if&nbsp;so,&nbsp;generate&nbsp;patch&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;iterates&nbsp;that&nbsp;performed&nbsp;the&nbsp;operations&nbsp;on&nbsp;the&nbsp;entire&nbsp;domains,&nbsp;not&nbsp;just&nbsp;the&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;physical&nbsp;domains.&nbsp;We&nbsp;already&nbsp;figure&nbsp;out&nbsp;if&nbsp;the&nbsp;layouts&nbsp;match&nbsp;at&nbsp;the&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;physical-domain&nbsp;basis,&nbsp;I&nbsp;believe,&nbsp;so&nbsp;this&nbsp;didn't&nbsp;sound&nbsp;like&nbsp;a&nbsp;big&nbsp;extension.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;Indeed,&nbsp;the&nbsp;simplest&nbsp;form&nbsp;of&nbsp;this&nbsp;would&nbsp;be&nbsp;to&nbsp;check&nbsp;that&nbsp;everyone&nbsp;has&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;exactly&nbsp;the&nbsp;same&nbsp;layout.&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;Of&nbsp;course,&nbsp;in&nbsp;multiple&nbsp;dimensions&nbsp;you&nbsp;generally&nbsp;don't&nbsp;want&nbsp;internal&nbsp;guards&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;on&nbsp;anything&nbsp;that&nbsp;you're&nbsp;not&nbsp;going&nbsp;to&nbsp;stencil,&nbsp;so&nbsp;in&nbsp;practice&nbsp;it&nbsp;isn't&nbsp;clear&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;how&nbsp;often&nbsp;this&nbsp;practice&nbsp;will&nbsp;really&nbsp;pay&nbsp;off.&nbsp;(Internal&nbsp;guards&nbsp;can&nbsp;consume&nbsp;a&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&gt;&nbsp;lot&nbsp;of&nbsp;memory&nbsp;in&nbsp;3D.)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;We&nbsp;encounter&nbsp;this&nbsp;mainly&nbsp;with&nbsp;using&nbsp;temporaries&nbsp;(to&nbsp;do&nbsp;CSE).&nbsp;So&nbsp;f.i.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;temp(I)&nbsp;=&nbsp;a(I)&nbsp;+&nbsp;b(I);&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;c(I)&nbsp;=&nbsp;temp(I-1)&nbsp;+&nbsp;temp(I+1);&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;or&nbsp;when&nbsp;using&nbsp;in-place&nbsp;stencils&nbsp;which&nbsp;need&nbsp;a&nbsp;temporary,&nbsp;too,&nbsp;like&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;temp(I)&nbsp;=&nbsp;a(I)&nbsp;+&nbsp;b(I);&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;a(I)&nbsp;=&nbsp;temp(I-1)&nbsp;+&nbsp;temp(I+1);&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Oh&nbsp;-&nbsp;and&nbsp;this&nbsp;happens&nbsp;quite&nbsp;often&nbsp;so&nbsp;that&nbsp;for&nbsp;our&nbsp;local&nbsp;testing&nbsp;cluster&nbsp;3d&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;simulations&nbsp;are&nbsp;unusable&nbsp;without&nbsp;this&nbsp;optimization&nbsp;(maybe&nbsp;a&nbsp;SCore&nbsp;bug&nbsp;with&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;extreme&nbsp;load,&nbsp;too,&nbsp;though).&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Do&nbsp;you&nbsp;have&nbsp;any&nbsp;starting&nbsp;hints&nbsp;where&nbsp;to&nbsp;look&nbsp;at&nbsp;to&nbsp;implement&nbsp;what&nbsp;you&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;suggested?&nbsp;I.e.&nbsp;where&nbsp;is&nbsp;the&nbsp;layout&nbsp;matching&nbsp;done&nbsp;(f.e.&nbsp;for&nbsp;a&nbsp;multipatch&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;engine)?&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Thanks,&nbsp;Richard.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;--&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Richard&nbsp;Guenther&nbsp;&lt;richard.guenther@uni-tuebingen.de&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;WWW:&nbsp;&lt;A&nbsp;HREF=&quot;http://www.tat.physik.uni-tuebingen.de/~rguenth/&quot;&nbsp;TARGET=&quot;_blank&quot;&gt;http://www.tat.physik.uni-tuebingen.de/~rguenth/&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;The&nbsp;GLAME&nbsp;Project:&nbsp;&lt;A&nbsp;HREF=&quot;http://www.glame.de/&quot;&nbsp;TARGET=&quot;_blank&quot;&gt;http://www.glame.de/&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
