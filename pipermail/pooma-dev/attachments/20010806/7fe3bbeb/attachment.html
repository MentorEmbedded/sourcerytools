<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;timers&nbsp;and&nbsp;performance&nbsp;measurement&nbsp;under&nbsp;Linux&lt;/TITLE&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;5.50.4616.200&quot;&nbsp;name=GENERATOR&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;Hi&nbsp;<br>
Jim,&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;It's&nbsp;<br>
probably&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;have&nbsp;an&nbsp;option&nbsp;for&nbsp;choosing&nbsp;between&nbsp;CPU&nbsp;<br>
time&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;and&nbsp;<br>
wallclock&nbsp;time&nbsp;as&nbsp;the&nbsp;benchmark&nbsp;measurement,&nbsp;since&nbsp;they&nbsp;each&nbsp;<br>
have&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;their&nbsp;<br>
own&nbsp;purpose.&nbsp;&nbsp;Normally&nbsp;CPU&nbsp;time&nbsp;is&nbsp;interesting&nbsp;for&nbsp;measuring&nbsp;<br>
on-node&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;performance&nbsp;and&nbsp;wallclock&nbsp;time&nbsp;is&nbsp;more&nbsp;useful&nbsp;for&nbsp;measuring&nbsp;parallel&nbsp;<br>
speedup.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;As&nbsp;for&nbsp;<br>
threads,&nbsp;I&nbsp;think&nbsp;you&nbsp;can&nbsp;only&nbsp;measure&nbsp;CPU&nbsp;time&nbsp;while&nbsp;a&nbsp;thread&nbsp;<br>
is&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;active&nbsp;<br>
on&nbsp;a&nbsp;processor.&nbsp;&nbsp;Doing&nbsp;anything&nbsp;else&nbsp;doesn't&nbsp;really&nbsp;make&nbsp;sense.&nbsp;&nbsp;<br>
So&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;with&nbsp;<br>
clock(),&nbsp;you&nbsp;would&nbsp;want&nbsp;to&nbsp;call&nbsp;clock()&nbsp;when&nbsp;a&nbsp;thread&nbsp;first&nbsp;begins&nbsp;to&nbsp;<br>
work&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;(not&nbsp;<br>
before&nbsp;the&nbsp;thread&nbsp;is&nbsp;actually&nbsp;launched!)&nbsp;and&nbsp;then&nbsp;call&nbsp;clock()&nbsp;again&nbsp;<br>
when&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;the&nbsp;<br>
thread&nbsp;is&nbsp;done&nbsp;working&nbsp;(but&nbsp;before&nbsp;the&nbsp;thread&nbsp;exits).&nbsp;&nbsp;If&nbsp;each&nbsp;thread&nbsp;does&nbsp;<br>
&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;a&nbsp;tiny&nbsp;<br>
amount&nbsp;of&nbsp;work,&nbsp;the&nbsp;resolution&nbsp;issue&nbsp;you&nbsp;mentioned&nbsp;will&nbsp;be&nbsp;an&nbsp;<br>
issue.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;The&nbsp;<br>
clock()&nbsp;function&nbsp;has&nbsp;different&nbsp;resolutions&nbsp;on&nbsp;different&nbsp;architectures.&nbsp;&nbsp;<br>
But&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;normally&nbsp;the&nbsp;variation&nbsp;in&nbsp;performance&nbsp;measurement&nbsp;from&nbsp;one&nbsp;run&nbsp;to&nbsp;the&nbsp;<br>
next&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;is&nbsp;far&nbsp;<br>
greater&nbsp;than&nbsp;the&nbsp;timer&nbsp;resolution&nbsp;anyway.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;The&nbsp;<br>
gettimeofday()&nbsp;function&nbsp;is&nbsp;probably&nbsp;the&nbsp;best&nbsp;thing&nbsp;to&nbsp;use&nbsp;for&nbsp;<br>
wallclock&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;time&nbsp;<br>
measurement.&nbsp;&nbsp;This&nbsp;is&nbsp;what&nbsp;we&nbsp;used&nbsp;in&nbsp;the&nbsp;old&nbsp;Timer&nbsp;class&nbsp;in&nbsp;Pooma&nbsp;<br>
r1.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;I&nbsp;<br>
haven't&nbsp;looked&nbsp;at&nbsp;your&nbsp;check-in&nbsp;yet,&nbsp;but&nbsp;hopefully&nbsp;you&nbsp;remembered&nbsp;to&nbsp;<br>
check&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;for&nbsp;<br>
overflow&nbsp;in&nbsp;the&nbsp;microseconds&nbsp;counter&nbsp;and&nbsp;increment&nbsp;the&nbsp;seconds&nbsp;<br>
counter&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;accordingly.&nbsp;&nbsp;Other&nbsp;than&nbsp;that,&nbsp;I&nbsp;remember&nbsp;that&nbsp;code&nbsp;as&nbsp;being&nbsp;pretty&nbsp;<br>
simple.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;As&nbsp;for&nbsp;<br>
your&nbsp;comments&nbsp;on&nbsp;the&nbsp;PIII&nbsp;performance,&nbsp;I&nbsp;think&nbsp;what&nbsp;you&nbsp;are&nbsp;seeing&nbsp;<br>
&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;is&nbsp;<br>
correct.&nbsp;&nbsp;The&nbsp;out-of-cache&nbsp;performance&nbsp;is&nbsp;not&nbsp;very&nbsp;good.&nbsp;&nbsp;You&nbsp;will&nbsp;see&nbsp;<br>
&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;closer&nbsp;<br>
to&nbsp;optimal&nbsp;performance&nbsp;only&nbsp;when&nbsp;the&nbsp;problem&nbsp;size&nbsp;is&nbsp;in-cache,&nbsp;and&nbsp;<br>
&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;the&nbsp;<br>
caches&nbsp;are&nbsp;much&nbsp;smaller&nbsp;than&nbsp;what&nbsp;we&nbsp;were&nbsp;used&nbsp;to&nbsp;on&nbsp;the&nbsp;SGI&nbsp;<br>
boxes.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;With&nbsp;<br>
an&nbsp;optimized&nbsp;C&nbsp;code&nbsp;kernel,&nbsp;you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;see&nbsp;the&nbsp;cache&nbsp;<br>
effect&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;and&nbsp;<br>
stronger&nbsp;flops&nbsp;numbers&nbsp;for&nbsp;small&nbsp;problem&nbsp;sizes.&nbsp;&nbsp;(But&nbsp;of&nbsp;course,&nbsp;it&nbsp;<br>
gets&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;harder&nbsp;<br>
to&nbsp;measure&nbsp;accurately,&nbsp;too.)&nbsp;&nbsp;I'm&nbsp;not&nbsp;aware&nbsp;of&nbsp;any&nbsp;profiling&nbsp;tools&nbsp;<br>
from&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;KAI,&nbsp;<br>
so&nbsp;I&nbsp;think&nbsp;prof/gprof&nbsp;is&nbsp;all&nbsp;there&nbsp;is,&nbsp;unless&nbsp;you&nbsp;know&nbsp;how&nbsp;to&nbsp;access&nbsp;<br>
Pentium&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;hardware&nbsp;counters.&nbsp;&nbsp;Quite&nbsp;a&nbsp;while&nbsp;ago,&nbsp;I&nbsp;fooled&nbsp;around&nbsp;with&nbsp;the&nbsp;<br>
performance&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;analysis&nbsp;tools&nbsp;that&nbsp;come&nbsp;with&nbsp;Intel&nbsp;VTune.&nbsp;&nbsp;They&nbsp;were&nbsp;not&nbsp;terribly&nbsp;<br>
helpful,&nbsp;other&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;than&nbsp;<br>
telling&nbsp;me&nbsp;the&nbsp;obvious,&nbsp;that&nbsp;all&nbsp;the&nbsp;time&nbsp;was&nbsp;being&nbsp;spent&nbsp;in&nbsp;the&nbsp;kernel&nbsp;<br>
loop.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;The&nbsp;<br>
real&nbsp;problem&nbsp;is&nbsp;that&nbsp;the&nbsp;optimization&nbsp;and&nbsp;inlining&nbsp;of&nbsp;the&nbsp;compiler&nbsp;were&nbsp;<br>
poor&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;enough&nbsp;<br>
that&nbsp;there&nbsp;was&nbsp;little&nbsp;to&nbsp;do&nbsp;to&nbsp;improve&nbsp;performance.&nbsp;&nbsp;I&nbsp;remember&nbsp;<br>
being&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;surprised&nbsp;to&nbsp;find&nbsp;that&nbsp;Blitz&nbsp;code&nbsp;optimized&nbsp;much&nbsp;better&nbsp;under&nbsp;VTune&nbsp;than&nbsp;<br>
Pooma&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;code.&nbsp;&nbsp;I&nbsp;think&nbsp;the&nbsp;reasons&nbsp;had&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;amount&nbsp;of&nbsp;template&nbsp;<br>
complexity&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;in&nbsp;<br>
Pooma&nbsp;versus&nbsp;Blitz.&nbsp;&nbsp;Maybe&nbsp;things&nbsp;are&nbsp;better&nbsp;under&nbsp;newer&nbsp;versions&nbsp;of&nbsp;<br>
VTune,&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;but&nbsp;<br>
Allan&nbsp;didn't&nbsp;seem&nbsp;too&nbsp;impressed&nbsp;with&nbsp;the&nbsp;newest&nbsp;VTune&nbsp;when&nbsp;I&nbsp;asked&nbsp;<br>
him&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;about&nbsp;<br>
it.&nbsp;&nbsp;In&nbsp;any&nbsp;case,&nbsp;I&nbsp;sort&nbsp;of&nbsp;thought&nbsp;that&nbsp;VTune&nbsp;was&nbsp;not&nbsp;an&nbsp;important&nbsp;<br>
target&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;for&nbsp;<br>
Pooma&nbsp;and&nbsp;its&nbsp;customers,&nbsp;so&nbsp;I&nbsp;haven't&nbsp;pursued&nbsp;it&nbsp;further.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;Julian&nbsp;<br>
C.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=770114217-06082001&gt;&lt;/SPAN&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;BLOCKQUOTE&nbsp;dir=ltr&nbsp;<br>
style=&quot;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#0000ff&nbsp;2px&nbsp;solid;&nbsp;MARGIN-RIGHT:&nbsp;0px&quot;&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;class=OutlookMessageHeader&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=Tahoma&nbsp;<br>
&nbsp;&nbsp;size=2&gt;-----Original&nbsp;Message-----&lt;BR&gt;&lt;B&gt;From:&lt;/B&gt;&nbsp;James&nbsp;Crotinger&nbsp;<br>
&nbsp;&nbsp;[mailto:JimC@proximation.com]&lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt;&nbsp;Sunday,&nbsp;August&nbsp;05,&nbsp;2001&nbsp;8:37&nbsp;<br>
&nbsp;&nbsp;PM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt;&nbsp;'pooma-dev@pooma.codesourcery.com'&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt;&nbsp;<br>
&nbsp;&nbsp;[pooma-dev]&nbsp;timers&nbsp;and&nbsp;performance&nbsp;measurement&nbsp;under&nbsp;<br>
Linux&lt;BR&gt;&lt;BR&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;size=2&gt;How&nbsp;important&nbsp;is&nbsp;it&nbsp;that&nbsp;the&nbsp;timer&nbsp;used&nbsp;by&nbsp;the&nbsp;benchmark&nbsp;class&nbsp;<br>
&nbsp;&nbsp;measure&nbsp;CPU&nbsp;time?&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;how&nbsp;we've&nbsp;even&nbsp;been&nbsp;using&nbsp;this&nbsp;class&nbsp;for&nbsp;<br>
&nbsp;&nbsp;parallel&nbsp;codes&nbsp;-&nbsp;in&nbsp;fact,&nbsp;I&nbsp;was&nbsp;thinking&nbsp;that&nbsp;back&nbsp;when&nbsp;we&nbsp;were&nbsp;just&nbsp;testing&nbsp;<br>
&nbsp;&nbsp;with&nbsp;threads,&nbsp;we&nbsp;were&nbsp;measuring&nbsp;wall-clock&nbsp;time.&nbsp;But&nbsp;the&nbsp;default&nbsp;<br>
&nbsp;&nbsp;implementation&nbsp;of&nbsp;Utilities/Clock.h&nbsp;uses&nbsp;the&nbsp;&quot;clock()&quot;&nbsp;call,&nbsp;which&nbsp;is&nbsp;supposed&nbsp;<br>
&nbsp;&nbsp;to&nbsp;measure&nbsp;&quot;elapsed&nbsp;processor&nbsp;time&quot;,&nbsp;though&nbsp;I'm&nbsp;not&nbsp;completely&nbsp;sure&nbsp;what&nbsp;that&nbsp;<br>
&nbsp;&nbsp;means&nbsp;for&nbsp;a&nbsp;multithreaded&nbsp;program&nbsp;on&nbsp;a&nbsp;multi-processor.&nbsp;On&nbsp;the&nbsp;SGI&nbsp;we&nbsp;were&nbsp;<br>
&nbsp;&nbsp;using&nbsp;the&nbsp;high-performance&nbsp;timers,&nbsp;which&nbsp;I&nbsp;believe&nbsp;access&nbsp;the&nbsp;CPUs&nbsp;hardware&nbsp;<br>
&nbsp;&nbsp;performance&nbsp;registers,&nbsp;so&nbsp;I&nbsp;would&nbsp;think&nbsp;that&nbsp;that&nbsp;was&nbsp;CPU&nbsp;time&nbsp;as&nbsp;well.&nbsp;<br>
&nbsp;&nbsp;Anyway,&nbsp;the&nbsp;problem&nbsp;is&nbsp;that&nbsp;clock()&nbsp;only&nbsp;has&nbsp;10&nbsp;ms&nbsp;granularity&nbsp;under&nbsp;Linux&nbsp;and&nbsp;<br>
&nbsp;&nbsp;that's&nbsp;really&nbsp;crappy&nbsp;if&nbsp;you're&nbsp;trying&nbsp;to&nbsp;measure&nbsp;scaling&nbsp;with&nbsp;problem&nbsp;size.&nbsp;<br>
&nbsp;&nbsp;I've&nbsp;written&nbsp;a&nbsp;version&nbsp;that&nbsp;uses&nbsp;gettimeofday,&nbsp;which&nbsp;has&nbsp;a&nbsp;granularity&nbsp;of&nbsp;<br>
&nbsp;&nbsp;something&nbsp;like&nbsp;15&nbsp;microseconds&nbsp;under&nbsp;Linux&nbsp;(may&nbsp;depend&nbsp;on&nbsp;processor&nbsp;speed?),&nbsp;<br>
&nbsp;&nbsp;but&nbsp;this&nbsp;is&nbsp;definitely&nbsp;not&nbsp;a&nbsp;measure&nbsp;of&nbsp;CPU&nbsp;time.&nbsp;For&nbsp;serial&nbsp;programs&nbsp;this&nbsp;<br>
&nbsp;&nbsp;just&nbsp;means&nbsp;that&nbsp;you&nbsp;need&nbsp;to&nbsp;test&nbsp;on&nbsp;an&nbsp;unloaded&nbsp;machine&nbsp;to&nbsp;have&nbsp;the&nbsp;results&nbsp;<br>
&nbsp;&nbsp;make&nbsp;sense.&nbsp;For&nbsp;parallel&nbsp;programs,&nbsp;this&nbsp;means&nbsp;that&nbsp;you&nbsp;need&nbsp;to&nbsp;interpret&nbsp;the&nbsp;<br>
&nbsp;&nbsp;results&nbsp;differently.&nbsp;Anyway,&nbsp;I'm&nbsp;using&nbsp;this&nbsp;and&nbsp;it&nbsp;seems&nbsp;generally&nbsp;useful,&nbsp;so&nbsp;<br>
&nbsp;&nbsp;I'd&nbsp;like&nbsp;to&nbsp;check&nbsp;it&nbsp;in,&nbsp;but&nbsp;was&nbsp;wondering&nbsp;if&nbsp;the&nbsp;clock-time&nbsp;versus&nbsp;CPU-time&nbsp;<br>
&nbsp;&nbsp;measurement&nbsp;was&nbsp;a&nbsp;problem&nbsp;for&nbsp;anyone.&nbsp;I&nbsp;suppose&nbsp;we&nbsp;could&nbsp;put&nbsp;an&nbsp;accessor&nbsp;on&nbsp;<br>
&nbsp;&nbsp;Clock&nbsp;that&nbsp;would&nbsp;allow&nbsp;the&nbsp;user&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;type&nbsp;of&nbsp;time&nbsp;was&nbsp;being&nbsp;<br>
&nbsp;&nbsp;presented,&nbsp;and&nbsp;Benchmark&nbsp;could&nbsp;examine&nbsp;this&nbsp;and&nbsp;calculate&nbsp;appropriately,&nbsp;if&nbsp;<br>
&nbsp;&nbsp;necessary.&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;size=2&gt;As&nbsp;a&nbsp;side&nbsp;comment,&nbsp;I'm&nbsp;using&nbsp;KCC&nbsp;on&nbsp;one&nbsp;of&nbsp;our&nbsp;1&nbsp;GHz&nbsp;PIII&nbsp;<br>
&nbsp;&nbsp;Linux&nbsp;boxes.&nbsp;ABCTest&nbsp;(which&nbsp;is&nbsp;doing&nbsp;a&nbsp;simple&nbsp;non-stencil&nbsp;calculation,&nbsp;so&nbsp;this&nbsp;<br>
&nbsp;&nbsp;is&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;gets)&nbsp;is&nbsp;only&nbsp;getting&nbsp;45&nbsp;MFlops&nbsp;for&nbsp;the&nbsp;C&nbsp;version,&nbsp;which&nbsp;is&nbsp;<br>
&nbsp;&nbsp;the&nbsp;fastest.&nbsp;This&nbsp;seems&nbsp;pretty&nbsp;pathetic.&nbsp;What&nbsp;have&nbsp;other&nbsp;Linux&nbsp;users&nbsp;seen&nbsp;on&nbsp;<br>
&nbsp;&nbsp;what&nbsp;types&nbsp;of&nbsp;boxes?&nbsp;Also,&nbsp;what&nbsp;is&nbsp;available&nbsp;on&nbsp;Linux&nbsp;for&nbsp;profiling?&nbsp;Is&nbsp;<br>
&nbsp;&nbsp;prof/gprof&nbsp;it?&nbsp;Does&nbsp;KAI&nbsp;sell&nbsp;anything&nbsp;commercial?&nbsp;Does&nbsp;the&nbsp;PIII&nbsp;have&nbsp;any&nbsp;<br>
&nbsp;&nbsp;hardware&nbsp;performance&nbsp;monitoring&nbsp;and&nbsp;is&nbsp;there&nbsp;access&nbsp;to&nbsp;it?&nbsp;Does&nbsp;VTune&nbsp;(under&nbsp;<br>
&nbsp;&nbsp;Windows)&nbsp;inline&nbsp;sufficiently&nbsp;well&nbsp;to&nbsp;do&nbsp;performance&nbsp;testing&nbsp;there&nbsp;(allegedly&nbsp;<br>
&nbsp;&nbsp;good&nbsp;profiling&nbsp;tools,&nbsp;so&nbsp;it&nbsp;might&nbsp;be&nbsp;OK&nbsp;for&nbsp;the&nbsp;serial&nbsp;stuff,&nbsp;but&nbsp;I&nbsp;don't&nbsp;know&nbsp;<br>
&nbsp;&nbsp;if&nbsp;it&nbsp;is&nbsp;capable&nbsp;of&nbsp;&quot;inlining&nbsp;everything&quot;).&nbsp;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&nbsp;Jim&lt;/FONT&gt;&nbsp;&lt;/P&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
