<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;5.5.2650.12&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[pooma-dev]&nbsp;reference&nbsp;loop&nbsp;with&nbsp;updaters&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;I&nbsp;thought&nbsp;I'd&nbsp;mentioned&nbsp;this&nbsp;issue&nbsp;already&nbsp;in&nbsp;a&nbsp;previous&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;email.&nbsp;&nbsp;Anyway,&nbsp;the&nbsp;solution&nbsp;to&nbsp;this&nbsp;issue&nbsp;in&nbsp;the&nbsp;old&nbsp;field&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;code&nbsp;was&nbsp;to&nbsp;not&nbsp;copy&nbsp;the&nbsp;updaters&nbsp;when&nbsp;the&nbsp;boundary&nbsp;condition&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;copies&nbsp;the&nbsp;subject&nbsp;field.&nbsp;&nbsp;(FieldBCondBase&nbsp;uses&nbsp;the&nbsp;tag&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;DontCopyBoundaryConditions&nbsp;when&nbsp;initializing&nbsp;the&nbsp;subject&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;member.)&nbsp;&nbsp;This&nbsp;solution&nbsp;would&nbsp;cause&nbsp;problems&nbsp;for&nbsp;Blanca,&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;because&nbsp;they&nbsp;use&nbsp;updaters&nbsp;for&nbsp;relationships&nbsp;and&nbsp;the&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;relationships&nbsp;are&nbsp;supposed&nbsp;to&nbsp;trigger&nbsp;the&nbsp;updaters&nbsp;of&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;their&nbsp;subjects&nbsp;to&nbsp;make&nbsp;sure&nbsp;all&nbsp;the&nbsp;necessary&nbsp;relationships&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;are&nbsp;fired.&nbsp;&nbsp;I&nbsp;believe&nbsp;that&nbsp;Scott&nbsp;is&nbsp;working&nbsp;on&nbsp;incorporating&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;the&nbsp;Blanca&nbsp;relationship&nbsp;code&nbsp;into&nbsp;the&nbsp;r2&nbsp;updaters,&nbsp;and&nbsp;will&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;probably&nbsp;have&nbsp;to&nbsp;address&nbsp;this&nbsp;issue&nbsp;at&nbsp;some&nbsp;point.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;A&nbsp;complete&nbsp;solution&nbsp;would&nbsp;have&nbsp;to&nbsp;examine&nbsp;the&nbsp;Blanca&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;relationship&nbsp;code.&nbsp;&nbsp;Supporting&nbsp;weak&nbsp;references&nbsp;for&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;the&nbsp;ref-counted&nbsp;block&nbsp;pointer&nbsp;from&nbsp;a&nbsp;field&nbsp;to&nbsp;its&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;updaters&nbsp;for&nbsp;those&nbsp;fields&nbsp;inside&nbsp;other&nbsp;updaters&nbsp;would&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;probably&nbsp;work.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;This&nbsp;problem&nbsp;is&nbsp;serious&nbsp;and&nbsp;on&nbsp;the&nbsp;list&nbsp;of&nbsp;issues&nbsp;to&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;be&nbsp;addressed.&nbsp;&nbsp;You&nbsp;can&nbsp;always&nbsp;configure&nbsp;with&nbsp;--no-pool,&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;to&nbsp;test&nbsp;codes&nbsp;with&nbsp;the&nbsp;new&nbsp;field&nbsp;for&nbsp;now.&nbsp;&nbsp;(Purify&nbsp;will&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;still&nbsp;complain&nbsp;about&nbsp;the&nbsp;pile&nbsp;of&nbsp;fields&nbsp;that&nbsp;aren't&nbsp;deleted,&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;though.)&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&nbsp;&nbsp;&nbsp;&nbsp;Stephen&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;-----Original&nbsp;Message-----&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;From:&nbsp;Julian&nbsp;Cummings&nbsp;[&lt;A&nbsp;HREF=&quot;mailto:cummings@cacr.caltech.edu&quot;&gt;mailto:cummings@cacr.caltech.edu&lt;/A&gt;]&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Sent:&nbsp;Tuesday,&nbsp;April&nbsp;10,&nbsp;2001&nbsp;5:38&nbsp;PM&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;To:&nbsp;pooma-dev@pooma.codesourcery.com&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Subject:&nbsp;[pooma-dev]&nbsp;reference&nbsp;loop&nbsp;with&nbsp;updaters&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Hi&nbsp;All,&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;I&nbsp;got&nbsp;a&nbsp;little&nbsp;sidetracked&nbsp;today&nbsp;when&nbsp;I&nbsp;noticed&nbsp;that&nbsp;a&nbsp;few&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;of&nbsp;the&nbsp;NewField&nbsp;test&nbsp;codes&nbsp;(BasicTest1&nbsp;and&nbsp;FieldTour1)&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;dump&nbsp;core&nbsp;at&nbsp;the&nbsp;end,&nbsp;during&nbsp;object&nbsp;cleanup.&nbsp;&nbsp;This&nbsp;happens&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;because&nbsp;the&nbsp;Pool&nbsp;class&nbsp;detects&nbsp;that&nbsp;not&nbsp;all&nbsp;the&nbsp;pooled&nbsp;memory&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;has&nbsp;been&nbsp;freed.&nbsp;&nbsp;After&nbsp;a&nbsp;fair&nbsp;bit&nbsp;of&nbsp;detective&nbsp;work,&nbsp;I&nbsp;have&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;determined&nbsp;that&nbsp;this&nbsp;is&nbsp;due&nbsp;to&nbsp;a&nbsp;reference-counting&nbsp;loop&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;between&nbsp;Fields&nbsp;and&nbsp;Updaters.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;When&nbsp;you&nbsp;add&nbsp;an&nbsp;Updater&nbsp;to&nbsp;a&nbsp;Field,&nbsp;the&nbsp;Updater&nbsp;stores&nbsp;a&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;copy&nbsp;of&nbsp;the&nbsp;Field&nbsp;in&nbsp;UpdaterRetargetBase.&nbsp;&nbsp;The&nbsp;Updater&nbsp;is&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;added&nbsp;to&nbsp;an&nbsp;UpdaterList&nbsp;stored&nbsp;in&nbsp;the&nbsp;FieldEngineBase&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;base&nbsp;class&nbsp;of&nbsp;the&nbsp;FieldEngine&nbsp;inside&nbsp;the&nbsp;Field.&nbsp;&nbsp;Thus,&nbsp;there&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;is&nbsp;a&nbsp;circular&nbsp;loop&nbsp;in&nbsp;the&nbsp;reference&nbsp;counting.&nbsp;&nbsp;When&nbsp;the&nbsp;Field&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;is&nbsp;destroyed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;program,&nbsp;it&nbsp;calls&nbsp;the&nbsp;destructor&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;for&nbsp;its&nbsp;FieldEngineBase.&nbsp;&nbsp;The&nbsp;FieldEngineBaseData&nbsp;referred&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;to&nbsp;by&nbsp;the&nbsp;FieldEngineBase&nbsp;does&nbsp;not&nbsp;get&nbsp;destroyed,&nbsp;however,&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;because&nbsp;there&nbsp;are&nbsp;outstanding&nbsp;references&nbsp;to&nbsp;it&nbsp;which&nbsp;correspond&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;to&nbsp;the&nbsp;copies&nbsp;of&nbsp;the&nbsp;Field&nbsp;in&nbsp;each&nbsp;Updater.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;I&nbsp;think&nbsp;this&nbsp;is&nbsp;a&nbsp;fairly&nbsp;significant&nbsp;problem&nbsp;that&nbsp;should&nbsp;be&nbsp;fixed.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;I'm&nbsp;not&nbsp;sure&nbsp;what&nbsp;the&nbsp;proper&nbsp;solution&nbsp;is&nbsp;though.&nbsp;&nbsp;Calling&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;removeUpdaters()&nbsp;in&nbsp;the&nbsp;Field&nbsp;destructor&nbsp;causes&nbsp;an&nbsp;infinite&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;recursion.&nbsp;&nbsp;Perhaps&nbsp;this&nbsp;recursion&nbsp;could&nbsp;be&nbsp;broken&nbsp;by&nbsp;making&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;the&nbsp;FieldEngine&nbsp;the&nbsp;subject&nbsp;of&nbsp;an&nbsp;Updater,&nbsp;rather&nbsp;than&nbsp;the&nbsp;Field.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Would&nbsp;that&nbsp;work?&nbsp;&nbsp;I'm&nbsp;going&nbsp;crazy&nbsp;just&nbsp;thinking&nbsp;about&nbsp;it...&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;--&nbsp;Julian&nbsp;C.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
&lt;BR&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;--&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Dr.&nbsp;Julian&nbsp;C.&nbsp;Cummings&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E-mail:&nbsp;cummings@cacr.caltech.edu&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;California&nbsp;Institute&nbsp;of&nbsp;Technology&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Phone:&nbsp;&nbsp;626-395-2543&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;1200&nbsp;E.&nbsp;California&nbsp;Blvd.,&nbsp;Mail&nbsp;Code&nbsp;158-79&nbsp;&nbsp;&nbsp;Fax:&nbsp;&nbsp;&nbsp;&nbsp;626-584-5917&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;Pasadena,&nbsp;CA&nbsp;91125&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
