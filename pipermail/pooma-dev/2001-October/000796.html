<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Instrumenting src/Evaluator Header Files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20Instrumenting%20src/Evaluator%20Header%20Files&In-Reply-To=%3C20011009160327.B23000%40codesourcery.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000795.html">
   <LINK REL="Next"  HREF="000797.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Instrumenting src/Evaluator Header Files</H1>
    <B>Jeffrey Oldham</B> 
    <A HREF="mailto:pooma-dev%40codesourcery.com?Subject=Re%3A%20Instrumenting%20src/Evaluator%20Header%20Files&In-Reply-To=%3C20011009160327.B23000%40codesourcery.com%3E"
       TITLE="Instrumenting src/Evaluator Header Files">oldham at codesourcery.com
       </A><BR>
    <I>Tue Oct  9 23:03:27 UTC 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="000795.html">Pooma Example Failures
</A></li>
        <LI>Next message: <A HREF="000797.html">Patch: 'the the' is Seldom Correct
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#796">[ date ]</a>
              <a href="thread.html#796">[ thread ]</a>
              <a href="subject.html#796">[ subject ]</a>
              <a href="author.html#796">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Stephen and I tried to get PDToolkit 2.01b and Tau 2.9.22 to work on
Linux/KCC, but we both failed.  Instead, we used Linux/g++ to produce
a patch of instrumentation for interesting header files.  Stephen says
these are all in src/Evaluator.  It's a hack, but it moves work
forward.

Thanks,
Jeffrey D. Oldham
<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">oldham at codesourcery.com</A>
-------------- next part --------------
Index: Evaluator.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/Evaluator.h,v
retrieving revision 1.57
diff -c -p -r1.57 Evaluator.h
*** Evaluator.h	2001/03/29 00:41:21	1.57
--- Evaluator.h	2001/10/09 23:00:34
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
***************
*** 72,79 ****
  
  template &lt;class EvalTag&gt;
  struct Evaluator
! {
! };
  
  //-----------------------------------------------------------------------------
  // Main Evaluator:
--- 73,79 ----
  
  template &lt;class EvalTag&gt;
  struct Evaluator
! {};
  
  //-----------------------------------------------------------------------------
  // Main Evaluator:
*************** struct Evaluator&lt;MainEvaluatorTag&gt;
*** 88,98 ****
  {
    // Default ctor.
  
!   Evaluator() { }
  
    // Destructor
  
!   ~Evaluator() { }
  
    // evaluate(expression)
    // Input an expression and cause it to be evaluated.
--- 88,102 ----
  {
    // Default ctor.
  
!   Evaluator() {
!   TAU_PROFILE(&quot;Evaluator&lt;MainEvaluatorTag&gt; &amp;Evaluator&lt;MainEvaluatorTag&gt;::Evaluator()&quot;, CT(*this), TAU_USER);
!  }
  
    // Destructor
  
!   ~Evaluator() {
!   TAU_PROFILE(&quot;void Evaluator&lt;MainEvaluatorTag&gt;::~Evaluator()&quot;, CT(*this), TAU_USER);
!  }
  
    // evaluate(expression)
    // Input an expression and cause it to be evaluated.
*************** struct Evaluator&lt;MainEvaluatorTag&gt;
*** 101,106 ****
--- 105,112 ----
    template &lt;class LHS, class RHS, class Op&gt;
    void evaluate(const LHS&amp; lhs, const Op&amp; op, const RHS&amp; rhs) const
    {
+   TAU_PROFILE(&quot;void Evaluator&lt;MainEvaluatorTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename EvaluatorTag&lt;LHS, RHS&gt;::Evaluator_t Eval_t;
      Evaluator&lt;Eval_t&gt; evaluator;
  
*************** struct Evaluator&lt;MainEvaluatorTag&gt;
*** 121,126 ****
--- 127,134 ----
    template &lt;class LHS, class RHS, class Op&gt;
    void evaluateZeroBased(const LHS&amp; lhs, const Op&amp; op, const RHS&amp; rhs) const
    {
+   TAU_PROFILE(&quot;void Evaluator&lt;MainEvaluatorTag&gt;::evaluateZeroBased(const LHS &amp;, const Op &amp;, const RHS &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename EvaluatorTag&lt;LHS, RHS&gt;::Evaluator_t Eval_t;
      Evaluator&lt;Eval_t&gt; evaluator;
  
*************** struct Evaluator&lt;SinglePatchEvaluatorTag
*** 146,156 ****
  {
    // Default ctor.
  
!   Evaluator() { }
  
    // Destructor
  
!   ~Evaluator() { }
  
    // evaluate(expression)
    // Input an expression and cause it to be evaluated.
--- 154,168 ----
  {
    // Default ctor.
  
!   Evaluator() {
!   TAU_PROFILE(&quot;Evaluator&lt;SinglePatchEvaluatorTag&gt; &amp;Evaluator&lt;SinglePatchEvaluatorTag&gt;::Evaluator()&quot;, CT(*this), TAU_USER);
!  }
  
    // Destructor
  
!   ~Evaluator() {
!   TAU_PROFILE(&quot;void Evaluator&lt;SinglePatchEvaluatorTag&gt;::~Evaluator()&quot;, CT(*this), TAU_USER);
!  }
  
    // evaluate(expression)
    // Input an expression and cause it to be evaluated.
*************** struct Evaluator&lt;SinglePatchEvaluatorTag
*** 159,164 ****
--- 171,178 ----
    template &lt;class LHS, class RHS, class Op&gt;
    void evaluate(const LHS&amp; lhs, const Op&amp; op, const RHS&amp; rhs) const
    {
+   TAU_PROFILE(&quot;void Evaluator&lt;SinglePatchEvaluatorTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename KernelTag&lt;LHS,RHS&gt;::Kernel_t Kernel_t;
  #if POOMA_REORDER_ITERATES
      Pooma::Iterate_t *iterate = generateKernel(lhs, op, rhs, Kernel_t());
*************** struct Evaluator&lt;MultiPatchEvaluatorTag&gt;
*** 182,192 ****
  {
    // Default ctor.
  
!   Evaluator() { }
  
    // Destructor
  
!   ~Evaluator() { }
  
    // evaluate(expression)
    // Input an expression and cause it to be evaluated.
--- 196,210 ----
  {
    // Default ctor.
  
!   Evaluator() {
!   TAU_PROFILE(&quot;Evaluator&lt;MultiPatchEvaluatorTag&gt; &amp;Evaluator&lt;MultiPatchEvaluatorTag&gt;::Evaluator()&quot;, CT(*this), TAU_USER);
!  }
  
    // Destructor
  
!   ~Evaluator() {
!   TAU_PROFILE(&quot;void Evaluator&lt;MultiPatchEvaluatorTag&gt;::~Evaluator()&quot;, CT(*this), TAU_USER);
!  }
  
    // evaluate(expression)
    // Input an expression and cause it to be evaluated.
*************** struct Evaluator&lt;MultiPatchEvaluatorTag&gt;
*** 195,200 ****
--- 213,220 ----
    template &lt;class LHS, class RHS, class Op&gt;
    void evaluate(const LHS&amp; lhs, const Op&amp; op, const RHS&amp; rhs) const
    {
+   TAU_PROFILE(&quot;void Evaluator&lt;MultiPatchEvaluatorTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef Intersector&lt;LHS::dimensions&gt; Inter_t;
      Inter_t inter;
  
Index: InlineEvaluator.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/InlineEvaluator.h,v
retrieving revision 1.26
diff -c -p -r1.26 InlineEvaluator.h
*** InlineEvaluator.h	2001/04/13 02:15:06	1.26
--- InlineEvaluator.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 97,102 ****
--- 98,105 ----
    template&lt;class LHS,class Op,class RHS&gt;
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;)&quot;, &quot; &quot;, TAU_USER);
+ 
      typedef typename LHS::Domain_t Domain_t;
      evaluate(lhs,op,rhs,lhs.domain(),
  	     WrappedInt&lt;Domain_t::dimensions&gt;());
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 115,120 ****
--- 118,125 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;)&quot;, &quot; &quot;, TAU_USER);
+ 
      evaluate(lhs,op,rhs,domain,
  	     WrappedInt&lt;Domain::dimensions&gt;());
      POOMA_INCREMENT_STATISTIC(NumInlineEvaluations)
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 155,160 ****
--- 160,167 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain,WrappedInt&lt;1&gt;)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;, WrappedInt&lt;1&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      PAssert(domain[0].first() == 0);
      int e0 = domain[0].length();
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 166,171 ****
--- 173,180 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain,WrappedInt&lt;2&gt;)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;, WrappedInt&lt;2&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      PAssert(domain[0].first() == 0);
      PAssert(domain[1].first() == 0);
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 180,185 ****
--- 189,196 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain,WrappedInt&lt;3&gt;)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;, WrappedInt&lt;3&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      PAssert(domain[0].first() == 0);
      PAssert(domain[1].first() == 0);
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 197,202 ****
--- 208,215 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain,WrappedInt&lt;4&gt;)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;, WrappedInt&lt;4&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      PAssert(domain[0].first() == 0);
      PAssert(domain[1].first() == 0);
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 217,222 ****
--- 230,237 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain,WrappedInt&lt;5&gt;)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;, WrappedInt&lt;5&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      PAssert(domain[0].first() == 0);
      PAssert(domain[1].first() == 0);
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 240,245 ****
--- 255,262 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain,WrappedInt&lt;6&gt;)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;, WrappedInt&lt;6&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      PAssert(domain[0].first() == 0);
      PAssert(domain[1].first() == 0);
*************** struct KernelEvaluator&lt;InlineKernelTag&gt;
*** 267,272 ****
--- 284,291 ----
    inline static void evaluate(const LHS&amp; lhs,const Op&amp; op,const RHS&amp; rhs,
  			      const Domain&amp; domain,WrappedInt&lt;7&gt;)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;InlineKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;, const Domain &amp;, WrappedInt&lt;7&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      PAssert(domain[0].first() == 0);
      PAssert(domain[1].first() == 0);
Index: CompressibleEval.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/CompressibleEval.h,v
retrieving revision 1.25
diff -c -p -r1.25 CompressibleEval.h
*** CompressibleEval.h	2000/05/31 02:40:03	1.25
--- CompressibleEval.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
*************** struct KernelEvaluator&lt;CompressibleViewK
*** 81,86 ****
--- 82,89 ----
    template&lt;class LHS, class Op, class RHS&gt;
    static void evaluate(const LHS &amp;lhs, const Op &amp;op, const RHS &amp;rhs)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;CompressibleViewKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;)&quot;, &quot; &quot;, TAU_USER);
+ 
      // Try this for now.  We just pass the uncompressed engine
      // to the inline evaluator.  If you want to pack this in an
      // array go ahead, but then you'll have to include Array.h.
*************** struct KernelEvaluator&lt;CompressibleKerne
*** 98,103 ****
--- 101,108 ----
    template&lt;class LHS, class Op, class RHS&gt;
    static void evaluate(const LHS &amp;lhs, const Op &amp;op, const RHS &amp;rhs)
    {
+   TAU_PROFILE(&quot;void KernelEvaluator&lt;CompressibleKernelTag&gt;::evaluate(const LHS &amp;, const Op &amp;, const RHS &amp;)&quot;, &quot; &quot;, TAU_USER);
+ 
      // If everybody is compressed, then we do a compressed assign,
      // provided the left-hand-side is viewing the entire compressed
      // block or the value being assigned is the same as the compressed
Index: ExpressionKernel.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/ExpressionKernel.h,v
retrieving revision 1.45
diff -c -p -r1.45 ExpressionKernel.h
*** ExpressionKernel.h	2001/03/28 19:14:51	1.45
--- ExpressionKernel.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
***************
*** 83,88 ****
--- 84,91 ----
  template&lt;class LHS,class Op,class RHS,class EvalTag&gt;
  class ExpressionKernel : public Pooma::Iterate_t
  {
+   TAU_PROFILE(&quot;ExpressionKernel&lt;LHS, Op, RHS, EvalTag&gt;::ExpressionKernel&quot;, CT(*this), TAU_USER);
+ 
  public:
  
    typedef ExpressionKernel&lt;LHS,Op,RHS,EvalTag&gt; This_t;
*************** ExpressionKernel(const LHS&amp; lhs,const Op
*** 131,136 ****
--- 134,141 ----
    : Pooma::Iterate_t(Pooma::scheduler()),
      lhs_m(lhs), op_m(op), rhs_m(rhs)
  {
+   TAU_PROFILE(&quot;ExpressionKernel&lt;LHS, Op, RHS, EvalTag&gt;::ExpressionKernel&quot;, CT(*this), TAU_USER);
+ 
    hintAffinity(engineFunctor(lhs, DataObjectRequest&lt;BlockAffinity&gt;()));
  
    // Request locks
*************** ExpressionKernel(const LHS&amp; lhs,const Op
*** 161,166 ****
--- 166,173 ----
  template&lt;class LHS,class Op,class RHS,class EvalTag&gt;
  ExpressionKernel&lt;LHS,Op,RHS,EvalTag&gt;::~ExpressionKernel()
  {
+   TAU_PROFILE(&quot;ExpressionKernel&lt;LHS, Op, RHS, EvalTag&gt;::~ExpressionKernel&quot;, CT(*this), TAU_USER);
+ 
    // The write request remembers the data block it sees on the left
    // so that it can check and see if it finds it on the right.
  
*************** template&lt;class LHS,class Op,class RHS,cl
*** 184,189 ****
--- 191,198 ----
  void
  ExpressionKernel&lt;LHS,Op,RHS,EvalTag&gt;::run()
  {
+   TAU_PROFILE(&quot;ExpressionKernel&lt;LHS, Op, RHS, EvalTag&gt;::run&quot;, CT(*this), TAU_USER);
+ 
    // Just evaluate the expression.
    KernelEvaluator&lt;EvalTag&gt;::evaluate(lhs_m,op_m,rhs_m);
  
*************** inline static
*** 195,200 ****
--- 204,211 ----
  ExpressionKernel&lt;LHS,Op,RHS,EvalTag&gt;*
  generateKernel(const LHS&amp; lhs, const Op&amp; op, const RHS&amp; rhs, const EvalTag&amp;)
  {
+   TAU_PROFILE(&quot;ExpressionKernel&lt;LHS, Op, RHS, EvalTag&gt; *generateKernel(const LHS &amp;, const Op &amp;, const RHS &amp;, const EvalTag &amp;)&quot;, &quot; &quot;, TAU_USER);
+ 
    return new ExpressionKernel&lt;LHS,Op,RHS,EvalTag&gt;(lhs, op, rhs);
  }
  
Index: LoopApply.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/LoopApply.h,v
retrieving revision 1.4
diff -c -p -r1.4 LoopApply.h
*** LoopApply.h	2001/04/13 02:15:06	1.4
--- LoopApply.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
*************** struct LoopApplyEvaluator
*** 91,102 ****
--- 92,107 ----
    template&lt;class Op, class Dom&gt;
    inline static void evaluate(Op &amp;op, const Dom &amp;domain)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Dom &amp;)&quot;, &quot; &quot;, TAU_USER);
+ 
      evaluate(op, domain, WrappedInt&lt;Dom::dimensions&gt;());
    }
  
    template&lt;class Op, class Domain&gt;
    inline static void evaluate(Op &amp;op, const Domain &amp;domain, WrappedInt&lt;1&gt;)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Domain &amp;, WrappedInt&lt;1&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      int f0 = domain[0].first();
      int e0 = domain[0].last();
*************** struct LoopApplyEvaluator
*** 107,112 ****
--- 112,119 ----
    template&lt;class Op, class Domain&gt;
    inline static void evaluate(Op &amp;op, const Domain &amp;domain, WrappedInt&lt;2&gt;)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Domain &amp;, WrappedInt&lt;2&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      int f0 = domain[0].first();
      int f1 = domain[1].first();
*************** struct LoopApplyEvaluator
*** 120,125 ****
--- 127,134 ----
    template&lt;class Op, class Domain&gt;
    inline static void evaluate(Op &amp;op, const Domain &amp;domain, WrappedInt&lt;3&gt;)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Domain &amp;, WrappedInt&lt;3&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      int f0 = domain[0].first();
      int f1 = domain[1].first();
*************** struct LoopApplyEvaluator
*** 136,141 ****
--- 145,152 ----
    template&lt;class Op, class Domain&gt;
    inline static void evaluate(Op &amp;op, const Domain &amp;domain, WrappedInt&lt;4&gt;)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Domain &amp;, WrappedInt&lt;4&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      int f0 = domain[0].first();
      int f1 = domain[1].first();
*************** struct LoopApplyEvaluator
*** 155,160 ****
--- 166,173 ----
    template&lt;class Op, class Domain&gt;
    inline static void evaluate(Op &amp;op, const Domain &amp;domain, WrappedInt&lt;5&gt;)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Domain &amp;, WrappedInt&lt;5&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      int f0 = domain[0].first();
      int f1 = domain[1].first();
*************** struct LoopApplyEvaluator
*** 177,182 ****
--- 190,197 ----
    template&lt;class Op, class Domain&gt;
    inline static void evaluate(Op &amp;op, const Domain &amp;domain, WrappedInt&lt;6&gt;)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Domain &amp;, WrappedInt&lt;6&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      int f0 = domain[0].first();
      int f1 = domain[1].first();
*************** struct LoopApplyEvaluator
*** 202,207 ****
--- 217,224 ----
    template&lt;class Op, class Domain&gt;
    inline static void evaluate(Op &amp;op, const Domain &amp;domain, WrappedInt&lt;7&gt;)
    {
+   TAU_PROFILE(&quot;void LoopApplyEvaluator::evaluate(Op &amp;, const Domain &amp;, WrappedInt&lt;7&gt;)&quot;, &quot; &quot;, TAU_USER);
+ 
      CTAssert(Domain::unitStride);
      int f0 = domain[0].first();
      int f1 = domain[1].first();
Index: PatchFunction.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/PatchFunction.h,v
retrieving revision 1.29
diff -c -p -r1.29 PatchFunction.h
*** PatchFunction.h	2000/09/20 16:22:10	1.29
--- PatchFunction.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
*************** struct PatchParticle3 { };
*** 118,125 ****
  
  template&lt;class EvalTag&gt;
  class PatchEvaluator
! {
! };
  
  template&lt;&gt;
  class PatchEvaluator&lt;MainEvaluatorTag&gt;
--- 119,125 ----
  
  template&lt;class EvalTag&gt;
  class PatchEvaluator
! {};
  
  template&lt;&gt;
  class PatchEvaluator&lt;MainEvaluatorTag&gt;
*************** public:
*** 128,142 ****
  
    // Default ctor.
  
!   PatchEvaluator() {}
  
    // Destructor
  
!   ~PatchEvaluator() {}
  
    template&lt;class A1, class Function&gt;
    void evaluate(const A1&amp; a1, const Function&amp; function) const
    {
      typedef typename EvaluatorTag1&lt;A1&gt;::Evaluator_t Evaluator_t;
      PatchEvaluator&lt;Evaluator_t&gt; evaluator;
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
--- 128,148 ----
  
    // Default ctor.
  
!   PatchEvaluator() {
!   TAU_PROFILE(&quot;PatchEvaluator&lt;MainEvaluatorTag&gt; &amp;PatchEvaluator&lt;MainEvaluatorTag&gt;::PatchEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    // Destructor
  
!   ~PatchEvaluator() {
!   TAU_PROFILE(&quot;void PatchEvaluator&lt;MainEvaluatorTag&gt;::~PatchEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    template&lt;class A1, class Function&gt;
    void evaluate(const A1&amp; a1, const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MainEvaluatorTag&gt;::evaluate(const A1 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename EvaluatorTag1&lt;A1&gt;::Evaluator_t Evaluator_t;
      PatchEvaluator&lt;Evaluator_t&gt; evaluator;
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
*************** public:
*** 154,159 ****
--- 160,167 ----
    template&lt;class A1, class Function&gt;
    void evaluateRead(const A1&amp; a1, const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MainEvaluatorTag&gt;::evaluateRead(const A1 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename EvaluatorTag1&lt;A1&gt;::Evaluator_t Evaluator_t;
      PatchEvaluator&lt;Evaluator_t&gt; evaluator;
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
*************** public:
*** 171,176 ****
--- 179,186 ----
    void evaluate2(const A1&amp; a1, const A2&amp; a2,
  		const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MainEvaluatorTag&gt;::evaluate2(const A1 &amp;, const A2 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename EvaluatorTag&lt;A1,A2&gt;::Evaluator_t Eval_t;
      PatchEvaluator&lt;Eval_t&gt; evaluator;
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
*************** public:
*** 189,194 ****
--- 199,206 ----
    void evaluate3(const A1&amp; a1, const A2&amp; a2, const A3 &amp;a3,
  		const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MainEvaluatorTag&gt;::evaluate3(const A1 &amp;, const A2 &amp;, const A3 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename EvaluatorTag1&lt;A2&gt;::Evaluator_t Eval2_t;
      typedef typename EvaluatorTag1&lt;A3&gt;::Evaluator_t Eval3_t;
      typedef typename EvaluatorCombine&lt;Eval2_t,Eval3_t&gt;::Evaluator_t Eval23_t;
*************** public:
*** 224,239 ****
    // The only member data can construct itself, so we
    // don't need to specify anything.
    //
!   PatchEvaluator() {}
  
    //
    // Destructor
    //
!   ~PatchEvaluator() {}
  
    template&lt;class A1, class Function&gt;
    void evaluate(const A1&amp; a1, const Function&amp; function) const
    {
      Pooma::Iterate_t *iterate = new PatchKernel&lt;A1,Function&gt;(a1,function);
      Pooma::scheduler().handOff(iterate);
    }
--- 236,257 ----
    // The only member data can construct itself, so we
    // don't need to specify anything.
    //
!   PatchEvaluator() {
!   TAU_PROFILE(&quot;PatchEvaluator&lt;SinglePatchEvaluatorTag&gt; &amp;PatchEvaluator&lt;SinglePatchEvaluatorTag&gt;::PatchEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    //
    // Destructor
    //
!   ~PatchEvaluator() {
!   TAU_PROFILE(&quot;void PatchEvaluator&lt;SinglePatchEvaluatorTag&gt;::~PatchEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    template&lt;class A1, class Function&gt;
    void evaluate(const A1&amp; a1, const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;SinglePatchEvaluatorTag&gt;::evaluate(const A1 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Iterate_t *iterate = new PatchKernel&lt;A1,Function&gt;(a1,function);
      Pooma::scheduler().handOff(iterate);
    }
*************** public:
*** 241,246 ****
--- 259,266 ----
    template&lt;class A1, class Function&gt;
    void evaluateRead(const A1&amp; a1, const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;SinglePatchEvaluatorTag&gt;::evaluateRead(const A1 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Iterate_t *iterate = new PatchKernel&lt;A1,Function&gt;(a1,function);
      Pooma::scheduler().handOff(iterate);
    }
*************** public:
*** 249,254 ****
--- 269,276 ----
    void evaluate2(const A1 &amp;a1, const A2 &amp;a2,
  		const Function &amp;function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;SinglePatchEvaluatorTag&gt;::evaluate2(const A1 &amp;, const A2 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Iterate_t *iterate =
        new PatchKernel2&lt;A1,A2,Function&gt;(a1,a2,function);
  
*************** public:
*** 259,264 ****
--- 281,288 ----
    void evaluate3(const A1 &amp;a1, const A2 &amp;a2, const A3 &amp;a3,
  		const Function &amp;function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;SinglePatchEvaluatorTag&gt;::evaluate3(const A1 &amp;, const A2 &amp;, const A3 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Iterate_t *iterate =
        new PatchKernel3&lt;A1,A2,A3,Function&gt;(a1,a2,a3,function);
  
*************** public:
*** 283,298 ****
    // The only member data can construct itself, so we
    // don't need to specify anything.
    //
!   PatchEvaluator() {}
  
    //
    // Destructor
    //
!   ~PatchEvaluator() {}
  
    template&lt;class A1,class Function&gt;
    void evaluate(const A1&amp; a1,const Function&amp; function) const
    {
      typedef Intersector&lt;A1::dimensions&gt; Inter_t;
      Inter_t inter;
  
--- 307,328 ----
    // The only member data can construct itself, so we
    // don't need to specify anything.
    //
!   PatchEvaluator() {
!   TAU_PROFILE(&quot;PatchEvaluator&lt;MultiPatchEvaluatorTag&gt; &amp;PatchEvaluator&lt;MultiPatchEvaluatorTag&gt;::PatchEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    //
    // Destructor
    //
!   ~PatchEvaluator() {
!   TAU_PROFILE(&quot;void PatchEvaluator&lt;MultiPatchEvaluatorTag&gt;::~PatchEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    template&lt;class A1,class Function&gt;
    void evaluate(const A1&amp; a1,const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MultiPatchEvaluatorTag&gt;::evaluate(const A1 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef Intersector&lt;A1::dimensions&gt; Inter_t;
      Inter_t inter;
  
*************** public:
*** 310,315 ****
--- 340,347 ----
    inline
    void evaluateRead(const A1&amp; a1,const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MultiPatchEvaluatorTag&gt;::evaluateRead(const A1 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      evaluate(a1,function);
    }
  
*************** public:
*** 317,322 ****
--- 349,356 ----
    void evaluate2(const A1&amp; a1, const A2&amp; a2,
  		const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MultiPatchEvaluatorTag&gt;::evaluate2(const A1 &amp;, const A2 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef Intersector&lt;A1::dimensions&gt; Inter_t;
      Inter_t inter;
      
*************** public:
*** 337,342 ****
--- 371,378 ----
    void evaluate3(const A1 &amp;a1, const A2 &amp;a2, const A3 &amp;a3,
  		 const Function&amp; function) const
    {
+   TAU_PROFILE(&quot;void PatchEvaluator&lt;MultiPatchEvaluatorTag&gt;::evaluate3(const A1 &amp;, const A2 &amp;, const A3 &amp;, const Function &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef Intersector&lt;A1::dimensions&gt; Inter_t;
      Inter_t inter;
      
*************** class ParticleEvaluator
*** 362,377 ****
  public:
    // Default ctor.
  
!   ParticleEvaluator() {}
  
    // Destructor
  
!   ~ParticleEvaluator() {}
  
    template&lt;class A1, class Function, bool Write1&gt;
    void evaluate(const A1 &amp;a1, const Function &amp;function,
  		const PatchParticle1&lt;Write1&gt; &amp;) const
    {
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
      scheduler.beginGeneration();
  
--- 398,419 ----
  public:
    // Default ctor.
  
!   ParticleEvaluator() {
!   TAU_PROFILE(&quot;ParticleEvaluator &amp;ParticleEvaluator::ParticleEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    // Destructor
  
!   ~ParticleEvaluator() {
!   TAU_PROFILE(&quot;void ParticleEvaluator::~ParticleEvaluator()&quot;, CT(*this), TAU_USER);
! }
  
    template&lt;class A1, class Function, bool Write1&gt;
    void evaluate(const A1 &amp;a1, const Function &amp;function,
  		const PatchParticle1&lt;Write1&gt; &amp;) const
    {
+   TAU_PROFILE(&quot;void ParticleEvaluator::evaluate(const A1 &amp;, const Function &amp;, const PatchParticle1&lt;Write1&gt; &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
      scheduler.beginGeneration();
  
*************** public:
*** 402,407 ****
--- 444,451 ----
    void evaluateBlock(const A1 &amp;a1, const Function &amp;function,
  		     const PatchParticle1&lt;Write1&gt; &amp;) const
    {
+   TAU_PROFILE(&quot;void ParticleEvaluator::evaluateBlock(const A1 &amp;, const Function &amp;, const PatchParticle1&lt;Write1&gt; &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
  
      int n = a1.numPatchesLocal();
*************** public:
*** 441,446 ****
--- 485,492 ----
    void evaluate2(const A1&amp; a1, const A2 &amp;a2, const Function&amp; function,
  		 const PatchParticle2&lt;Write1, Write2&gt; &amp;) const
    {
+   TAU_PROFILE(&quot;void ParticleEvaluator::evaluate2(const A1 &amp;, const A2 &amp;, const Function &amp;, const PatchParticle2&lt;Write1, Write2&gt; &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
      scheduler.beginGeneration();
  
*************** public:
*** 476,481 ****
--- 522,529 ----
    void evaluate2Block(const A1&amp; a1, const A2 &amp;a2, const Function&amp; function,
  		 const PatchParticle2&lt;Write1, Write2&gt; &amp;) const
    {
+   TAU_PROFILE(&quot;void ParticleEvaluator::evaluate2Block(const A1 &amp;, const A2 &amp;, const Function &amp;, const PatchParticle2&lt;Write1, Write2&gt; &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
      scheduler.beginGeneration();
  
*************** public:
*** 520,525 ****
--- 568,575 ----
  		 const Function&amp; function,
  		 const PatchParticle3&lt;Write1, Write2, Write3&gt; &amp;) const
    {
+   TAU_PROFILE(&quot;void ParticleEvaluator::evaluate3(const A1 &amp;, const A2 &amp;, const A3 &amp;, const Function &amp;, const PatchParticle3&lt;Write1, Write2, Write3&gt; &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
      scheduler.beginGeneration();
  
*************** public:
*** 561,566 ****
--- 611,618 ----
  		 const Function&amp; function,
  		 const PatchParticle3&lt;Write1, Write2, Write3&gt; &amp;) const
    {
+   TAU_PROFILE(&quot;void ParticleEvaluator::evaluate3Block(const A1 &amp;, const A2 &amp;, const A3 &amp;, const Function &amp;, const PatchParticle3&lt;Write1, Write2, Write3&gt; &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::Scheduler_t &amp;scheduler = Pooma::scheduler();
      scheduler.beginGeneration();
  
*************** CLASS(const I1 &amp;i1, const I2 &amp;i2, const 
*** 653,668 ****
  
  template&lt;class Function, class Patch&gt;
  class PatchFunction
! {
! };
  
  template&lt;class Function&gt;
  class PatchFunction&lt;Function,PatchTag1&gt;
  {
  public:
  
!   PatchFunction() { }
!   PatchFunction(const Function &amp;function) : function_m(function) { }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
--- 705,723 ----
  
  template&lt;class Function, class Patch&gt;
  class PatchFunction
! {};
  
  template&lt;class Function&gt;
  class PatchFunction&lt;Function,PatchTag1&gt;
  {
  public:
  
!   PatchFunction() {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag1&gt; &amp;PatchFunction&lt;Function, PatchTag1&gt;::PatchFunction()&quot;, CT(*this), TAU_USER);
!  }
!   PatchFunction(const Function &amp;function) : function_m(function) {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag1&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
!  }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
*************** public:
*** 670,679 ****
    inline void
    operator()(const Array&amp; a) const
    {
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluate(a,function());
    }
  
!   inline const Function &amp;function() const { return function_m; }
  
  private:
  
--- 725,738 ----
    inline void
    operator()(const Array&amp; a) const
    {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag1&gt;::PatchFunction&quot;, &quot; &quot;, TAU_USER);
+ 
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluate(a,function());
    }
  
!   inline const Function &amp;function() const {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag1&gt;::function&quot;, CT(*this), TAU_USER);
!  return function_m; }
  
  private:
  
*************** private:
*** 683,692 ****
  template&lt;class Function&gt;
  class PatchFunction&lt;Function,PatchReadTag1&gt;
  {
  public:
  
!   PatchFunction() { }
!   PatchFunction(const Function &amp;function) : function_m(function) { }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
--- 742,757 ----
  template&lt;class Function&gt;
  class PatchFunction&lt;Function,PatchReadTag1&gt;
  {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchReadTag1&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
+ 
  public:
  
!   PatchFunction() {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchReadTag1&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
!  }
!   PatchFunction(const Function &amp;function) : function_m(function) {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchReadTag1&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
!  }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
*************** public:
*** 694,703 ****
    inline void
    operator()(const Array&amp; a) const
    {
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluateRead(a,function());
    }
  
!   inline const Function &amp;function() const { return function_m; }
  
  private:
  
--- 759,772 ----
    inline void
    operator()(const Array&amp; a) const
    {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchReadTag1&gt;::PatchFunction&quot;, &quot; &quot;, TAU_USER);
+ 
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluateRead(a,function());
    }
  
!   inline const Function &amp;function() const {
!   TAU_PROFILE(&quot;const Function &amp;PatchFunction&lt;Function, PatchReadTag1&gt;::function() const&quot;, CT(*this), TAU_USER);
!  return function_m; }
  
  private:
  
*************** template&lt;class Function&gt;
*** 708,715 ****
  class PatchFunction&lt;Function,PatchTag2&gt;
  {
  public:
!   PatchFunction() { }
!   PatchFunction(const Function &amp;function) : function_m(function) { }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
--- 777,788 ----
  class PatchFunction&lt;Function,PatchTag2&gt;
  {
  public:
!   PatchFunction() {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag2&gt; &amp;PatchFunction&lt;Function, PatchTag2&gt;::PatchFunction()&quot;, CT(*this), TAU_USER);
!  }
!   PatchFunction(const Function &amp;function) : function_m(function) {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag2&gt; &amp;PatchFunction&lt;Function, PatchTag2&gt;::PatchFunction(const Function &amp;)&quot;, CT(*this), TAU_USER);
!  }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
*************** public:
*** 717,726 ****
    inline void
    operator()(const Array1 &amp;a1, const Array2 &amp;a2) const
    {
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluate2(a1,a2,function());
    }
  
!   inline const Function &amp;function() const { return function_m; }
  
  private:
  
--- 790,803 ----
    inline void
    operator()(const Array1 &amp;a1, const Array2 &amp;a2) const
    {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag2&gt; &amp;PatchFunction&lt;Function, PatchTag2&gt;::PatchFunction(const I1 &amp;, const I2 &amp;, const I3 &amp;, const I4 &amp;, const I5 &amp;, const I6 &amp;, const I7 &amp;)&quot;, CT(*this), TAU_USER);
+ 
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluate2(a1,a2,function());
    }
  
!   inline const Function &amp;function() const {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag2&gt;::function&quot;, CT(*this), TAU_USER);
!  return function_m; }
  
  private:
  
*************** template&lt;class Function&gt;
*** 731,738 ****
  class PatchFunction&lt;Function,PatchTag3&gt;
  {
  public:
!   PatchFunction() { }
!   PatchFunction(const Function &amp;function) : function_m(function) { }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
--- 808,819 ----
  class PatchFunction&lt;Function,PatchTag3&gt;
  {
  public:
!   PatchFunction() {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag3&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
!  }
!   PatchFunction(const Function &amp;function) : function_m(function) {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag3&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
!  }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
*************** public:
*** 740,749 ****
    inline void
    operator()(const Array1 &amp;a1, const Array2 &amp;a2, const Array3 &amp;a3) const
    {
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluate3(a1,a2,a3,function());
    }
  
!   inline const Function &amp;function() const { return function_m; }
  
  private:
  
--- 821,834 ----
    inline void
    operator()(const Array1 &amp;a1, const Array2 &amp;a2, const Array3 &amp;a3) const
    {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag3&gt; &amp;PatchFunction&lt;Function, PatchTag3&gt;::PatchFunction(const I1 &amp;)&quot;, CT(*this), TAU_USER);
+ 
      PatchEvaluator&lt;MainEvaluatorTag&gt;().evaluate3(a1,a2,a3,function());
    }
  
!   inline const Function &amp;function() const {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchTag3&gt;::function&quot;, CT(*this), TAU_USER);
!  return function_m; }
  
  private:
  
*************** private:
*** 753,762 ****
  template&lt;class Function, bool Write1&gt;
  class PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt; &gt;
  {
  public:
  
!   PatchFunction() { }
!   PatchFunction(const Function &amp;function) : function_m(function) { }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
--- 838,853 ----
  template&lt;class Function, bool Write1&gt;
  class PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt; &gt;
  {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
+ 
  public:
  
!   PatchFunction() {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt; &amp;PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt;::PatchFunction()&quot;, CT(*this), TAU_USER);
!  }
!   PatchFunction(const Function &amp;function) : function_m(function) {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt; &amp;PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt;::PatchFunction(const Function &amp;)&quot;, CT(*this), TAU_USER);
!  }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
*************** public:
*** 764,769 ****
--- 855,862 ----
    inline void
    operator()(const Array&amp; a) const
    {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt;::PatchFunction&quot;, &quot; &quot;, TAU_USER);
+ 
      ParticleEvaluator().evaluate(a, function(), PatchParticle1&lt;Write1&gt;());
    }
  
*************** public:
*** 771,781 ****
    inline void
    block(const Array&amp; a) const
    {
      ParticleEvaluator().
        evaluateBlock(a, function(), PatchParticle1&lt;Write1&gt;());
    }
  
!   inline const Function &amp;function() const { return function_m; }
  
  private:
  
--- 864,878 ----
    inline void
    block(const Array&amp; a) const
    {
+   TAU_PROFILE(&quot;void PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt;::block(const Array &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      ParticleEvaluator().
        evaluateBlock(a, function(), PatchParticle1&lt;Write1&gt;());
    }
  
!   inline const Function &amp;function() const {
!   TAU_PROFILE(&quot;const Function &amp;PatchFunction&lt;Function, PatchParticle1&lt;Write1&gt;&gt;::function() const&quot;, CT(*this), TAU_USER);
!  return function_m; }
  
  private:
  
*************** private:
*** 785,794 ****
  template&lt;class Function, bool Write1, bool Write2&gt;
  class PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt; &gt;
  {
  public:
  
!   PatchFunction() { }
!   PatchFunction(const Function &amp;function) : function_m(function) { }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
--- 882,897 ----
  template&lt;class Function, bool Write1, bool Write2&gt;
  class PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt; &gt;
  {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt;::PatchFunction&quot;, CT(*this), TAU_USER);
+ 
  public:
  
!   PatchFunction() {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt; &amp;PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt;::PatchFunction()&quot;, CT(*this), TAU_USER);
!  }
!   PatchFunction(const Function &amp;function) : function_m(function) {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt; &amp;PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt;::PatchFunction(const Function &amp;)&quot;, CT(*this), TAU_USER);
!  }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
*************** public:
*** 796,801 ****
--- 899,906 ----
    inline void
    operator()(const Array1 &amp;a1, const Array2 &amp;a2) const
    {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt;::PatchFunction&quot;, &quot; &quot;, TAU_USER);
+ 
      ParticleEvaluator().evaluate2(a1, a2, function(),
  				  PatchParticle2&lt;Write1, Write2&gt;());
    }
*************** public:
*** 804,814 ****
    inline void
    block(const Array1 &amp;a1, const Array2 &amp;a2) const
    {
      ParticleEvaluator().evaluate2Block(a1, a2, function(),
  				       PatchParticle2&lt;Write1, Write2&gt;());
    }
  
!   inline const Function &amp;function() const { return function_m; }
  
  private:
  
--- 909,923 ----
    inline void
    block(const Array1 &amp;a1, const Array2 &amp;a2) const
    {
+   TAU_PROFILE(&quot;void PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt;::block(const Array1 &amp;, const Array2 &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      ParticleEvaluator().evaluate2Block(a1, a2, function(),
  				       PatchParticle2&lt;Write1, Write2&gt;());
    }
  
!   inline const Function &amp;function() const {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle2&lt;Write1, Write2&gt;&gt;::function&quot;, CT(*this), TAU_USER);
!  return function_m; }
  
  private:
  
*************** class PatchFunction&lt;Function, PatchParti
*** 820,827 ****
  {
  public:
  
!   PatchFunction() { }
!   PatchFunction(const Function &amp;function) : function_m(function) { }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
--- 929,940 ----
  {
  public:
  
!   PatchFunction() {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle3&lt;Write1, Write2, Write3&gt;&gt; &amp;PatchFunction&lt;Function, PatchParticle3&lt;Write1, Write2, Write3&gt;&gt;::PatchFunction()&quot;, CT(*this), TAU_USER);
!  }
!   PatchFunction(const Function &amp;function) : function_m(function) {
!   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle3&lt;Write1, Write2, Write3&gt;&gt; &amp;PatchFunction&lt;Function, PatchParticle3&lt;Write1, Write2, Write3&gt;&gt;::PatchFunction(const Function &amp;)&quot;, CT(*this), TAU_USER);
!  }
  
    POOMA_PATCHFUNCTION_ARGUMENT_CONSTRUCTORS(PatchFunction,function_m)
  
*************** public:
*** 829,834 ****
--- 942,949 ----
    inline void
    operator()(const Array1 &amp;a1, const Array2 &amp;a2, const Array3 &amp;a3) const
    {
+   TAU_PROFILE(&quot;PatchFunction&lt;Function, PatchParticle3&lt;Write1, Write2, Write3&gt;&gt;::PatchFunction&quot;, &quot; &quot;, TAU_USER);
+ 
      ParticleEvaluator().evaluate3(
        a1, a2, a3, function(), PatchParticle3&lt;Write1, Write2, Write3&gt;());
    }
*************** public:
*** 837,847 ****
    inline void
    block(const Array1 &amp;a1, const Array2 &amp;a2, const Array3 &amp;a3) const
    {
      ParticleEvaluator().evaluate3Block(
        a1, a2, a3, function(), PatchParticle3&lt;Write1, Write2, Write3&gt;());
    }
  
!   inline const Function &amp;function() const { return function_m; }
  
  private:
  
--- 952,966 ----
    inline void
    block(const Array1 &amp;a1, const Array2 &amp;a2, const Array3 &amp;a3) const
    {
+   TAU_PROFILE(&quot;void PatchFunction&lt;Function, PatchParticle3&lt;Write1, Write2, Write3&gt;&gt;::block(const Array1 &amp;, const Array2 &amp;, const Array3 &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      ParticleEvaluator().evaluate3Block(
        a1, a2, a3, function(), PatchParticle3&lt;Write1, Write2, Write3&gt;());
    }
  
!   inline const Function &amp;function() const {
!   TAU_PROFILE(&quot;const Function &amp;PatchFunction&lt;Function, PatchParticle3&lt;Write1, Write2, Write3&gt;&gt;::function() const&quot;, CT(*this), TAU_USER);
!  return function_m; }
  
  private:
  
Index: PatchKernel.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/PatchKernel.h,v
retrieving revision 1.18
diff -c -p -r1.18 PatchKernel.h
*** PatchKernel.h	2000/06/08 22:16:13	1.18
--- PatchKernel.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
*************** public:
*** 71,76 ****
--- 72,79 ----
      : Pooma::Iterate_t(Pooma::scheduler()),
        a1_m(a1), function_m(function), write_m(write)
    {
+   TAU_PROFILE(&quot;PatchKernel&lt;A1, Function&gt; &amp;PatchKernel&lt;A1, Function&gt;::PatchKernel(const A1 &amp;, const Function &amp;, bool)&quot;, CT(*this), TAU_USER);
+ 
      DataObjectRequest&lt;BlockAffinity&gt; getAffinity;
      hintAffinity(engineFunctor(a1_m.engine(),getAffinity));
  
*************** public:
*** 85,90 ****
--- 88,95 ----
  
    virtual ~PatchKernel()
    {
+   TAU_PROFILE(&quot;void PatchKernel&lt;A1, Function&gt;::~PatchKernel()&quot;, CT(*this), TAU_USER);
+ 
  
      DataObjectRequest&lt;WriteRelease&gt; writeReq;
      engineFunctor(a1_m.engine(),writeReq);
*************** public:
*** 92,97 ****
--- 97,104 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;void PatchKernel&lt;A1, Function&gt;::run()&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(a1_m);
    }
  
*************** public:
*** 112,117 ****
--- 119,126 ----
      : Pooma::Iterate_t(Pooma::scheduler()),
        a1_m(a1), a2_m(a2), function_m(function)
    {
+   TAU_PROFILE(&quot;PatchKernel2&lt;A1, A2, Function&gt; &amp;PatchKernel2&lt;A1, A2, Function&gt;::PatchKernel2(const A1 &amp;, const A2 &amp;, const Function &amp;)&quot;, CT(*this), TAU_USER);
+ 
      DataObjectRequest&lt;BlockAffinity&gt; getAffinity;
      hintAffinity(engineFunctor(a1_m.engine(),getAffinity));
  
*************** public:
*** 136,142 ****
--- 145,153 ----
  
    virtual ~PatchKernel2()
    {
+   TAU_PROFILE(&quot;PatchKernel2&lt;A1, A2, Function&gt;::~PatchKernel2&quot;, CT(*this), TAU_USER);
  
+ 
      // The write request remembers the data block it sees on the left
      // so that it can check and see if it finds it on the right.
  
*************** public:
*** 153,158 ****
--- 164,171 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;PatchKernel2&lt;A1, A2, Function&gt;::run&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(a1_m, a2_m);
    }
  
*************** public:
*** 172,177 ****
--- 185,192 ----
      : Pooma::Iterate_t(Pooma::scheduler()),
        a1_m(a1), a2_m(a2), a3_m(a3), function_m(function)
    {
+   TAU_PROFILE(&quot;PatchKernel3&lt;A1, A2, A3, Function&gt; &amp;PatchKernel3&lt;A1, A2, A3, Function&gt;::PatchKernel3(const A1 &amp;, const A2 &amp;, const A3 &amp;, const Function &amp;)&quot;, CT(*this), TAU_USER);
+ 
      DataObjectRequest&lt;BlockAffinity&gt; getAffinity;
      hintAffinity(engineFunctor(a1_m.engine(),getAffinity));
  
*************** public:
*** 197,202 ****
--- 212,219 ----
  
    virtual ~PatchKernel3()
    {
+   TAU_PROFILE(&quot;void PatchKernel3&lt;A1, A2, A3, Function&gt;::~PatchKernel3()&quot;, CT(*this), TAU_USER);
+ 
      // The write request remembers the data block it sees on the left
      // so that it can check and see if it finds it on the right.
  
*************** public:
*** 214,219 ****
--- 231,238 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;PatchKernel3&lt;A1, A2, A3, Function&gt;::run&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(a1_m, a2_m, a3_m);
    }
  
*************** template&lt;class Array, class Function&gt;
*** 232,237 ****
--- 251,258 ----
  class ParticleKernel
    : public Pooma::Iterate_t
  {
+   TAU_PROFILE(&quot;ParticleKernel&lt;Array, Function&gt;::ParticleKernel&quot;, CT(*this), TAU_USER);
+ 
  public:
    ParticleKernel(const Array&amp; array, const Function&amp; function, int patchID,
  		  bool write1)
*************** public:
*** 239,244 ****
--- 260,267 ----
        array_m(array), function_m(function), patchID_m(patchID),
        write1_m(write1)
    {
+   TAU_PROFILE(&quot;ParticleKernel&lt;Array, Function&gt;::ParticleKernel&quot;, CT(*this), TAU_USER);
+ 
      hintAffinity(engineFunctor(array_m.engine(),
  			       DataObjectRequest&lt;BlockAffinity&gt;()));
  
*************** public:
*** 259,264 ****
--- 282,289 ----
  
    virtual ~ParticleKernel()
    {
+   TAU_PROFILE(&quot;ParticleKernel&lt;Array, Function&gt;::~ParticleKernel&quot;, CT(*this), TAU_USER);
+ 
      DataObjectRequest&lt;WriteRelease&gt; writeReq;
      DataObjectRequest&lt;ReadRelease&gt;  readReq(writeReq);
  
*************** public:
*** 274,279 ****
--- 299,306 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;ParticleKernel&lt;Array, Function&gt;::run&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(array_m,patchID_m);
    }
  
*************** public:
*** 296,301 ****
--- 323,330 ----
        array_m(array), function_m(function), patchID_m(patchID),
        write1_m(write1), csem_m(csem)
    {
+   TAU_PROFILE(&quot;ParticleKernelBlock&lt;Array, Function&gt;::ParticleKernelBlock&quot;, CT(*this), TAU_USER);
+ 
      hintAffinity(engineFunctor(array_m.engine(),
  			       DataObjectRequest&lt;BlockAffinity&gt;()));
  
*************** public:
*** 316,321 ****
--- 345,352 ----
  
    virtual ~ParticleKernelBlock()
    {
+   TAU_PROFILE(&quot;ParticleKernelBlock&lt;Array, Function&gt;::~ParticleKernelBlock&quot;, CT(*this), TAU_USER);
+ 
      DataObjectRequest&lt;WriteRelease&gt; writeReq;
      DataObjectRequest&lt;ReadRelease&gt;  readReq(writeReq);
  
*************** public:
*** 331,336 ****
--- 362,369 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;ParticleKernelBlock&lt;Array, Function&gt;::run&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(array_m,patchID_m);
      csem_m-&gt;incr();
    }
*************** public:
*** 359,364 ****
--- 392,399 ----
        array1_m(array1), array2_m(array2), function_m(function),
        id_m(id), write1_m(write1), write2_m(write2)
    {
+   TAU_PROFILE(&quot;ParticleKernel2&lt;Array1, Array2, Function&gt; &amp;ParticleKernel2&lt;Array1, Array2, Function&gt;::ParticleKernel2(const Array1 &amp;, const Array2 &amp;, const Function &amp;, int, bool, bool)&quot;, CT(*this), TAU_USER);
+ 
      hintAffinity(engineFunctor(array1_m.engine(),
  			       DataObjectRequest&lt;BlockAffinity&gt;()));
  
*************** public:
*** 384,389 ****
--- 419,426 ----
  
    virtual ~ParticleKernel2()
    {
+   TAU_PROFILE(&quot;void ParticleKernel2&lt;Array1, Array2, Function&gt;::~ParticleKernel2()&quot;, CT(*this), TAU_USER);
+ 
      DataObjectRequest&lt;WriteRelease&gt; writeReq;
  
      if (write1_m)
*************** public:
*** 403,408 ****
--- 440,447 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;void ParticleKernel2&lt;Array1, Array2, Function&gt;::run()&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(array1_m, array2_m, id_m);
    }
  
*************** template&lt;class Array1, class Array2, cla
*** 420,425 ****
--- 459,466 ----
  class ParticleKernel2Block
    : public Pooma::Iterate_t
  {
+   TAU_PROFILE(&quot;ParticleKernel2Block&lt;Array1, Array2, Function&gt;::ParticleKernel2Block&quot;, CT(*this), TAU_USER);
+ 
  public:
    ParticleKernel2Block(const Array1 &amp;array1,
  		       const Array2 &amp;array2,
*************** public:
*** 430,435 ****
--- 471,478 ----
        array1_m(array1), array2_m(array2), function_m(function),
        id_m(id), write1_m(write1), write2_m(write2), csem_m(csem)
    {
+   TAU_PROFILE(&quot;ParticleKernel2Block&lt;Array1, Array2, Function&gt; &amp;ParticleKernel2Block&lt;Array1, Array2, Function&gt;::ParticleKernel2Block(const Array1 &amp;, const Array2 &amp;, const Function &amp;, int, bool, bool, Pooma::CountingSemaphore *)&quot;, CT(*this), TAU_USER);
+ 
      hintAffinity(engineFunctor(array1_m.engine(),DataObjectRequest&lt;BlockAffinity&gt;()));
  
      // Request locks
*************** public:
*** 453,458 ****
--- 496,503 ----
  
    virtual ~ParticleKernel2Block()
    {
+   TAU_PROFILE(&quot;void ParticleKernel2Block&lt;Array1, Array2, Function&gt;::~ParticleKernel2Block()&quot;, CT(*this), TAU_USER);
+ 
      DataObjectRequest&lt;WriteRelease&gt; writeReq;
  
      if (write1_m)
*************** public:
*** 472,477 ****
--- 517,524 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;void ParticleKernel2Block&lt;Array1, Array2, Function&gt;::run()&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(array1_m, array2_m, id_m);
      csem_m-&gt;incr();
    }
*************** template&lt;class Array1, class Array2, cla
*** 493,498 ****
--- 540,547 ----
  class ParticleKernel3
    : public Pooma::Iterate_t
  {
+   TAU_PROFILE(&quot;ParticleKernel3&lt;Array1, Array2, Array3, Function&gt;::ParticleKernel3&quot;, CT(*this), TAU_USER);
+ 
  public:
    ParticleKernel3(const Array1 &amp;array1,
  		   const Array2 &amp;array2,
*************** public:
*** 504,509 ****
--- 553,560 ----
        function_m(function), id_m(id),
        write1_m(write1), write2_m(write2), write3_m(write3)
    {
+   TAU_PROFILE(&quot;ParticleKernel3&lt;Array1, Array2, Array3, Function&gt; &amp;ParticleKernel3&lt;Array1, Array2, Array3, Function&gt;::ParticleKernel3(const Array1 &amp;, const Array2 &amp;, const Array3 &amp;, const Function &amp;, int, bool, bool, bool)&quot;, CT(*this), TAU_USER);
+ 
      hintAffinity(engineFunctor(array1_m.engine(),
  			       DataObjectRequest&lt;BlockAffinity&gt;()));
  
*************** public:
*** 534,539 ****
--- 585,592 ----
  
    virtual ~ParticleKernel3()
    {
+   TAU_PROFILE(&quot;void ParticleKernel3&lt;Array1, Array2, Array3, Function&gt;::~ParticleKernel3()&quot;, CT(*this), TAU_USER);
+ 
      // Request locks
  
      DataObjectRequest&lt;WriteRelease&gt; writeReq;
*************** public:
*** 561,566 ****
--- 614,621 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;void ParticleKernel3&lt;Array1, Array2, Array3, Function&gt;::run()&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(array1_m, array2_m, array3_m, id_m);
    }
  
*************** template&lt;class Array1, class Array2, cla
*** 580,585 ****
--- 635,642 ----
  class ParticleKernel3Block
    : public Pooma::Iterate_t
  {
+   TAU_PROFILE(&quot;ParticleKernel3Block&lt;Array1, Array2, Array3, Function&gt;::ParticleKernel3Block&quot;, CT(*this), TAU_USER);
+ 
  public:
    ParticleKernel3Block(const Array1 &amp;array1,
  		       const Array2 &amp;array2,
*************** public:
*** 592,597 ****
--- 649,656 ----
        function_m(function), id_m(id),
        write1_m(write1), write2_m(write2), write3_m(write3), csem_m(csem)
    {
+   TAU_PROFILE(&quot;ParticleKernel3Block&lt;Array1, Array2, Array3, Function&gt;::ParticleKernel3Block&quot;, CT(*this), TAU_USER);
+ 
      hintAffinity(engineFunctor(array1_m.engine(),
  			       DataObjectRequest&lt;BlockAffinity&gt;()));
  
*************** public:
*** 622,627 ****
--- 681,688 ----
  
    virtual ~ParticleKernel3Block()
    {
+   TAU_PROFILE(&quot;void ParticleKernel3Block&lt;Array1, Array2, Array3, Function&gt;::~ParticleKernel3Block()&quot;, CT(*this), TAU_USER);
+ 
      // Request locks
  
      DataObjectRequest&lt;WriteRelease&gt; writeReq;
*************** public:
*** 649,654 ****
--- 710,717 ----
  
    virtual void run()
    {
+   TAU_PROFILE(&quot;ParticleKernel3Block&lt;Array1, Array2, Array3, Function&gt;::run&quot;, CT(*this), TAU_USER);
+ 
      function_m.apply(array1_m, array2_m, array3_m, id_m);
      csem_m-&gt;incr();
    }
Index: Reduction.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/Reduction.h,v
retrieving revision 1.10
diff -c -p -r1.10 Reduction.h
*** Reduction.h	2001/03/29 00:41:21	1.10
--- Reduction.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
***************
*** 49,54 ****
--- 50,56 ----
  //-----------------------------------------------------------------------------
  
  #include &quot;Domain/NullDomain.h&quot;
+ #include &quot;Engine/Engine.h&quot;
  #include &quot;Engine/Intersector.h&quot;
  #include &quot;Engine/IntersectEngine.h&quot;
  #include &quot;Evaluator/ReductionKernel.h&quot;
*************** struct Reduction&lt;MainEvaluatorTag&gt;
*** 91,102 ****
    //---------------------------------------------------------------------------
    // Default ctor.
  
!   Reduction() { }
  
    //---------------------------------------------------------------------------
    // Destructor
  
!   ~Reduction() { }
  
    //---------------------------------------------------------------------------
    // Input an expression and cause it to be reduced.
--- 93,108 ----
    //---------------------------------------------------------------------------
    // Default ctor.
  
!   Reduction() {
!   TAU_PROFILE(&quot;Reduction&lt;MainEvaluatorTag&gt; &amp;Reduction&lt;MainEvaluatorTag&gt;::Reduction()&quot;, CT(*this), TAU_USER);
!  }
  
    //---------------------------------------------------------------------------
    // Destructor
  
!   ~Reduction() {
!   TAU_PROFILE(&quot;void Reduction&lt;MainEvaluatorTag&gt;::~Reduction()&quot;, CT(*this), TAU_USER);
!  }
  
    //---------------------------------------------------------------------------
    // Input an expression and cause it to be reduced.
*************** struct Reduction&lt;MainEvaluatorTag&gt;
*** 105,110 ****
--- 111,118 ----
    template&lt;class T, class Op, class Expr&gt;
    void evaluate(T &amp;ret, const Op &amp;op, const Expr &amp;e) const
    {
+   TAU_PROFILE(&quot;void Reduction&lt;MainEvaluatorTag&gt;::evaluate(T &amp;, const Op &amp;, const Expr &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename EvaluatorTag1&lt;Expr&gt;::Evaluator_t Evaluator_t;
      Reduction&lt;Evaluator_t&gt;().evaluate(ret, op, e());
      
*************** struct Reduction&lt;SinglePatchEvaluatorTag
*** 126,137 ****
    //---------------------------------------------------------------------------
    // Default ctor.
  
!   Reduction() { }
  
    //---------------------------------------------------------------------------
    // Destructor
  
!   ~Reduction() { }
  
    //---------------------------------------------------------------------------
    // Input an expression and cause it to be reduced.
--- 134,149 ----
    //---------------------------------------------------------------------------
    // Default ctor.
  
!   Reduction() {
!   TAU_PROFILE(&quot;Reduction&lt;SinglePatchEvaluatorTag&gt; &amp;Reduction&lt;SinglePatchEvaluatorTag&gt;::Reduction()&quot;, CT(*this), TAU_USER);
!  }
  
    //---------------------------------------------------------------------------
    // Destructor
  
!   ~Reduction() {
!   TAU_PROFILE(&quot;void Reduction&lt;SinglePatchEvaluatorTag&gt;::~Reduction()&quot;, CT(*this), TAU_USER);
!  }
  
    //---------------------------------------------------------------------------
    // Input an expression and cause it to be reduced.
*************** struct Reduction&lt;SinglePatchEvaluatorTag
*** 143,148 ****
--- 155,162 ----
    void evaluate(T &amp;ret, const Op &amp;op, const Expr &amp;e,
  		Pooma::CountingSemaphore &amp;csem) const
    {
+   TAU_PROFILE(&quot;void Reduction&lt;SinglePatchEvaluatorTag&gt;::evaluate(T &amp;, const Op &amp;, const Expr &amp;, Pooma::CountingSemaphore &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef typename KernelTag1&lt;Expr&gt;::Kernel_t Kernel_t;
  
  #if POOMA_REORDER_ITERATES
*************** struct Reduction&lt;SinglePatchEvaluatorTag
*** 158,163 ****
--- 172,179 ----
    template&lt;class T, class Op, class Expr&gt;
    void evaluate(T &amp;ret, const Op &amp;op, const Expr &amp;e) const
    {
+   TAU_PROFILE(&quot;void Reduction&lt;SinglePatchEvaluatorTag&gt;::evaluate(T &amp;, const Op &amp;, const Expr &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      Pooma::CountingSemaphore csem;
      csem.height(1);
  
*************** struct Reduction&lt;MultiPatchEvaluatorTag&gt;
*** 185,196 ****
    //---------------------------------------------------------------------------
    // Default ctor.
  
!   Reduction() { }
  
    //---------------------------------------------------------------------------
    // Destructor
  
!   ~Reduction() { }
  
    //---------------------------------------------------------------------------
    // Input an expression and cause it to be reduced according to the 
--- 201,216 ----
    //---------------------------------------------------------------------------
    // Default ctor.
  
!   Reduction() {
!   TAU_PROFILE(&quot;Reduction&lt;MultiPatchEvaluatorTag&gt; &amp;Reduction&lt;MultiPatchEvaluatorTag&gt;::Reduction()&quot;, CT(*this), TAU_USER);
!  }
  
    //---------------------------------------------------------------------------
    // Destructor
  
!   ~Reduction() {
!   TAU_PROFILE(&quot;void Reduction&lt;MultiPatchEvaluatorTag&gt;::~Reduction()&quot;, CT(*this), TAU_USER);
!  }
  
    //---------------------------------------------------------------------------
    // Input an expression and cause it to be reduced according to the 
*************** struct Reduction&lt;MultiPatchEvaluatorTag&gt;
*** 210,215 ****
--- 230,237 ----
    template&lt;class T, class Op, class Expr&gt;
    void evaluate(T &amp;ret, const Op &amp;op, const Expr &amp;e) const
    {
+   TAU_PROFILE(&quot;void Reduction&lt;MultiPatchEvaluatorTag&gt;::evaluate(T &amp;, const Op &amp;, const Expr &amp;) const&quot;, CT(*this), TAU_USER);
+ 
      typedef Intersector&lt;Expr::dimensions&gt; Inter_t;
      Inter_t inter;
  
Index: ReductionKernel.h
===================================================================
RCS file: /home/pooma/Repository/r2/src/Evaluator/ReductionKernel.h,v
retrieving revision 1.3
diff -c -p -r1.3 ReductionKernel.h
*** ReductionKernel.h	2000/06/08 22:16:13	1.3
--- ReductionKernel.h	2001/10/09 23:00:35
***************
*** 1,3 ****
--- 1,4 ----
+ #include &lt;Profile/Profiler.h&gt;
  // -*- C++ -*-
  // ACL:license
  // ----------------------------------------------------------------------
***************
*** 78,83 ****
--- 79,86 ----
  template&lt;class T, class Op, class Expr, class KernelTag&gt;
  class ReductionKernel : public Pooma::Iterate_t
  {
+   TAU_PROFILE(&quot;ReductionKernel&lt;T, Op, Expr, KernelTag&gt;::ReductionKernel&quot;, CT(*this), TAU_USER);
+ 
  public:
  
    typedef ReductionKernel&lt;T, Op, Expr, KernelTag&gt; This_t;
*************** ReductionKernel(T &amp;ret, const Op &amp;op, co
*** 131,136 ****
--- 134,141 ----
    : Pooma::Iterate_t(Pooma::scheduler()),
      ret_m(ret), op_m(op), expr_m(e), csem_m(csem)
  {
+   TAU_PROFILE(&quot;ReductionKernel&lt;T, Op, Expr, KernelTag&gt;::ReductionKernel&quot;, CT(*this), TAU_USER);
+ 
    // Request read lock.
  
    DataObjectRequest&lt;ReadRequest&gt; readReq(*this);
*************** ReductionKernel(T &amp;ret, const Op &amp;op, co
*** 145,150 ****
--- 150,157 ----
  template&lt;class T, class Op, class Expr, class KernelTag&gt;
  ReductionKernel&lt;T, Op, Expr, KernelTag&gt;::~ReductionKernel()
  {
+   TAU_PROFILE(&quot;ReductionKernel&lt;T, Op, Expr, KernelTag&gt;::~ReductionKernel&quot;, CT(*this), TAU_USER);
+ 
    // Release read lock.
  
    DataObjectRequest&lt;ReadRelease&gt; readRelease;
*************** ReductionKernel&lt;T, Op, Expr, KernelTag&gt;:
*** 161,166 ****
--- 168,175 ----
  template&lt;class T, class Op, class Expr, class KernelTag&gt;
  void ReductionKernel&lt;T, Op, Expr, KernelTag&gt;::run()
  {
+   TAU_PROFILE(&quot;ReductionKernel&lt;T, Op, Expr, KernelTag&gt;::run&quot;, CT(*this), TAU_USER);
+ 
    // Just evaluate the expression.
    
    ReductionEvaluator&lt;KernelTag&gt;::evaluate(ret_m, op_m, expr_m);
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000795.html">Pooma Example Failures
</A></li>
	<LI>Next message: <A HREF="000797.html">Patch: 'the the' is Seldom Correct
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#796">[ date ]</a>
              <a href="thread.html#796">[ thread ]</a>
              <a href="subject.html#796">[ subject ]</a>
              <a href="author.html#796">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/pooma-dev">More information about the pooma-dev
mailing list</a><br>
</body></html>
